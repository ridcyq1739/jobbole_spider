[{"url_object_id": "3241c8714d76296e3d9a75803c871f8c", "title": "深入学习 Redis（4）：哨兵", "url": "http://blog.jobbole.com/114382/", "create_date": "2018/09/13", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Redis", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/kismetv/p/9609938.html\">编程迷思</a>   </div><h2>前言</h2>\n<p>在 <a href=\"http://blog.jobbole.com/114194/\" target=\"_blank\">深入学习Redis（3）：主从复制</a> 中曾提到，Redis主从复制的作用有数据热备、负载均衡、故障恢复等；但主从复制存在的一个问题是故障恢复无法自动化。本文将要介绍的哨兵，它基于Redis主从复制，主要作用便是解决主节点故障恢复的自动化问题，进一步提高系统的高可用性。</p>\n<p>文章主要内容如下：首先介绍哨兵的作用和架构；然后讲述哨兵系统的部署方法，以及通过客户端访问哨兵系统的方法；然后简要说明哨兵实现的基本原理；最后给出关于哨兵实践的一些建议。文章内容基于Redis 3.0版本。</p>\n<h2>系列文章</h2>\n<p><a href=\"http://blog.jobbole.com/113789/\" target=\"_blank\">深入学习Redis（1）：Redis内存模型</a></p>\n<p><a href=\"http://blog.jobbole.com/114093/\" target=\"_blank\">深入学习Redis（2）：持久化</a></p>\n<p><a href=\"http://blog.jobbole.com/114194/\" target=\"_blank\">深入学习Redis（3）：主从复制</a></p>\n<h1><a name=\"t1\"></a>一、作用和架构</h1>\n<h2><a name=\"t11\"></a>1.  作用</h2>\n<p>在介绍哨兵之前，首先从宏观角度回顾一下Redis实现高可用相关的技术。它们包括：持久化、复制、哨兵和集群，其主要作用和解决的问题是：</p>\n<ul>\n<li>持久化：持久化是最简单的高可用方法(有时甚至不被归为高可用的手段)，主要作用是数据备份，即将数据存储在硬盘，保证数据不会因进程退出而丢失。</li>\n<li>复制：复制是高可用Redis的基础，哨兵和集群都是在复制基础上实现高可用的。复制主要实现了数据的多机备份，以及对于读操作的负载均衡和简单的故障恢复。缺陷：故障恢复无法自动化；写操作无法负载均衡；存储能力受到单机的限制。</li>\n<li>哨兵：在复制的基础上，哨兵实现了自动化的故障恢复。缺陷：写操作无法负载均衡；存储能力受到单机的限制。</li>\n<li>集群：通过集群，Redis解决了写操作无法负载均衡，以及存储能力受到单机限制的问题，实现了较为完善的高可用方案。</li>\n</ul>\n<p>下面说回哨兵。</p>\n<p>Redis Sentinel，即Redis哨兵，在Redis 2.8版本开始引入。<strong>哨兵的核心功能是主节点的自动故障转移。</strong>下面是Redis官方文档对于哨兵功能的描述：</p>\n<ul>\n<li>监控（Monitoring）：哨兵会不断地检查主节点和从节点是否运作正常。</li>\n<li>自动故障转移（Automatic failover）：当主节点不能正常工作时，哨兵会开始自动故障转移操作，它会将失效主节点的其中一个从节点升级为新的主节点，并让其他从节点改为复制新的主节点。</li>\n<li>配置提供者（Configuration provider）：客户端在初始化时，通过连接哨兵来获得当前Redis服务的主节点地址。</li>\n<li>通知（Notification）：哨兵可以将故障转移的结果发送给客户端。</li>\n</ul>\n<p>其中，监控和自动故障转移功能，使得哨兵可以及时发现主节点故障并完成转移；而配置提供者和通知功能，则需要在与客户端的交互中才能体现。</p>\n<p>这里对“客户端”一词在文章中的用法做一个说明：在前面的文章中，只要通过API访问redis服务器，都会称作客户端，包括redis-cli、Java客户端Jedis等；为了便于区分说明，本文中的客户端并不包括redis-cli，而是比redis-cli更加复杂：redis-cli使用的是redis提供的底层接口，而客户端则对这些接口、功能进行了封装，以便充分利用哨兵的配置提供者和通知功能。</p>\n<h2><a name=\"t12\"></a>2.  架构</h2>\n<p>典型的哨兵架构图如下所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8b0360c2b6eba06c316535320b2aecd2.png\" alt=\"\"></p>\n<p>它由两部分组成，哨兵节点和数据节点：</p>\n<ul>\n<li>哨兵节点：哨兵系统由一个或多个哨兵节点组成，哨兵节点是特殊的redis节点，不存储数据。</li>\n<li>数据节点：主节点和从节点都是数据节点。</li>\n</ul>\n<h1><a name=\"t2\"></a>二、部署</h1>\n<p>这一部分将部署一个简单的哨兵系统，包含1个主节点、2个从节点和3个哨兵节点。方便起见：所有这些节点都部署在一台机器上（局域网IP：192.168.92.128），使用端口号区分；节点的配置尽可能简化。</p>\n<h2><a name=\"t21\"></a>1.  部署主从节点</h2>\n<p>哨兵系统中的主从节点，与普通的主从节点配置是一样的，并不需要做任何额外配置。下面分别是主节点（port=6379）和2个从节点（port=6380/6381）的配置文件，配置都比较简单，不再详述。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f355f37d9b850702998\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#redis-6379.conf\r\nport 6379\r\ndaemonize yes\r\nlogfile \"6379.log\"\r\ndbfilename \"dump-6379.rdb\"\r\n\r\n#redis-6380.conf\r\nport 6380\r\ndaemonize yes\r\nlogfile \"6380.log\"\r\ndbfilename \"dump-6380.rdb\"\r\nslaveof 192.168.92.128 6379\r\n\r\n#redis-6381.conf\r\nport 6381\r\ndaemonize yes\r\nlogfile \"6381.log\"\r\ndbfilename \"dump-6381.rdb\"\r\nslaveof 192.168.92.128 6379</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37d9b850702998-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37d9b850702998-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-1\"><span class=\"crayon-p\">#redis-6379.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-2\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-3\"><span class=\"crayon-e\">daemonize </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-4\"><span class=\"crayon-i\">logfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6379.log\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-5\"><span class=\"crayon-i\">dbfilename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dump-6379.rdb\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-7\"><span class=\"crayon-p\">#redis-6380.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-8\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6380</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-9\"><span class=\"crayon-e\">daemonize </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-10\"><span class=\"crayon-i\">logfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6380.log\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-11\"><span class=\"crayon-i\">dbfilename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dump-6380.rdb\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-12\"><span class=\"crayon-i\">slaveof</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.92.128</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-14\"><span class=\"crayon-p\">#redis-6381.conf</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-15\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6381</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-16\"><span class=\"crayon-e\">daemonize </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-17\"><span class=\"crayon-i\">logfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6381.log\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37d9b850702998-18\"><span class=\"crayon-i\">dbfilename</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dump-6381.rdb\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37d9b850702998-19\"><span class=\"crayon-i\">slaveof</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.92.128</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>配置完成后，依次启动主节点和从节点：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f355f37da6238364037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nredis-server redis-6379.conf\r\nredis-server redis-6380.conf\r\nredis-server redis-6381.conf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37da6238364037-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37da6238364037-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37da6238364037-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f355f37da6238364037-1\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">server </span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6379.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37da6238364037-2\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">server </span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6380.conf</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37da6238364037-3\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">server </span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">6381.conf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>节点启动后，连接主节点查看主从状态是否正常，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/bf34c119fb79b61250d94a1d6aa7ce26.png\" alt=\"\"></p>\n<h2><a name=\"t22\"></a>2.  部署哨兵节点</h2>\n<p>哨兵节点本质上是特殊的Redis节点。</p>\n<p>3个哨兵节点的配置几乎是完全一样的，主要区别在于端口号的不同（26379/26380/26381），下面以26379节点为例介绍节点的配置和启动方式；配置部分尽量简化，更多配置会在后面介绍。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f355f37db5783601214\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#sentinel-26379.conf\r\nport 26379\r\ndaemonize yes\r\nlogfile \"26379.log\"\r\nsentinel monitor mymaster 192.168.92.128 6379 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37db5783601214-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37db5783601214-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37db5783601214-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37db5783601214-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37db5783601214-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f355f37db5783601214-1\"><span class=\"crayon-p\">#sentinel-26379.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37db5783601214-2\"><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26379</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37db5783601214-3\"><span class=\"crayon-e\">daemonize </span><span class=\"crayon-e\">yes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37db5783601214-4\"><span class=\"crayon-i\">logfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"26379.log\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37db5783601214-5\"><span class=\"crayon-e\">sentinel </span><span class=\"crayon-e\">monitor </span><span class=\"crayon-i\">mymaster</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.92.128</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>其中，sentinel monitor mymaster 192.168.92.128 6379 2 配置的含义是：该哨兵节点监控192.168.92.128:6379这个主节点，该主节点的名称是mymaster，最后的2的含义与主节点的故障判定有关：至少需要2个哨兵节点同意，才能判定主节点故障并进行故障转移。</p>\n<p>哨兵节点的启动有两种方式，二者作用是完全相同的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f355f37db9518137994\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nredis-sentinel sentinel-26379.conf\r\nredis-server sentinel-26379.conf --sentinel</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37db9518137994-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37db9518137994-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f355f37db9518137994-1\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">sentinel </span><span class=\"crayon-v\">sentinel</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26379.conf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37db9518137994-2\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">server </span><span class=\"crayon-v\">sentinel</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26379.conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">sentinel</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>按照上述方式配置和启动之后，整个哨兵系统就启动完毕了。可以通过redis-cli连接哨兵节点进行验证，如下图所示：可以看出26379哨兵节点已经在监控mymaster主节点(即192.168.92.128:6379)，并发现了其2个从节点和另外2个哨兵节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a69a41455df2b730275ed61c3501a4ed.png\" alt=\"\"></p>\n<p>此时如果查看哨兵节点的配置文件，会发现一些变化，以26379为例：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/466d088ddc678a5d4fcd7b4a91c6d9fc.png\" alt=\"\"></p>\n<p>其中，dir只是显式声明了数据和日志所在的目录（在哨兵语境下只有日志）；known-slave和known-sentinel显示哨兵已经发现了从节点和其他哨兵；带有epoch的参数与配置纪元有关（配置纪元是一个从0开始的计数器，每进行一次领导者哨兵选举，都会+1；领导者哨兵选举是故障转移阶段的一个操作，在后文原理部分会介绍）。</p>\n<h2><a name=\"t23\"></a>3.  演示故障转移</h2>\n<p>哨兵的4个作用中，配置提供者和通知需要客户端的配合，本文将在下一章介绍客户端访问哨兵系统的方法时详细介绍。这一小节将演示当主节点发生故障时，哨兵的监控和自动故障转移功能。</p>\n<p>（1）首先，使用kill命令杀掉主节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/307cc9dbdc5df1e5dcd5ce77b2c1182e.png\" alt=\"\"></p>\n<p>（2）如果此时立即在哨兵节点中使用info Sentinel命令查看，会发现主节点还没有切换过来，因为哨兵发现主节点故障并转移，需要一段时间。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/7fea5421d4c171ea55d9ff9a3a4c0112.png\" alt=\"\"></p>\n<p>（3）一段时间以后，再次在哨兵节点中执行info Sentinel查看，发现主节点已经切换成6380节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d4302e7e98fbe1fa66d391a1280f186a.png\" alt=\"\"></p>\n<p>但是同时可以发现，哨兵节点认为新的主节点仍然有2个从节点，这是因为哨兵在将6380切换成主节点的同时，将6379节点置为其从节点；虽然6379从节点已经挂掉，但是由于哨兵并不会对从节点进行客观下线（其含义将在原理部分介绍），因此认为该从节点一直存在。当6379节点重新启动后，会自动变成6380节点的从节点。下面验证一下。</p>\n<p>（4）重启6379节点：可以看到6379节点成为了6380节点的从节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/7df7d6cccdf7e35e41e9a0c4643d4aea.png\" alt=\"\"></p>\n<p>（5）在故障转移阶段，哨兵和主从节点的配置文件都会被改写。</p>\n<p>对于主从节点，主要是slaveof配置的变化：新的主节点没有了slaveof配置，其从节点则slaveof新的主节点。</p>\n<p>对于哨兵节点，除了主从节点信息的变化，纪元(epoch)也会变化，下图中可以看到纪元相关的参数都+1了。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/befad1757e6a99ccc1752c71daa83ed8.png\" alt=\"\"></p>\n<h2><a name=\"t24\"></a>4.  总结</h2>\n<p>哨兵系统的搭建过程，有几点需要注意：</p>\n<p>（1）哨兵系统中的主从节点，与普通的主从节点并没有什么区别，故障发现和转移是由哨兵来控制和完成的。</p>\n<p>（2）哨兵节点本质上是redis节点。</p>\n<p>（3）每个哨兵节点，只需要配置监控主节点，便可以自动发现其他的哨兵节点和从节点。</p>\n<p>（4）在哨兵节点启动和故障转移阶段，各个节点的配置文件会被重写(config rewrite)。</p>\n<p>（5）本章的例子中，一个哨兵只监控了一个主节点；实际上，一个哨兵可以监控多个主节点，通过配置多条sentinel monitor即可实现。</p>\n<h1><a name=\"t3\"></a>三、客户端访问哨兵系统</h1>\n<p>上一小节演示了哨兵的两大作用：监控和自动故障转移，本小节则结合客户端演示哨兵的另外两个作用：配置提供者和通知。</p>\n<h2><a name=\"t31\"></a>1.  代码示例</h2>\n<p>在介绍客户端的原理之前，先以Java客户端Jedis为例，演示一下使用方法：下面代码可以连接我们刚刚搭建的哨兵系统，并进行各种读写操作（代码中只演示如何连接哨兵，异常处理、资源关闭等未考虑）。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f355f37dbf442995082\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic static void testSentinel() throws Exception {\r\n         String masterName = \"mymaster\";\r\n         Set&lt;String&gt; sentinels = new HashSet&lt;&gt;();\r\n         sentinels.add(\"192.168.92.128:26379\");\r\n         sentinels.add(\"192.168.92.128:26380\");\r\n         sentinels.add(\"192.168.92.128:26381\");\r\n\r\n         JedisSentinelPool pool = new JedisSentinelPool(masterName, sentinels); //初始化过程做了很多工作\r\n         Jedis jedis = pool.getResource();\r\n         jedis.set(\"key1\", \"value1\");\r\n         pool.close();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37dbf442995082-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37dbf442995082-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37dbf442995082-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37dbf442995082-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37dbf442995082-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37dbf442995082-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37dbf442995082-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37dbf442995082-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37dbf442995082-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37dbf442995082-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37dbf442995082-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37dbf442995082-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f355f37dbf442995082-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">testSentinel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37dbf442995082-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">masterName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mymaster\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37dbf442995082-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HashSet</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37dbf442995082-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"192.168.92.128:26379\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37dbf442995082-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"192.168.92.128:26380\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37dbf442995082-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"192.168.92.128:26381\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37dbf442995082-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37dbf442995082-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">JedisSentinelPool </span><span class=\"crayon-v\">pool</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisSentinelPool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">masterName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentinels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//初始化过程做了很多工作</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37dbf442995082-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37dbf442995082-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"key1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"value1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f355f37dbf442995082-11\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">pool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37dbf442995082-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n\n</div>\n<h2><a name=\"t32\"></a>2.  客户端原理</h2>\n<p>Jedis客户端对哨兵提供了很好的支持。如上述代码所示，我们只需要向Jedis提供哨兵节点集合和masterName，构造JedisSentinelPool对象；然后便可以像使用普通redis连接池一样来使用了：通过pool.getResource()获取连接，执行具体的命令。</p>\n<p>在整个过程中，我们的代码不需要显式的指定主节点的地址，就可以连接到主节点；代码中对故障转移没有任何体现，就可以在哨兵完成故障转移后自动的切换主节点。之所以可以做到这一点，是因为在JedisSentinelPool的构造器中，进行了相关的工作；主要包括以下两点：</p>\n<p>（1）<strong>遍历哨兵节点，获取主节点信息：</strong>遍历哨兵节点，通过其中一个哨兵节点+masterName获得主节点的信息；该功能是通过调用哨兵节点的sentinel get-master-addr-by-name命令实现，该命令示例如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/d8c3c359c63cda07cd8fc01317866fd2.png\" alt=\"\"></p>\n<p>一旦获得主节点信息，停止遍历（因此一般来说遍历到第一个哨兵节点，循环就停止了）。</p>\n<p>（2）<strong>增加对哨兵的监听：</strong>这样当发生故障转移时，客户端便可以收到哨兵的通知，从而完成主节点的切换。具体做法是：利用redis提供的发布订阅功能，为每一个哨兵节点开启一个单独的线程，订阅哨兵节点的+switch-master频道，当收到消息时，重新初始化连接池。</p>\n<h2><a name=\"t33\"></a>3.  总结</h2>\n<p>通过客户端原理的介绍，可以加深对哨兵功能的理解：</p>\n<p>（1）配置提供者：客户端可以通过哨兵节点+masterName获取主节点信息，在这里哨兵起到的作用就是配置提供者。</p>\n<p><strong>需要注意的是，哨兵只是配置提供者，而不是代理</strong>。二者的区别在于：如果是配置提供者，客户端在通过哨兵获得主节点信息后，会直接建立到主节点的连接，后续的请求(如set/get)会直接发向主节点；如果是代理，客户端的每一次请求都会发向哨兵，哨兵再通过主节点处理请求。</p>\n<p>举一个例子可以很好的理解哨兵的作用是配置提供者，而不是代理。在前面部署的哨兵系统中，将哨兵节点的配置文件进行如下修改：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f355f37dc5008827209\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsentinel monitor mymaster 192.168.92.128 6379 2\r\n改为\r\nsentinel monitor mymaster 127.0.0.1 6379 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37dc5008827209-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f355f37dc5008827209-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f355f37dc5008827209-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f355f37dc5008827209-1\"><span class=\"crayon-e\">sentinel </span><span class=\"crayon-e\">monitor </span><span class=\"crayon-i\">mymaster</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.92.128</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f355f37dc5008827209-2\">改为</div><div class=\"crayon-line\" id=\"crayon-5b9f355f37dc5008827209-3\"><span class=\"crayon-e\">sentinel </span><span class=\"crayon-e\">monitor </span><span class=\"crayon-i\">mymaster</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>然后，将前述客户端代码在局域网的另外一台机器上运行，会发现客户端无法连接主节点；这是因为哨兵作为配置提供者，客户端通过它查询到主节点的地址为127.0.0.1:6379，客户端会向127.0.0.1:6379建立redis连接，自然无法连接。如果哨兵是代理，这个问题就不会出现了。</p>\n<p>（2）通知：哨兵节点在故障转移完成后，会将新的主节点信息发送给客户端，以便客户端及时切换主节点。</p>\n<h1><a name=\"t4\"></a>四、基本原理</h1>\n<p>前面介绍了哨兵部署、使用的基本方法，本部分介绍哨兵实现的基本原理。</p>\n<h2><a name=\"t41\"></a>1.  哨兵节点支持的命令</h2>\n<p>哨兵节点作为运行在特殊模式下的redis节点，其支持的命令与普通的redis节点不同。在运维中，我们可以通过这些命令查询或修改哨兵系统；不过更重要的是，哨兵系统要实现故障发现、故障转移等各种功能，离不开哨兵节点之间的通信，而通信的很大一部分是通过哨兵节点支持的命令来实现的。下面介绍哨兵节点支持的主要命令。</p>\n<p>（1）基础查询：通过这些命令，可以查询哨兵系统的拓扑结构、节点信息、配置信息等。</p>\n<ul>\n<li>info sentinel：获取监控的所有主节点的基本信息</li>\n<li>sentinel masters：获取监控的所有主节点的详细信息</li>\n<li>sentinel master mymaster：获取监控的主节点mymaster的详细信息</li>\n<li>sentinel slaves mymaster：获取监控的主节点mymaster的从节点的详细信息</li>\n<li>sentinel sentinels mymaster：获取监控的主节点mymaster的哨兵节点的详细信息</li>\n<li>sentinel get-master-addr-by-name mymaster：获取监控的主节点mymaster的地址信息，前文已有介绍</li>\n<li>sentinel is-master-down-by-addr：哨兵节点之间可以通过该命令询问主节点是否下线，从而对是否客观下线做出判断</li>\n</ul>\n<p>（2）增加/移除对主节点的监控</p>\n<p>sentinel monitor mymaster2 192.168.92.128 16379 2：与部署哨兵节点时配置文件中的sentinel monitor功能完全一样，不再详述</p>\n<p>sentinel remove mymaster2：取消当前哨兵节点对主节点mymaster2的监控</p>\n<p>（3）强制故障转移</p>\n<p>sentinel failover mymaster：该命令可以<strong>强制对</strong><strong>mymaster</strong><strong>执行故障转移，</strong>即便当前的主节点运行完好；例如，如果当前主节点所在机器即将报废，便可以提前通过failover命令进行故障转移。</p>\n<h2><a name=\"t42\"></a>2.  基本原理</h2>\n<p>关于哨兵的原理，关键是了解以下几个概念。</p>\n<p>（1）定时任务：每个哨兵节点维护了3个定时任务。定时任务的功能分别如下：通过向主从节点发送info命令获取最新的主从结构；通过发布订阅功能获取其他哨兵节点的信息；通过向其他节点发送ping命令进行心跳检测，判断是否下线。</p>\n<p>（2）主观下线：在心跳检测的定时任务中，如果其他节点超过一定时间没有回复，哨兵节点就会将其进行主观下线。顾名思义，主观下线的意思是一个哨兵节点“主观地”判断下线；与主观下线相对应的是客观下线。</p>\n<p>（3）客观下线：哨兵节点在对主节点进行主观下线后，会通过sentinel is-master-down-by-addr命令询问其他哨兵节点该主节点的状态；如果判断主节点下线的哨兵数量达到一定数值，则对该主节点进行客观下线。</p>\n<p><strong>需要特别注意的是，客观下线是主节点才有的概念；如果从节点和哨兵节点发生故障，被哨兵主观下线后，不会再有后续的客观下线和故障转移操作。</strong></p>\n<p>（4）选举领导者哨兵节点：当主节点被判断客观下线以后，各个哨兵节点会进行协商，选举出一个领导者哨兵节点，并由该领导者节点对其进行故障转移操作。</p>\n<p>监视该主节点的所有哨兵都有可能被选为领导者，选举使用的算法是Raft算法；Raft算法的基本思路是先到先得：即在一轮选举中，哨兵A向B发送成为领导者的申请，如果B没有同意过其他哨兵，则会同意A成为领导者。选举的具体过程这里不做详细描述，一般来说，哨兵选择的过程很快，谁先完成客观下线，一般就能成为领导者。</p>\n<p>（5）故障转移：选举出的领导者哨兵，开始进行故障转移操作，该操作大体可以分为3个步骤：</p>\n<ul>\n<li>在从节点中选择新的主节点：选择的原则是，首先过滤掉不健康的从节点；然后选择优先级最高的从节点(由slave-priority指定)；如果优先级无法区分，则选择复制偏移量最大的从节点；如果仍无法区分，则选择runid最小的从节点。</li>\n<li>更新主从状态：通过slaveof no one命令，让选出来的从节点成为主节点；并通过slaveof命令让其他节点成为其从节点。</li>\n<li>将已经下线的主节点(即6379)设置为新的主节点的从节点，当6379重新上线后，它会成为新的主节点的从节点。</li>\n</ul>\n<p>通过上述几个关键概念，可以基本了解哨兵的工作原理。为了更形象的说明，下图展示了领导者哨兵节点的日志，包括从节点启动到完成故障转移。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8a6ded5ebf9eab9d29ee1926b1a4a0a4.png\" alt=\"\"></p>\n<h1><a name=\"t5\"></a>五、配置与实践建议</h1>\n<h2><a name=\"t51\"></a>1.  配置</h2>\n<p>下面介绍与哨兵相关的几个配置。</p>\n<p>（1） sentinel monitor {masterName} {masterIp} {masterPort} {quorum}</p>\n<p>sentinel monitor是哨兵最核心的配置，在前文讲述部署哨兵节点时已说明，其中：masterName指定了主节点名称，masterIp和masterPort指定了主节点地址，quorum是判断主节点客观下线的哨兵数量阈值：当判定主节点下线的哨兵数量达到quorum时，对主节点进行客观下线。建议取值为哨兵数量的一半加1。</p>\n<p>（2） sentinel down-after-milliseconds {masterName} {time}</p>\n<p>sentinel down-after-milliseconds与主观下线的判断有关：哨兵使用ping命令对其他节点进行心跳检测，如果其他节点超过down-after-milliseconds配置的时间没有回复，哨兵就会将其进行主观下线。该配置对主节点、从节点和哨兵节点的主观下线判定都有效。</p>\n<p>down-after-milliseconds的默认值是30000，即30s；可以根据不同的网络环境和应用要求来调整：值越大，对主观下线的判定会越宽松，好处是误判的可能性小，坏处是故障发现和故障转移的时间变长，客户端等待的时间也会变长。例如，如果应用对可用性要求较高，则可以将值适当调小，当故障发生时尽快完成转移；如果网络环境相对较差，可以适当提高该阈值，避免频繁误判。</p>\n<p>（3） sentinel parallel-syncs {masterName} {number}</p>\n<p>sentinel parallel-syncs与故障转移之后从节点的复制有关：它规定了每次向新的主节点发起复制操作的从节点个数。例如，假设主节点切换完成之后，有3个从节点要向新的主节点发起复制；如果parallel-syncs=1，则从节点会一个一个开始复制；如果parallel-syncs=3，则3个从节点会一起开始复制。</p>\n<p>parallel-syncs取值越大，从节点完成复制的时间越快，但是对主节点的网络负载、硬盘负载造成的压力也越大；应根据实际情况设置。例如，如果主节点的负载较低，而从节点对服务可用的要求较高，可以适量增加parallel-syncs取值。parallel-syncs的默认值是1。</p>\n<p>（4） sentinel failover-timeout {masterName} {time}</p>\n<p>sentinel failover-timeout与故障转移超时的判断有关，但是该参数不是用来判断整个故障转移阶段的超时，而是其几个子阶段的超时，例如如果主节点晋升从节点时间超过timeout，或从节点向新的主节点发起复制操作的时间(不包括复制数据的时间)超过timeout，都会导致故障转移超时失败。</p>\n<p>failover-timeout的默认值是180000，即180s；如果超时，则下一次该值会变为原来的2倍。</p>\n<p>（5）除上述几个参数外，还有一些其他参数，如安全验证相关的参数，这里不做介绍。</p>\n<h2><a name=\"t52\"></a>2.  实践建议</h2>\n<p>（1）哨兵节点的数量应不止一个，一方面增加哨兵节点的冗余，避免哨兵本身成为高可用的瓶颈；另一方面减少对下线的误判。此外，这些不同的哨兵节点应部署在不同的物理机上。</p>\n<p>（2）哨兵节点的数量应该是奇数，便于哨兵通过投票做出“决策”：领导者选举的决策、客观下线的决策等。</p>\n<p>（3）各个哨兵节点的配置应一致，包括硬件、参数等；此外，所有节点都应该使用ntp或类似服务，保证时间准确、一致。</p>\n<p>（4）哨兵的配置提供者和通知客户端功能，需要客户端的支持才能实现，如前文所说的Jedis；如果开发者使用的库未提供相应支持，则可能需要开发者自己实现。</p>\n<p>（5）当哨兵系统中的节点在docker（或其他可能进行端口映射的软件）中部署时，应特别注意端口映射可能会导致哨兵系统无法正常工作，因为哨兵的工作基于与其他节点的通信，而docker的端口映射可能导致哨兵无法连接到其他节点。例如，哨兵之间互相发现，依赖于它们对外宣称的IP和port，如果某个哨兵A部署在做了端口映射的docker中，那么其他哨兵使用A宣称的port无法连接到A。</p>\n<h1><a name=\"t6\"></a>六、总结</h1>\n<p>本文首先介绍了哨兵的作用：监控、故障转移、配置提供者和通知；然后讲述了哨兵系统的部署方法，以及通过客户端访问哨兵系统的方法；再然后简要说明了哨兵实现的基本原理；最后给出了关于哨兵实践的一些建议。</p>\n<p>在主从复制的基础上，哨兵引入了主节点的自动故障转移，进一步提高了Redis的高可用性；但是哨兵的缺陷同样很明显：哨兵无法对从节点进行自动故障转移，在读写分离场景下，从节点故障会导致读服务不可用，需要我们对从节点做额外的监控、切换操作。</p>\n<p>此外，哨兵仍然没有解决写操作无法负载均衡、及存储能力受到单机限制的问题；这些问题的解决需要使用集群，我将在后面的文章中介绍，欢迎关注。</p>\n<h1>参考文献</h1>\n<p><a href=\"https://redis.io/topics/sentinel\">https://redis.io/topics/sentinel</a></p>\n<p><a href=\"http://www.redis.cn/\">http://www.redis.cn/</a></p>\n<p>《Redis开发与运维》</p>\n<p>《Redis设计与实现》</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114382\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114382votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114382\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"},{"url_object_id": "adca6f2c20879c254551f23b464e5dfe", "title": "差异文件（diff）和补丁文件（patch）简介", "url": "http://blog.jobbole.com/114385/", "create_date": "2018/09/15", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/3e2e21811bc26c0e4b76ce72d72cb95b.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/8/diffs-patches\">Phil Estes</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10005-1.html\">Linux中国/DavidChenLiang</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/3e2e21811bc26c0e4b76ce72d72cb95b.jpg\"></p>\n<p>如果你曾有机会在一个使用分布式开发模型的大型代码库上工作过，你就应该听说过类似下面的话，“Sue 刚发过来一个补丁patch”，“Rajiv 正在签出checking out差异diff”, 可能这些词（补丁、差异文件）对你而言很陌生，而你确定很想搞懂他们到底指什么。开源软件对上述提到的名词有很大的贡献，作为大型项目从 Apache web 服务器到 Linux 内核的开发模型，“基于补丁文件的开发” 这一模式贯穿了上述项目的始终。实际上，你可能不知道 Apache 的名字就来自“一系列的代码补丁”（LCTT 译注：Apache 英文发音和补丁的英文 patch 相似)，它们被一一收集起来并针对原来的 <a href=\"https://github.com/TooDumbForAName/ncsa-httpd\">NCSA HTTPd server source code</a> 进行了修订。</p>\n<p>你可能认为这只不过是些逸闻，但是一份早期的 <a href=\"https://web.archive.org/web/19970615081902/http:/www.apache.org/info.html\">Apache 网站的存档中</a> 声称 Apache 的名字就是来自于最早的“补丁”集合；即“打了补丁的APAtCHy”服务器，简化为 Apache。</p>\n<p>好了，言归正传，程序员嘴里说的“差异”和“补丁”到底是什么？</p>\n<p>首先，在这篇文章里，我们可以认为这两个术语都指向同一个概念。“diff” 是 ”difference“ 的简写；Unix 下的同名工具程序 <code>diff</code>剖析了一个或多个文件之间的“差异”。下面我们会看到 <code>diff</code> 的例子:</p>\n<p>一个“补丁”指的是文件之间一系列差异，这些差异能被 Unix 的 <code>diff</code> 程序应用在源代码树上。我们能使用 <code>diff</code> 工具来创建“差异”（或“补丁”），然后使用该工具将它们 “打” 在一个没有这个补丁的同样的源代码版本上。此外，（我又要开始跑题说些历史轶事了……），“补丁” 这个词真的指在计算机的早期使用打卡机的时候，用来覆盖在打孔纸带上来对软件进行修改的覆盖纸，那个时代打孔纸带就是在计算机处理器上运行的程序。下面来自 <a href=\"https://en.wikipedia.org/wiki/Patch_(computing)\">维基页面</a> 的这张图真切的描绘了最初的“打补丁”这个词的出处:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f87c32c99b1a3572a394387d6b5386df.jpg\" alt=\"\"></p>\n<p>现在你对补丁和差异就了一个基本的概念，让我们来看看软件开发者是怎么使用这些工具的。如果你还没有使用过类似于 <a href=\"https://git-scm.com/\">Git</a> 或 <a href=\"https://subversion.apache.org/\">subversion</a> 这样的源代码版本控制工具的话，我将会一步步展示最流行的软件项目是怎么使用它们的。如果你将一个软件的生命周期看成是一条时间线的话，你就能看见这个软件的点滴变化，比如在何时源代码加上了一个功能，在何时源代码修复了一个功能缺陷。我们称这些改变的点为“提交commit”，“提交”这个词被当今最流行的源代码版本管理工具 Git 所使用，当你想检查在一个提交前后的代码变化的话，（或者在许多个提交之间的代码变化），你都可以使用工具来观察文件差异。</p>\n<p>如果你同样在使用 Git 开发软件的话，你可以在你的本地开发环境做些希望交给别的开发者的提交，以添加到他们的源代码树中。为了给别的开发者你的提交，一个方法就是创建一个你本地文件的差异文件，然后将这个“补丁”发送给和你工作在同一个源代码树的别的开发者。别的开发者在“打”了你的补丁之后，就能看到在你的代码变树上的变化。</p>\n<h3 id=\"toc_1\">Linux、Git 和 GitHub</h3>\n<p>这种分享补丁的开发模型正是现今 Linux 内核社区如何处理内核修改提议而采用的模型。如果你有机会浏览任何一个主流的 Linux 内核邮件列表 —— 主要是 <a href=\"https://lkml.org/\">LKML</a>，也包括 <a href=\"https://lists.linuxfoundation.org/pipermail/containers/\">linux-containers</a>、<a href=\"https://patchwork.kernel.org/project/linux-fsdevel/list/\">fs-devel</a>、<a href=\"https://www.spinics.net/lists/netdev/\">Netdev</a> 等等，你能看到很多开发者会贴出他们想让其他内核开发者审核、测试或者合入 Linux 官方 Git 代码树某个位置的补丁。当然，讨论 Git 不在这篇文章范围之内（Git 是由 Linus Torvalds 开发的源代码控制系统，它支持分布式开发模型以及允许独立于主要代码仓库的补丁包，这些补丁包能被推送或拉取到不同的源代码树上，并遵守这些代码树各自的开发流程。）</p>\n<p>在继续我们的话题之前，我们当然不能忽略和补丁和差异这个概念相关的最流行的服务：<a href=\"https://github.com/\">GitHub</a>。从它的名字就能猜想出 GitHub 是基于 Git 的，而且它还围绕着 Git 对分布式开源代码开发模型提供了基于 Web 和 API 的工作流管理。（LCTT 译注：即拉取请求Pull Request）。在 GitHub 上，分享补丁的方式不是像 Linux 内核社区那样通过邮件列表，而是通过创建一个 <strong>拉取请求</strong> 。当你提交你自己的源代码树的改动时，你能通过创建一个针对软件项目的共享仓库的“拉取请求”来分享你的代码改动（LCTT 译注：即核心开发者维护一个主仓库，开发者去“复刻fork”这个仓库，待各自的提交后再创建针对这个主仓库的拉取请求，所有的拉取请求由主仓库的核心开发者批准后才能合入主代码库。）GitHub 被当今很多活跃的开源社区所采用，如 <a href=\"https://kubernetes.io/\">Kubernetes</a>、<a href=\"https://www.docker.com/\">Docker</a>、<a href=\"https://github.com/containernetworking/cni\">容器网络接口 (CNI)</a>、<a href=\"https://istio.io/\">Istio</a> 等等。在 GitHub 的世界里，用户会倾向于使用基于 Web 页面的方式来审核一个拉取请求里的补丁或差异，你也可以直接访问原始的补丁并在命令行上直接使用它们。</p>\n<h3 id=\"toc_2\">该说点干货了</h3>\n<p>我们前面已经讲了在流行的开源社区里是怎么应用补丁和差异的，现在看看一些例子。</p>\n<p>第一个例子包括一个源代码树的两个不同副本，其中一个有代码改动，我们想用 <code>diff</code> 来看看这些改动是什么。这个例子里，我们想看的是“合并格式unified”的补丁，这是现在软件开发世界里最通用的格式。如果想知道更详细参数的用法以及如何生成差异文件，请参考 <code>diff</code> 手册。原始的代码在 <code>sources-orig</code> 目录，而改动后的代码在 <code>sources-fixed</code> 目录。如果要在你的命令行上用“合并格式”来展示补丁，请运行如下命令。（LCTT 译注：参数 <code>-N</code> 代表如果比较的文件不存在，则认为是个空文件， <code>-a</code> 代表将所有文件都作为文本文件对待，<code>-u</code> 代表使用合并格式并输出上下文，<code>-r</code> 代表递归比较目录）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cb2d3a577145840\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ diff -Naur sources-orig/ sources-fixed/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d3a577145840-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d3a577145840-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Naur </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fixed</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>……下面是 <code>diff</code> 命令的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cb2d48904310768\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndiff -Naur sources-orig/officespace/interest.go sources-fixed/officespace/interest.go\r\n--- sources-orig/officespace/interest.go        2018-08-10 16:39:11.000000000 -0400\r\n+++ sources-fixed/officespace/interest.go       2018-08-10 16:39:40.000000000 -0400\r\n&lt;a href=\"http://www.jobbole.com/members/weiboyutao1302\"&gt;@@&lt;/a&gt; -11,15 +11,13 &lt;a href=\"http://www.jobbole.com/members/weiboyutao1302\"&gt;@@&lt;/a&gt;\r\n   InterestRate float64\r\n }\r\n\r\n+// compute the rounded interest for a transaction\r\n func computeInterest(acct *Account, t Transaction) float64 {\r\n\r\n   interest := t.Amount * t.InterestRate\r\n   roundedInterest := math.Floor(interest*100) / 100.0\r\n   remainingInterest := interest - roundedInterest\r\n\r\n-  // a little extra..\r\n-  remainingInterest *= 1000\r\n-\r\n   // Save the remaining interest into an account we control:\r\n   acct.Balance = acct.Balance + remainingInterest</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d48904310768-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d48904310768-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-1\"><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Naur </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">go </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fixed</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">go</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-2\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">go</span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11.000000000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-3\"><span class=\"crayon-o\">++</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fixed</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">go</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">39</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40.000000000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/weiboyutao1302\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">13</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/weiboyutao1302\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-5\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">InterestRate </span><span class=\"crayon-i\">float64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-6\"> <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-8\"><span class=\"crayon-o\">+</span><span class=\"crayon-c\">// compute the rounded interest for a transaction</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-9\"> <span class=\"crayon-e\">func </span><span class=\"crayon-e\">computeInterest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">acct *</span><span class=\"crayon-v\">Account</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Transaction</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">float64</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-11\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">interest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Amount *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">InterestRate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-12\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">roundedInterest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">interest*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100.0</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-13\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">remainingInterest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">interest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">roundedInterest</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-14\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-15\"><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span> <span class=\"crayon-c\">// a little extra..</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-16\"><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span> <span class=\"crayon-e \">remainingInterest *</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-17\"><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d48904310768-18\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-c\">// Save the remaining interest into an account we control:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d48904310768-19\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">acct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">acct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">remainingInterest</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0070 seconds] -->\r\n<p>最开始几行 <code>diff</code> 命令的输出可以这样解释：三个 <code>---</code> 显示了原来文件的名字；任何在原文件（LCTT 译注：不是源文件）里存在而在新文件里不存在的行将会用前缀 <code>-</code>，用来表示这些行被从源代码里“减去”了。而 <code>+++</code> 表示的则相反：在新文件里被加上的行会被放上前缀 <code>+</code>，表示这是在新文件里被“加上”的行。补丁文件中的每一个补丁“块”（用 <code>@@</code> 作为前缀的的部分）都有上下文的行号，这能帮助补丁工具（或其它处理器）知道在代码的哪里应用这个补丁块。你能看到我们已经修改了“Office Space”这部电影里提到的那个函数（移除了三行并加上了一行代码注释），电影里那个有点贪心的工程师可是偷偷的在计算利息的函数里加了点“料”哦。（LCTT译注：剧情详情请见电影 <a href=\"https://movie.douban.com/subject/1296424/%EF%BC%89\">https://movie.douban.com/subject/1296424/）</a></p>\n<p>如果你想找人来测试你的代码改动，你可以将差异保存到一个补丁里：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cb2d4e025728604\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ diff -Naur sources-orig/ sources-fixed/ &gt;myfixes.patch</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d4e025728604-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d4e025728604-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Naur </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">orig</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sources</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fixed</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">myfixes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">patch</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>现在你有补丁 <code>myfixes.patch</code> 了，你能把它分享给别的开发者，他们可以将这个补丁打在他们自己的源代码树上从而得到和你一样的代码并测试他们。如果一个开发者的当前工作目录就是他的源代码树的根的话，他可以用下面的命令来打补丁：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cb2d52446125454\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ patch -p1 &lt; ../myfixes.patch\r\npatching file officespace/interest.go</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d52446125454-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d52446125454-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d52446125454-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">patch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">myfixes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">patch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d52446125454-2\"><span class=\"crayon-e\">patching </span><span class=\"crayon-e\">file </span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">go</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>现在这个开发者的源代码树已经打好补丁并准备好构建和测试文件的修改了。那么如果这个开发者在打补丁之前已经改动过了怎么办？只要这些改动没有直接冲突（LCTT 译注：比如改在同一行上），补丁工具就能自动的合并代码的改动。例如下面的interest.go 文件，它有其它几处改动，然后它想打上 <code>myfixes.patch</code> 这个补丁：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cb2d55264556849\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ patch -p1 &lt; ../myfixes.patch\r\npatching file officespace/interest.go\r\nHunk #1 succeeded at 26 (offset 15 lines).</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d55264556849-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cb2d55264556849-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cb2d55264556849-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d55264556849-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">patch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">myfixes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">patch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cb2d55264556849-2\"><span class=\"crayon-e\">patching </span><span class=\"crayon-e\">file </span><span class=\"crayon-v\">officespace</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">interest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">go</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cb2d55264556849-3\"><span class=\"crayon-v\">Hunk</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#1 succeeded at 26 (offset 15 lines).</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0119 seconds] -->\r\n<p>在这个例子中，补丁警告说代码改动并不在文件原来的地方而是偏移了 15 行。如果你文件改动的很厉害，补丁可能干脆说找不到要应用的地方，还好补丁程序提供了提供了打开“模糊”匹配的选项（这个选项在文档里有预置的警告信息，对其讲解已经超出了本文的范围）。</p>\n<p>如果你使用 Git 或者 GitHub 的话，你可能不会直接使用补丁或差异。Git 已经内置了这些功能，你能使用这些功能和共享一个源代码树的其他开发者交互，拉取或合并代码。Git 一个比较相近的功能是可以使用 <code>git diff</code> 来对你的本地代码树生成全局差异，又或者对你的任意两次”引用“（可能是一个代表提交的数字，或一个标记或分支的名字，等等）做全局补丁。你甚至能简单的用管道将 <code>git diff</code> 的输出到一个文件里（这个文件必须严格符合将要被使用它的程序的输入要求），然后将这个文件交给一个并不使用 Git 的开发者应用到他的代码上。当然，GitHub 把这些功能放到了 Web 上，你能直接在 Web 页面上查看一个拉取请求的文件变动。在 Web 上你能看到所展示的合并差异，GitHub 还允许你将这些代码改动下载为原始的补丁文件。</p>\n<h3 id=\"toc_3\">总结</h3>\n<p>好了，你已经学到了”差异“和”补丁“是什么，以及在 Unix/Linux 上怎么使用命令行工具和它们交互。除非你还在像 Linux 内核开发这样的项目中工作而使用完全基于补丁文件的开发方式，你应该会主要通过你的源代码控制系统（如 Git）来使用补丁。但熟悉像 GitHub 这样的高级别工具的技术背景和技术底层对你的工作也是大有裨益的。谁知道会不会有一天你需要和一个来自 Linux 世界邮件列表的补丁包打交道呢？</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114385\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114385votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114385\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/eb506ae0667dbbe488b212b50ee2a090282746df.jpg"},{"url_object_id": "c528881ac1c8d1c7d99e285d0256bff1", "title": "Vim 代码片段插件 Ultisnips 使用教程", "url": "http://blog.jobbole.com/114334/", "create_date": "2018/09/03", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/04/vim-logo.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Vim", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/keelii\">keelii</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><h2 id=\"安装\">安装</h2>\n<p><a href=\"https://github.com/SirVer/ultisnips\">Ultisnips</a> 插件安装分两部分，一个是 ultisnips 插件本身，另外一个是代码片段仓库。一般来说把默认的代码片段仓库下载下来按需修改后上传到自己的 github 即可。如果你和我一样也使用 vim-plug 来管理插件的话，添加下面的代码到你的 vimrc 中保存刷新即可</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46d5849813076\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPlug 'SirVer/ultisnips'\r\n# 你自己的代码仓库 git 地址\r\nPlug 'keelii/vim-snippets'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46d5849813076-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46d5849813076-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46d5849813076-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46d5849813076-1\"><span class=\"crayon-i\">Plug</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SirVer/ultisnips'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46d5849813076-2\"><span class=\"crayon-p\"># 你自己的代码仓库 git 地址</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46d5849813076-3\"><span class=\"crayon-i\">Plug</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'keelii/vim-snippets'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>上面的示例中所有的代码片段都存放在插件安装目录下面的 <code>vim-snippets/UltiSnips</code> 中，文件命名格式为 <code>ft</code>.snippets, <code>ft</code> 就是 vim 中的 <code>filetype</code>，其中有个 <code>all.snippets</code> 是唯一一个所有文件都适用的代码片段</p>\n<h2 id=\"配置\">配置</h2>\n<p>快捷键设置，我一般使用 tab 来触发代码片段补全，<strong>且不使用 YCM</strong> （官方文档表示使用YCM的话就不能使用tab补全）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46de325589175\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlet g:UltiSnipsExpandTrigger=\"&lt;tab&gt;\"\r\n\" 使用 tab 切换下一个触发点，shit+tab 上一个触发点\r\nlet g:UltiSnipsJumpForwardTrigger=\"&lt;tab&gt;\"\r\nlet g:UltiSnipsJumpBackwardTrigger=\"&lt;S-tab&gt;\"\r\n\" 使用 UltiSnipsEdit 命令时垂直分割屏幕\r\nlet g:UltiSnipsEditSplit=\"vertical\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46de325589175-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46de325589175-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46de325589175-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46de325589175-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46de325589175-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46de325589175-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46de325589175-1\"><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">UltiSnipsExpandTrigger</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"&lt;tab&gt;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46de325589175-2\"><span class=\"crayon-s\">\" 使用 tab 切换下一个触发点，shit+tab 上一个触发点</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46de325589175-3\"><span class=\"crayon-s\">let g:UltiSnipsJumpForwardTrigger=\"</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">tab</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46de325589175-4\"><span class=\"crayon-s\">let g:UltiSnipsJumpBackwardTrigger=\"</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">S</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tab</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46de325589175-5\"><span class=\"crayon-s\">\"</span><span class=\"crayon-h\"> </span>使用<span class=\"crayon-h\"> </span><span class=\"crayon-i\">UltiSnipsEdit</span><span class=\"crayon-h\"> </span>命令时垂直分割屏幕</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46de325589175-6\"><span class=\"crayon-i\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">UltiSnipsEditSplit</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"vertical\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h2 id=\"依赖\">依赖</h2>\n<p>ultisnips 插件需要你的 vim 支持 python，可以在 vim 命令模式下使用下面的检测你的 vim 版本是否支持 python</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46e3488841985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 1 表示支持\r\n:echo has(\"python\")\r\n:echo has(\"python3\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46e3488841985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46e3488841985-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46e3488841985-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46e3488841985-1\"><span class=\"crayon-p\"># 1 表示支持</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46e3488841985-2\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">has</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"python\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46e3488841985-3\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">has</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"python3\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"定义一个代码片段\">定义一个代码片段</h2>\n<h3 id=\"定义格式\">定义格式</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46e6611919701\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet 触发字符 [\"代码片段说明\" [参数]]\r\n代码片段内容\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46e6611919701-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46e6611919701-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46e6611919701-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46e6611919701-1\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span>触发字符<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"代码片段说明\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span>参数<span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46e6611919701-2\">代码片段内容</div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46e6611919701-3\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3 id=\"最小化的一个代码片段\">最小化的一个代码片段</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46e9822961977\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet if \"if (condition) { ... }\"\r\nif (${1:true}) {\r\n    $0\r\n}\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46e9822961977-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46e9822961977-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46e9822961977-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46e9822961977-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46e9822961977-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46e9822961977-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"if (condition) { ... }\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46e9822961977-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46e9822961977-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46e9822961977-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46e9822961977-5\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>这时当你在 vim 中输入 if 敲 tab 就会展开一条 if 语句，第一个触发点是 if 条件表达式，最后一个是 if 语句体</p>\n<p><code>${1:true}</code> 表示这是第一个触发点，占位符为 <code>true</code>，如果占位符没有默认值可直接使用 <code>$1</code>, <code>$2</code>, <code>$3</code>…</p>\n<h2 id=\"可视选择区的内容为占位符\">可视选择区的内容为占位符</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46ed695533451\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet if \"if (...)\"\r\nif (${1:true}) {\r\n    ${VISUAL}\r\n}\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46ed695533451-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46ed695533451-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46ed695533451-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46ed695533451-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46ed695533451-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46ed695533451-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"if (...)\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46ed695533451-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46ed695533451-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">VISUAL</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46ed695533451-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46ed695533451-5\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><code>${VISUAL}</code> 表示在 vim 中使用可视模式下选择的文本，这个在重构代码的时候<strong>非常有用</strong>（<a href=\"https://keelii.com/2018/08/26/vim-plugin-ultisnips-advanced-tips/\">后面会有高级用法</a>），上个图感受一下：</p>\n<p><img src=\"//img10.360buyimg.com/devfe/jfs/t25252/299/1019207883/36468/bca93de/5b84a8a9N8dd5a8c5.gif\" alt=\"if-with-visual-mode\"></p>\n<h2 id=\"代码片段的参数\">代码片段的参数</h2>\n<ul>\n<li><code>b</code> 表示触发字符应该在一行的开始</li>\n<li><code>i</code> 表示触发字符可以在单词内（连续展示会使用这个选项）</li>\n<li><code>w</code> 表示触发字符的前后必须是一个字母分界点</li>\n<li><code>r</code> 表示触发字符可以是一个正则表达式</li>\n<li><code>t</code> 表示展开的代码片段中如果有制表符，原样输出，即使你的 vimrc 里面设置了 expandtab</li>\n<li><code>m</code> 表示删除代码片段右边的所有空白字符</li>\n<li><code>e</code> 表示自定义上下文</li>\n<li><code>A</code> 表示自动触发，不需要按 tab，类似于 VIM 中的 abbr</li>\n</ul>\n<h2 id=\"内容解释器\">内容解释器</h2>\n<p>Ultisnips 定义的代码片段中支持三种不同的语言注入：shell, vimscript, python，在代码片段中用反引号表示</p>\n<h2 id=\"shell-代码\">shell 代码</h2>\n<p>就是在你的命令行 shell 能执行的代码片段，比如输出当前时间</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46f1037264055\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n➜ date\r\n2018年 8月27日 星期一 18时19分38秒 CST</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46f1037264055-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46f1037264055-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46f1037264055-1\">➜<span class=\"crayon-h\"> </span><span class=\"crayon-i\">date</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46f1037264055-2\"><span class=\"crayon-cn\">2018</span>年<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span>月<span class=\"crayon-cn\">27</span>日<span class=\"crayon-h\"> </span>星期一<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span>时<span class=\"crayon-cn\">19</span>分<span class=\"crayon-cn\">38</span>秒<span class=\"crayon-h\"> </span><span class=\"crayon-v\">CST</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>在代码片段中用反引号「`」引用即可</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46f5254537494\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet today\r\nToday is the `date`.\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46f5254537494-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46f5254537494-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46f5254537494-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46f5254537494-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-e\">today</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46f5254537494-2\"><span class=\"crayon-e\">Today </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">the</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46f5254537494-3\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输入 today 按 tab 展开后（格式和上面shell中的不一样，估计是因为 vim 语言设置的问题）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46f8676308520\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nToday is the Mon Aug 27 18:24:51 CST 2018.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46f8676308520-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46f8676308520-1\"><span class=\"crayon-e\">Today </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Mon </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">51</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">CST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3 id=\"vimscript-代码\">vimscript 代码</h3>\n<p>使用 <code>indent</code> 来输出当前缩进值，使用前缀 <code>!v</code> 表示是 vimscript</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce46fb922591493\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet indent\r\nIndent is: `!v indent(\".\")`.\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46fb922591493-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce46fb922591493-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce46fb922591493-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce46fb922591493-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-e\">indent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce46fb922591493-2\"><span class=\"crayon-e\">Indent </span><span class=\"crayon-st\">is</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">indent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\".\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce46fb922591493-3\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><img src=\"//img12.360buyimg.com/devfe/jfs/t23467/4/2565317844/22166/a39566b/5b84a97fNa6174311.gif\" alt=\"vimscript-indent-size\"></p>\n<h3 id=\"python-代码\">python 代码</h3>\n<p>在代码片段中解释执行 python 代码是 ultisnips 最强大的功能，以前缀 <code>!p</code> 开始。系统会向 python 中注入一些变量，可以使用 python 代码直接对其进行操作</p>\n<ul>\n<li><code>fn</code> – 表示当前文件名</li>\n<li><code>path</code> – 当前文件名的路径</li>\n<li><code>t</code> – 占位符的字典，可以使用 <code>t[1], t[2], t.v</code> 来取占位符内容</li>\n<li><code>snip</code> – <a href=\"https://github.com/SirVer/ultisnips/blob/6fdc3647f72e0a1f321ea6bd092ecd01f7c187ba/pythonx/UltiSnips/text_objects/_python_code.py#L56\">UltiSnips.TextObjects.SnippetUtil</a> 对象的一个实例</li>\n<li><code>match</code> – 正则代码片段时返回的匹配元素（非常强大）</li>\n</ul>\n<p>其中最常用的 <code>snip</code> 对象提供了下面一些变量：</p>\n<ul>\n<li><code>snip.rv</code> 表示 return value，python 代码执行后处理过的字符串赋给 rv 即可</li>\n<li><code>snip.fn</code> 表示当前文件名</li>\n<li><code>snip.ft</code> 表示当前文件类型</li>\n<li><code>snip.v</code> 表示 VISUAL 模式变量，其中 <code>snip.v.mode</code> 表示模式类型，<code>snip.v.text</code> 表示 VISUAL 模式中选择的字符</li>\n</ul>\n<p><img src=\"//img11.360buyimg.com/devfe/jfs/t27739/311/103185395/173892/d6a786e3/5b84af90Nfa6cd193.gif\" alt=\"python-snippet-var\"></p>\n<h2 id=\"占位符选择\">占位符选择</h2>\n<p>UltiSnips 支持使用快捷键切换占位符，我使用 <code>&lt;tab&gt;</code> 和 <code>&lt;shift-tab&gt;</code> 来切换 <code>下一个</code> 和 <code>上一个</code>占位符，占位符切换的作用域为当前代码片段内部（即使占位符已被修改过），当光标移动出去以后就不起作用了</p>\n<p><img src=\"//img12.360buyimg.com/devfe/jfs/t24559/158/2571218888/171431/2459a91d/5b84bf9aN96a7ee7e.gif\" alt=\"mul-placeholder-editing\"></p>\n<h2 id=\"自定义上下文\">自定义上下文</h2>\n<p>自定义上下文可以通过正则匹配来决定代码片断是否可用，比如判断在指定的 if 语句里面才起作用的代码片断，定义格式如下：</p>\n<blockquote><p>snippet 触发字符 “描述” “表达式” 参数</p></blockquote>\n<p>比如我们定义一个 <strong>只有</strong> 在上一行以 <code>if (DEVELOPMENT) {</code> 开头才可以展开的代码片段</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce4700960574476\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnippet dbg \"if (DEVELOPMENT) dbg\" \"re.match('^if <span class=\"MathJax_Preview\">\\(DEVELOPMENT\\)</span> \\{', snip.buffer[snip.line-1])\" be\r\ndebugger;\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4700960574476-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4700960574476-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4700960574476-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce4700960574476-1\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-i\">dbg</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"if (DEVELOPMENT) dbg\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"re.match('^if <span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">DEVELOPMENT</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span> \\{', snip.buffer[snip.line-1])\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4700960574476-2\"><span class=\"crayon-v\">debugger</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4700960574476-3\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0114 seconds] -->\r\n<p></p>\n<h2 id=\"常见用法\">常见用法</h2>\n<h3 id=\"行内连续展开\">行内连续展开</h3>\n<p>这个常见于需要连续展开代码片段的情况，比如，有两个片段，一个打印变量，一个处理 JSON 序列化。这时需要使用参数选项 <code>i</code>n-word</p>\n<p><img src=\"//img11.360buyimg.com/devfe/jfs/t25579/50/1036526670/419976/53521e3b/5b84c7d2Nd6a0cb5e.gif\" alt=\"continue-expand-snippets\"></p>\n<h3 id=\"使用正则代码片段\">使用正则代码片段</h3>\n<p>通常写代码的时候需要使用 log, print 等来打印上下文中的变量。使用普通片段按 cl 展示 console.log() 然后把变量字符复制进括号，这样操作会比较复杂。使用正则来动态匹配前面的字符可以很好的解决这个问题</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce4704429034250\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 展开 console.log\r\nsnippet \"([^\\s]\\w+)\\.log\" \"console.log(postfix)\" r\r\nconsole.log(`!p snip.rv = match.group(1)`)$0\r\nendsnippet\r\n# 当前行转换成大写\r\nsnippet \"([^\\s].*)\\.upper\" \"Uppercase(postfix)\" r\r\n`!p snip.rv = match.group(1).upper()`$0\r\nendsnippet\r\n# 上一个单词转换成小写\r\nsnippet \"([^\\s]\\w+)\\.lower\" \"Lowercase(postfix)\" r\r\n`!p snip.rv = match.group(1).lower()`$0\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4704429034250-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4704429034250-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4704429034250-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4704429034250-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4704429034250-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4704429034250-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4704429034250-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4704429034250-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4704429034250-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4704429034250-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4704429034250-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4704429034250-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce4704429034250-1\"><span class=\"crayon-p\"># 展开 console.log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4704429034250-2\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"([^\\s]\\w+)\\.log\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"console.log(postfix)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4704429034250-3\"><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">group</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4704429034250-4\"><span class=\"crayon-v\">endsnippet</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4704429034250-5\"><span class=\"crayon-p\"># 当前行转换成大写</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4704429034250-6\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"([^\\s].*)\\.upper\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Uppercase(postfix)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4704429034250-7\"><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">group</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">upper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4704429034250-8\"><span class=\"crayon-v\">endsnippet</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4704429034250-9\"><span class=\"crayon-p\"># 上一个单词转换成小写</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4704429034250-10\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"([^\\s]\\w+)\\.lower\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Lowercase(postfix)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4704429034250-11\"><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">group</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4704429034250-12\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>动图演示</p>\n<p><img src=\"//img30.360buyimg.com/devfe/jfs/t25492/223/971280921/61984/701b0ab1/5b84cc6aN6fe8ea04.gif\" alt=\"expand-regexp-snippets\"></p>\n<p><strong>注意</strong>：正则代码片段只适用于单行文本处理，如果是多行转换还是得用到下面的 python + VISUAL 代码片段来处理</p>\n<h3 id=\"使用-python-解释器-visual-模式实现代码注释功能\">使用 python 解释器 + VISUAL 模式实现代码注释功能</h3>\n<p>通常我们需要使用一大堆插件来实现各种代码的注释功能。不过 Ultisnips 提供了 VISUAL 模式可以提取 vim 可视模式中选择的内容到代码片段里面，于是我们就可以结合起来制作一个<strong>具有注释功能的代码片段</strong></p>\n<p>流程大概是这样的：</p>\n<ol>\n<li>进入 vim 可视模式，选择要注释的内容</li>\n<li>按 tab，清除选择内容</li>\n<li>输入代码片段触发字符，按 tab 完成</li>\n</ol>\n<p>由于实现的 python 代码相对复杂一些，主要分成两个方法。单行注释和多行注释，注意 Ultisnips 中可以直接写 python 但是大段的方法建议放在插件目录下面的 pythonx 目录下面，使用的时候在对应的代码片段中的全局 python 代码 <code>global !p</code> 引入即可</p>\n<p><strong>单行注释</strong>(pythonx/javascript_snippets.py)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce4709012611973\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef comment(snip, START=\"\", END=\"\"):\r\n    lines = snip.v.text.split('\\n')[:-1]\r\n    first_line = lines[0]\r\n    spaces = ''\r\n    initial_indent = snip._initial_indent\r\n\r\n    # Get the first non-empty line\r\n    for idx, l in enumerate(lines):\r\n        if l.strip() != '':\r\n            first_line = lines[idx]\r\n            sp = re.findall(r'^\\s+', first_line)\r\n            if len(sp):\r\n                spaces = sp[0]\r\n            break            \r\n\r\n    # Uncomment\r\n    if first_line.strip().startswith(START):\r\n        result = [line.replace(START, \"\", 1).replace(END, \"\", 1) if line.strip() else line for line in lines]\r\n    else:\r\n        result = [f'{spaces}{START}{line[len(spaces):]}{END}' if line.strip() else line for line in lines ]\r\n\r\n    # Remove initial indent\r\n    if result[0] and initial_indent:\r\n        result[0] = result[0].replace(initial_indent, '', 1)\r\n\r\n    if result:\r\n        return '\\n'.join(result)\r\n    else:\r\n        return ''</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4709012611973-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4709012611973-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">comment</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_initial_indent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Get the first non-empty line</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'^\\s+'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Uncomment</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">startswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{spaces}{START}{line[len(spaces):]}{END}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Remove initial indent</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4709012611973-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4709012611973-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0095 seconds] -->\r\n<p><strong>多行注释：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce470e015416856\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef comment_inline(snip, START=\"/* \", END=\" */\"):\r\n    text = snip.v.text\r\n    lines = text.split('\\n')[:-1]\r\n    first_line = lines[0]\r\n    initial_indent = snip._initial_indent\r\n    spaces = ''\r\n\r\n    # Get the first non-empty line\r\n    for idx, l in enumerate(lines):\r\n        if l.strip() != '':\r\n            first_line = lines[idx]\r\n            sp = re.findall(r'^\\s+', first_line)\r\n            if len(sp):\r\n                spaces = sp[0]\r\n            break            \r\n\r\n    if text.strip().startswith(START):\r\n        result = text.replace(START, '', 1).replace(END, '', 1)\r\n    else:\r\n        result = text.replace(spaces, spaces + START, 1).rstrip('\\n') + END + '\\n'\r\n\r\n    if initial_indent:\r\n        result = result.replace(initial_indent, '', 1)\r\n\r\n    return result</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce470e015416856-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce470e015416856-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">comment_inline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/* \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\" */\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_initial_indent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Get the first non-empty line</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'^\\s+'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_line</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-16\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">startswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spaces</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spaces</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rstrip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">initial_indent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce470e015416856-24\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363ce470e015416856-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p><strong>代码片段定义：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363ce4712335016231\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nglobal !p\r\nfrom javascript_snippets import (\r\n\tcomment, comment_inline\r\n)\r\nendglobal\r\n\r\n# ...\r\n\r\nsnippet c \"Toggle comment every single line\"\r\n`!p\r\nsnip.rv = comment(snip, START='// ', END='')\r\n`$0\r\nendsnippet\r\n\r\nsnippet ci \"Toggle comment inline.\"\r\n`!p\r\nsnip.rv = comment_inline(snip, START=\"/* \", END=\" */\")\r\n`$0\r\nendsnippet</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363ce4712335016231-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363ce4712335016231-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-1\"><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-2\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">javascript_snippets </span><span class=\"crayon-e\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">comment</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment</span><span class=\"crayon-sy\">_</span>inline</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-4\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-5\"><span class=\"crayon-v\">endglobal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-7\"><span class=\"crayon-p\"># ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-9\"><span class=\"crayon-i\">snippet</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Toggle comment every single line\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-10\"><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-11\"><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">comment</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'// '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-12\"><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-13\"><span class=\"crayon-e\">endsnippet</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-14\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-15\"><span class=\"crayon-e\">snippet </span><span class=\"crayon-i\">ci</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Toggle comment inline.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-16\"><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">!</span><span class=\"crayon-i\">p</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-17\"><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">comment_inline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">snip</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">START</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/* \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">END</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\" */\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363ce4712335016231-18\"><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363ce4712335016231-19\"><span class=\"crayon-v\">endsnippet</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>动图演示</p>\n<p><img src=\"//img30.360buyimg.com/devfe/jfs/t24175/330/2554434390/319822/5d8cf724/5b850d67N4c475946.gif\" alt=\"python-snippets-to-comment\"></p>\n<p>不同的语言可以在对应的片段文件中定义并传入注释符号参数即可，有了这个功能就可以愉快的删除其它的 vim 注释插件了 😀</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114334\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114334votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114334\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/keelii\">keelii</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/keelii\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/08/3b953d3d7c4ae0591aa2783678869f3b.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            It’s not who you are underneath, it’s what you do that defines you        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/keelii\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/keelii/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/keelii/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 5</a> · <a title=\"我的网站\" target=\"_blank\" href=\"https://keelii.github.io/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/keelii\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：keelii\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/keelii\"><i class=\"fa fa-github\"></i></a> <a title=\"Twitter主页\" target=\"_blank\" href=\"https://twitter.com/keelii\"><i class=\"fa fa-twitter\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/4c6abd763d27eeeb4c7e7665f213388ec74df623.jpg"},{"url_object_id": "fee3678ea1304e4cf45507e958bdfd90", "title": "当你「ping 一下」的时候，你知道它背后的逻辑吗？", "url": "http://blog.jobbole.com/114391/", "create_date": "2018/09/16", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/a1dc9868123d4debdf8ceb3c6bf4aae7.jpeg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,ping,网络", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://mp.weixin.qq.com/s/uN21-7jda-GwiUTZxJ8VeA\">奎哥（个人公号：不止思考）</a>   </div><section><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a1dc9868123d4debdf8ceb3c6bf4aae7.jpeg\">我们在遇到网络不通的情况，大家都知道去 ping 一下，看一下网络状况。<br>\n那你知道「ping」命令后背的逻辑是什么吗？知道它是如何实现的吗？\n<h4>一、「ping」命令的作用和原理？</h4>\n<p>简单来说，「ping」是用来探测本机与网络中另一主机之间是否可达的命令，如果两台主机之间ping不通，则表明这两台主机不能建立起连接。ping是定位网络通不通的一个重要手段。</p>\n<p>ping 命令是基于 ICMP 协议来工作的，「 ICMP 」全称为 Internet 控制报文协议（ Internet Control Message Protocol）。ping 命令会发送一份ICMP回显请求报文给目标主机，并等待目标主机返回ICMP回显应答。因为ICMP协议会要求目标主机在收到消息之后，必须返回ICMP应答消息给源主机，如果源主机在一定时间内收到了目标主机的应答，则表明两台主机之间网络是可达的。</p>\n<p>举一个例子来描述「ping」命令的工作过程：</p>\n<ol>\n<li>假设有两个主机，主机A（192.168.0.1）和主机B（192.168.0.2），现在我们要监测主机A和主机B之间网络是否可达，那么我们在主机A上输入命令：ping 192.168.0.2</li>\n<li>此时，ping命令会在主机A上构建一个 ICMP的请求数据包（数据包里的内容后面再详述），然后 ICMP协议会将这个数据包以及目标IP（192.168.0.2）等信息一同交给IP层协议。</li>\n<li>IP层协议得到这些信息后，将源地址（即本机IP）、目标地址（即目标IP：192.168.0.2）、再加上一些其它的控制信息，构建成一个IP数据包。</li>\n<li>IP数据包构建完成后，还不够，还需要加上MAC地址，因此，还需要通过ARP映射表找出目标IP所对应的MAC地址。当拿到了目标主机的MAC地址和本机MAC后，一并交给数据链路层，组装成一个数据帧，依据以太网的介质访问规则，将它们传送出出去。</li>\n<li>当主机B收到这个数据帧之后，会首先检查它的目标MAC地址是不是本机，如果是就接收下来处理，接收之后会检查这个数据帧，将数据帧中的IP数据包取出来，交给本机的IP层协议，然后IP层协议检查完之后，再将ICMP数据包取出来交给ICMP协议处理，当这一步也处理完成之后，就会构建一个ICMP应答数据包，回发给主机A</li>\n<li>在一定的时间内，如果主机A收到了应答包，则说明它与主机B之间网络可达，如果没有收到，则说明网络不可达。除了监测是否可达以外，还可以利用应答时间和发起时间之间的差值，计算出数据包的延迟耗时。</li>\n</ol>\n<p>通过ping的流程可以发现，ICMP协议是这个过程的基础，是非常重要的，因此下面就把ICMP协议再详细解释一下。</p>\n<h4>二、什么是「 ICMP 」？</h4>\n<p>我们知道，ping命令是基于ICMP协议来实现的。那么我们再来看下图，就明白了ICMP协议又是通过IP协议来发送的，即ICMP报文是封装在IP包中。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9914d7e09e99c91bbd01b7319ae69dd5.png\"></p>\n<p>IP协议是一种无连接的，不可靠的数据包协议，它并不能保证数据一定被送达，那么我们要保证数据送到就需要通过其它模块来协助实现，这里就引入的是ICMP协议。</p>\n<p>当传送的IP数据包发送异常的时候，ICMP就会将异常信息封装在包内，然后回传给源主机。</p>\n<p>将上图再细拆一下可见：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/07fec26e1798982f64ce024849953323.png\"></p>\n<p>继续将ICMP协议模块细拆:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/808e2c5410952ce5f6febde757a8db0c.png\"></p>\n<p>由图可知，ICMP数据包由8bit的类型字段和8bit的代码字段以及16bit的校验字段再加上选项数据组成。</p>\n<p>ICMP协议大致可分为两类：</p>\n<ul>\n<li><strong>查询报文类型</strong></li>\n<li><strong>差错报文类型</strong></li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/26a60a3588ca544272e90dc0d12ec0ba.png\"></p>\n<ol>\n<li><strong>查询报文类型</strong>：</li>\n</ol>\n<p>查询报文主要应用于：ping查询、子网掩码查询、时间戳查询等等。</p>\n<p>上面讲到的ping命令的流程其实就对应ICMP协议查询报文类型的一种使用。在主机A构建ICMP请求数据包的时候，其ICMP的类型字段中使用的是 8 （回送请求），当主机B构建ICMP应答包的时候，其ICMP类型字段就使用的是 0 （回送应答），更多类型值参考上表。</p>\n<p>对 查询报文类型 的理解可参考一下文章最开始讲的ping流程，这里就不做赘述。</p>\n<ol start=\"2\">\n<li><strong>差错报文类型</strong>：</li>\n</ol>\n<p>差错报文主要产生于当数据传送发送错误的时候。<br>\n它包括：目标不可达（网络不可达、主机不可达、协议不可达、端口不可达、禁止分片等）、超时、参数问题、重定向（网络重定向、主机重定向等）等等。</p>\n<p>差错报文通常包含了引起错误的IP数据包的第一个分片的IP首部，加上该分片数据部分的前8个字节。<br>\n当传送IP数据包发生错误的时候（例如 主机不可达），ICMP协议就会把错误信息封包，然后传送回源主机，那么源主机就知道该怎么处理了。</p>\n<p>那是不是只有遇到错误的时候才能使用 差错报文类型 呢？也不一定。</p>\n<p>Traceroute 就是一个例外，Traceroute是用来侦测源主机到目标主机之间所经过路由情况的常用工具。Traceroute 的原理就是利用ICMP的规则，制造一些错误的事件出来，然后根据错误的事件来评估网络路由情况。</p>\n<p>具体做法就是：</p>\n<p>Traceroute会设置特殊的TTL值，来追踪源主机和目标主机之间的路由数。首先它给目标主机发送一个 TTL=1 的UDP数据包，那么这个数据包一旦在路上遇到一个路由器，TTL就变成了0（TTL规则是每经过一个路由器都会减1），因为TTL=0了，所以路由器就会把这个数据包丢掉，然后产生一个错误类型（超时）的ICMP数据包回发给源主机，也就是差错包。这个时候源主机就拿到了第一个路由节点的IP和相关信息了。</p>\n<p>接着，源主机再给目标主机发一个 TTL=2 的UDP数据包，依旧上述流程走一遍，就知道第二个路由节点的IP和耗时情况等信息了。</p>\n<p>如此反复进行，Traceroute就可以拿到从主机A到主机B之间所有路由器的信息了。</p>\n<p>但是有个问题是，如果数据包到达了目标主机的话，即使目标主机接收到TTL值为1的IP数据包，它也是不会丢弃该数据包的，也不会产生一份超时的ICMP回发数据包的，因为数据包已经达到了目的地嘛。那我们应该怎么认定数据包是否达到了目标主机呢？</p>\n<p>Traceroute的方法是在源主机发送UDP数据包给目标主机的时候，会设置一个不可能达到的目标端口号（例如大于30000的端口号），那么当这个数据包真的到达目标主机的时候，目标主机发现没有对应的端口号，因此会产生一份“端口不可达”的错误ICMP报文返回给源主机。</p>\n<p>可见Traceroute的原理确实很取巧，很有趣。</p>\n<p>以上，就是对ping的基本原理以及ICMP协议的基本讲解了，欢迎大家一起交流。</p>\n</section>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114391\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114391votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114391\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e163dd0789f1114653a331123e2c76d7c34f8ebd.jpg"},{"url_object_id": "ef6e75a95b9067935c1a0f11772b2c0c", "title": "对比 Ubuntu 18.04 和 Fedora 28", "url": "http://blog.jobbole.com/114327/", "create_date": "2018/08/27", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/ddb1f665d74f913109feb4dfead998f1.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxandubuntu.com/home/ubuntu-1804-vs-fedora-28\">Linuxandubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9952-1.html\">Linux中国/Andy Song</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ddb1f665d74f913109feb4dfead998f1.jpg\"></p>\n<p>大家好，我准备在今天突出说明一下两大主流 Linux 发行版，即 <strong>Ubuntu 18.04</strong> 和 <strong>Fedora 28</strong>，包括一些特性和差异。两者都有各自的包管理系统，其中 Ubuntu 使用 DEB，Fedora 使用 RPM；但二者使用同样的<a href=\"http://www.linuxandubuntu.com/home/5-best-linux-desktop-environments-with-pros-cons\">桌面环境Desktop Environment</a> （DE）<a href=\"http://www.linuxandubuntu.com/home/walkthrough-on-how-to-use-gnome-boxes\">GNOME</a>，并致力于为 Linux 用户提供高品质的桌面体验desktop experience。</p>\n<p><strong>Ubuntu 18.04</strong> 是 Ubuntu 目前最新的 <a href=\"http://www.linuxandubuntu.com/home/ubuntu-1804-codename-announced-bionic-beaver\">长期支持版本Long Term Support</a>（LTS），为用户提供 GNOME 桌面系统。<strong>Fedora 28</strong> 也提供 GNOME 桌面系统，但落实到具体的软件包管理方面，二者的桌面体验存在差异；在用户界面User Interfaces方面也显然存在差异。</p>\n<h3 id=\"toc_1\">基本概念</h3>\n<p>不知你是否了解，虽然 Ubuntu 基于 Debian，但 Ubuntu 比 Debian 更早提供最新版本的软件。举个例子，当 Ubuntu 提供流行网页浏览器 Firefox Quantum 时，Debian 仍在提供 Firefox 的延期支持版Extended Support Release（ESR）。</p>\n<p>（LCTT 译注：从 2012 年 1 月开始，Firefox 进入快速版本期，每 6 周发布新的主线版本，每隔 7 个主线版本发布新的 ESR 版本。Firefox 57 的桌面版发布时被命名为 Firefox Quantum，同期的 ESR 版本与 Firefox 52 一同发布并基于 Firefox 48。参考 <a href=\"https://en.wikipedia.org/wiki/History_of_Firefox\">Wiki: History_of_Firefox</a>）</p>\n<p>同样的情况也适用于 Fedora，它为终端用户提供前沿的软件，也被用作下一个稳定版本的 RHEL (Red Hat Enterprise Linux) 的测试平台。</p>\n<h3 id=\"toc_2\">桌面预览</h3>\n<p>Fedora 提供原汁原味的vanilla GNOME 桌面体验；相比之下，Ubuntu 18.04 对 GNOME 做了若干方面的微调，以便长期以来的 Unity 用户可以平滑的过渡到 GNOME 桌面环境。</p>\n<p><em>为节省开发时间，Canonical （从 Ubuntu <a href=\"http://www.linuxandubuntu.com/home/what-new-is-going-to-be-in-ubuntu-1704-zesty-zapus\">17.10</a> 开始）已经决定放弃 Unity 并转向 GNOME 桌面，以便可以将更多精力投入到 IoT 领域。</em></p>\n<p>因此，在 Fedora 的桌面预览中，我们可以看到一个简洁的无图标桌面和一个自动隐藏的侧边栏，整体外观采用 GNOME 默认的 Adwaita 主题。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/ubuntu-18-04-gnome_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/34ff23eea5a5293be2e1e3357157a3d9.jpg\" alt=\"fedora 28 gnome\"></a></p>\n<p>相比之下，Ubuntu 采用其经典的有图标桌面样式，左侧边栏用于模拟其传统的“程序坞dock”，使用 Ubuntu Ambiance 主题定制化窗口，与其传统的（Unity 桌面）外观和体验基本一致。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/ubuntu-gnome-18-04_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/5e63dbae97afc66e955d1185c6f26ce7.jpg\" alt=\"Ubuntu gnome 18.04\"></a></p>\n<p>虽然存在一定差异，但习惯使用其中一种桌面环境后切换到另外一种并不困难。毕竟二者设计时都充分考虑了简洁性和用户友好性，即使是新用户也不会对这两种 Linux 发行版感到不适应。</p>\n<p>但外观或 UI 并不是决定用户选择哪一种 Linux 发行版的唯一因素，还有其它因素也会影响用户的选择。下面主要介绍两种 Linux 发行版在软件包管理相关方面的内容。</p>\n<h3 id=\"toc_3\">软件中心</h3>\n<p>Ubuntu 使用 dpkg（即 Debian Package Management）将软件分发给终端用户；Fedora 则使用 rpm（全称为 Red Hat Package Management）。它们都是 Linux 社区中非常流行的包管理系统，对应的命令行工具也都简单易用。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/ubuntu-software-center_2_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/3390655eab10c9026788ce80d68f0e02.jpg\" alt=\"ubuntu software center\"></a></p>\n<p>但在具体分发的软件方面，各个 Linux 发行版会有明显差异。Canonical 每 6 个月发布新版本的 Ubuntu，一般是在每年的 4 月和 10 月。对每个版本，开发者会维护一个开发计划；Ubuntu 新版本发布后，该版本就会进入冻结freeze状态，即停止新软件的开发和测试。</p>\n<p>相比之下，Fedora 也采用相似的 6 个月发布周期，看起来很像一种滚动更新rolling release的 Linux 发行版（其实并不是这样）。与 Ubuntu 不同之处在于，（Fedora 中的）几乎所有软件包更新都很频繁，让用户有机会尝试最新版本的软件。但这样也导致软件 Bug 更频繁出现，给用户带来“不稳定性”，虽然还不至于导致系统不可用。</p>\n<h3 id=\"toc_4\">软件更新</h3>\n<p>我上面已经提到了 Ubuntu 版本的冻结状态。好吧，由于它对 Ubuntu 软件更新方式有着重要的影响，我再次提到这个状态：当 Ubuntu 新版本发布后，该版本的开发（这里是指测试新软件）就停止了。</p>\n<p><em>即将发布的下个版本的开发也随之开始，先后历经 “每日构建daily build” 和 “测试版beta release” 阶段，最后作为新版本发布给终端用户。</em></p>\n<p>在冻结状态下，Ubuntu 维护者不会在软件源package repository中增加最新版软件，除非用于解决严重的安全问题。因此，Ubuntu 用户可用的软件更新更多涉及 Bug 修复而不是新特性，这样的好处在于系统可以保持稳定，不会扰乱用户的使用。</p>\n<p>Fedora 试图为终端用户提供最新版本的软件，故用户的可用软件更新相比 Ubuntu 而言会更多涉及新特性。当然，开发者为了维持系统的稳定性，也采取了一系列措施。例如，在操作系统启动时，用户可以从最多三个可用内核working kernel（最新内核处于最上方）中进行选择；当新内核无法启动时，用户可以回滚使用之前两个可用内核。</p>\n<h3 id=\"toc_5\">Snaps 和 flatpak</h3>\n<p>它们都是新出现的酷炫工具，可以将软件发布到多个 Linux 发行版上。Ubuntu 提供 <strong>snaps</strong>，而 Fedora 则提供 <strong>flatpak</strong> 。二者之中 snaps 更加流行，更多流行软件或版权软件都在考虑上架 snap 商店。Flatpak 也在吸引关注，越来越多的软件上线该平台。</p>\n<p>不幸的是，由于二者出现的时间都不久，很多人遇到“窗口主题不一致window theme-breaking”问题并在网上表达不满。但由于二者都很易于使用，在二者之间切换并不是难事。</p>\n<p>（LCTT 译注：按译者理解，由于二者都增加了一层安全隔离，读取系统主题方面会遇到问题；另外，似乎也有反馈 snap 专用主题无法及时应用于 snap 的问题）</p>\n<h3 id=\"toc_6\">应用对比</h3>\n<p>下面列出一些在 Ubuntu 和 Fedora 上共有的常见应用，然后在两个平台之间进行对比：</p>\n<h4 id=\"toc_7\">计算器</h4>\n<p>Fedora 上的计算器程序启动速度更快。这是因为 Fedora 上的计算器程序是软件包形式安装的，而 Ubuntu 上的计算器程序则是 snap 版本。</p>\n<h4 id=\"toc_8\">系统监视器</h4>\n<p>可能听上去比较书呆子气，但我认为观察计算机性能并杀掉令人讨厌的进程是必要且直观的。程序启动速度对比与计算器的结果一致，即 （软件包方式安装的）Fedora 版本快于（snap 形式提供的）Ubuntu 版本。</p>\n<h4 id=\"toc_9\">帮助程序</h4>\n<p>我已经提到，（为便于长期以来的 Untiy 用户平滑切换到 GNOME），Ubuntu 提供的 GNOME 桌面环境是经过微调的版本。不幸的是，Ubuntu 开发者似乎忘记或忽略了对帮助程序的更新，用户阅读文档（入门视频）后会发现演示视频与真实环境有略微差异，这可能让人感到迷惑。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/ubuntu-18-04-help-manual_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/cf301305235cc47e24ebcc91d2e12952.jpg\" alt=\"ubuntu 18.04 help manual\"></a></p>\n<h3 id=\"toc_10\">结论</h3>\n<p>Ubuntu 和 Fedora 是两个主流的 Linux 发行版。两者都各自有一些华而不实的特性，因而新接触 Linux 的人很难抉择。我的建议是同时尝试二者，这样你在试用后可以发现哪个发行版提供的工具更适合你。</p>\n<p>希望你阅读愉快，你可以在下方的评论区给出我漏掉的内容或你的建议。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114327\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114327votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114327\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/1868b505269cd1c49bd1048cb0b76b26116ba5c4.jpg"},{"url_object_id": "5a1ec5b54e970b6455f9429af8a54930", "title": "受 SQLite 多年青睐，C 语言到底好在哪儿？", "url": "http://blog.jobbole.com/114331/", "create_date": "2018/08/31", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/06/45d153deb05afc91d5c64e84b323bce2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,C语言,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://sqlite.org/whyc.html\">SQLite</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/99485/why-is-sqlite-coded-in-c\">开源中国社区</a>   </div><p>SQLite 近日发表了一篇博文，解释了为什么多年来 SQLite 一直坚持用 C 语言来实现，以下是正文内容：</p>\n<h3><strong>C 语言是最佳选择</strong></h3>\n<p>从2000年5月29日发布至今，SQLite 一直都是用 C 语言实现。C 一直是实现像 SQLite 这类软件库的最佳语言。目前，还没有任何计划要采用另外一门语言对 SQLite 进行重新开发。</p>\n<p>为什么 C 语言是实现 SQLite 的最佳选择？原因主要体现在这几个方面：</p>\n<ul>\n<li>性能</li>\n<li>兼容性</li>\n<li>低依赖性</li>\n<li>稳定性</li>\n</ul>\n<p><strong>1、性能</strong></p>\n<p>像 SQLite 这类库要求速度必须要快。SQLite 的速度就很快，它比文件系统快 35%（详情可以参考这两个示例：<a href=\"https://sqlite.org/intern-v-extern-blob.html\">Internal Versus External BLOBs</a> 和 <a href=\"https://sqlite.org/fasterthanfs.html\">35% Faster Than The Filesystem</a>）。</p>\n<p>而 C 语言就能实现快速编写代码。C 语言通常被描述为“可移植性的汇编语言”。它使开发人员能够尽可能靠近底层硬件进行编码，同时仍然可以跨平台保持可移植性。</p>\n<p>平常，我们可能会看到有人描述某种语言“像 C 语言一样快”，却不会看到有人说，作为通用目的编程时，会有一门语言“比 C 语言快”，因为这种语言真的不存在。</p>\n<p><strong>2、兼容性</strong></p>\n<p>几乎所有系统都能调用 C 语言编写的库，但其他语言就不尽然。例如，用 Java 编写的 Android 应用能够调用 SQLite（通过适配器）。 如果用 Java 编写 SQLite，那么对 Android 来说可能会更方便，因为这会使接口更简单。但在 iPhone 上，应用程序是用 Objective-C 或 Swift 编写的，它们都不能调用用 Java 编写的库。 因此，如果用 Java 编写，SQLite 将无法在 iPhone 上使用。</p>\n<p><strong>3、低依赖性</strong></p>\n<p>用 C 语言编写的库对运行时没有很强的依赖。SQLite 的最低配置也只要求 C 库中的这些方法：</p>\n<ul>\n<li>memcmp()</li>\n<li>memcpy()</li>\n<li>memmove()</li>\n<li>memset()</li>\n<li>strcmp()</li>\n<li>strlen()</li>\n<li>strncmp()</li>\n</ul>\n<p>在更完整的构建中，SQLite 也使用诸如 malloc() 和 free() 之类的库例程以及用于打开，读取，写入和关闭文件的操作系统接口。 但即便如此，依赖的数量也很少。</p>\n<p><strong>4、稳定性</strong></p>\n<p>C 语言易于理解，契合了 SQLite 的要求，适合 SQLite 的开发。</p>\n<h3><strong>为什么 SQLite 不使用面向对象的语言？</strong></h3>\n<p>开发人员可能无法想象用“非面向对象”来开发一个像 SQLite 这样复杂的系统会是什么样子。所以 SQLite 为什么不使用 C++ 或者 Java 来开发呢？</p>\n<p>1、用 C++ 或 Java 编写的库通常只能由以相同语言编写的应用程序使用。 使用 Haskell 或 Java 编写的应用程序很难调用用 C++ 编写的库。 另一方面，用 C 语言编写的库可以从任何编程语言调用。</p>\n<p>2、面向对象是设计模式，而不是编程语言。 你可以使用任何所需语言（包括汇编语言）进行面向对象编程。 某些语言（例如：C++ 或 Java）可以使面向对象更容易，但你仍然可以用像 C 这样的语言进行面向对象的编程。</p>\n<p>3、面向对象不是唯一有效的设计模式。对象通常是分解问题的好方法。 但不是唯一的方法，也不总是分解问题的最佳方法。 有时好的旧程序代码更容易编写，更易于维护和理解，并且比面向对象的代码更快。</p>\n<p>4、SQLite 进行开发时，Java 还不是一门成熟的语言，C++ 会成熟一点，但当时要找到两种能以 相同方式工作的 C++ 编译器比较困难。相比之下，C 语言是个不错的选择。虽然，这种情况现在有所改善，但为此对 SQLite 重新开发并没有什么好处。</p>\n<h3><strong>为什么 SQLite 不使用”安全”语言编写？</strong></h3>\n<p>使用“安全”语言不易发生内存泄露、数组溢出等的安全问题。最近，许多人好像对 Rust 和 Go 这样的“安全”语言感兴趣。但 SQLite 为什么不使用呢？</p>\n<p>1、SQLite 出现后的 10 年时间里，所谓的“安全”语言还不存在。虽然 SQLite 可以用 Rust 或者 Go 重新编写，但这样可能会引入更多难以修复的 Bug，进而会影响编码速度。</p>\n<p>2、“安全”编程语言解决简单的问题：像内存泄露、数组溢出等。在解决 SQL 计算结果这类的问题上，并不如 C 语言好用。</p>\n<p>3、“安全”语言可防止安全漏洞，但 SQLite 并非一个对安全敏感的库。如果应用运行了不受信任的 SQL，那它可能已经存在更大的安全问题，而这是“安全”语言无法修复的问题。</p>\n<p>4、一些“安全”语言（如 Go 语言）不喜欢使用 assert()，但这是保持 SQLite 可维护性的重要前提。</p>\n<p>5、“安全”语言会插入额外的机器分支来执行其他操作。但在正确的代码中，这些分支并不会被采用。所以机器代码不能 100% 被测试到，可这恰恰是 SQLite 质量检测的重要组成部分。</p>\n<p>6、“安全”语言会在内存不足（OOM）时请求终止，而 SQLite 的设计是遇到 OOM 时能重新恢复。目前，还不知道如何利用“安全”语言实现这一点。</p>\n<p>7、现有的“安全”语言都比较新，SQLite 开发员对它们的出现表示赞赏，但依然认为 C 语言更适合目前的开发工作。</p>\n<p>文章最后表示，SQLite 可能会考虑使用 Rust 重新开发，但不太可能使用 Go 语言，因为它对 assert() 不友好。但其实 Rust 目前的条件并不足以对 SQLite 进行重新开发，它还需要继续发展，详情请<a href=\"http://www.techug.com/post/sqlite-why-c-lang.html\">查看原文</a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114331\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114331votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114331\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/aafb49412a97044486e9b4c16ac603ece4966968.jpg"},{"url_object_id": "080b4358ddc02845c1a0afd499acafac", "title": "如何在 Linux Shell 编程中定义和使用函数", "url": "http://blog.jobbole.com/114329/", "create_date": "2018/08/29", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/6c675d44b9dd5ed6bd448d1d9d31c4eb.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linuxtechi.com/define-use-functions-linux-shell-script/\">Pradeep Kumar</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9954-1.html\">Linux中国/LuMing</a>   </div><p>函数是一段可复用的代码。我们通常把重复的代码放进函数中并且在不同的地方去调用它。库是函数的集合。我们可以在库中定义经常使用的函数，这样其它脚本便可以不再重复代码而使用这些函数。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/6c675d44b9dd5ed6bd448d1d9d31c4eb.jpg\"></p>\n<p>本文我们将讨论诸多关于函数的内容和一些使用技巧。为了方便演示，我将在 Ubuntu 系统上使用 <strong>Bourne Again SHell (Bash)</strong>。</p>\n<h3 id=\"toc_1\">调用函数</h3>\n<p>在 Shell 中调用函数和调用其它命令是一模一样的。例如，如果你的函数名称为 <code>my_func</code>，你可以在命令行中像下面这样执行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc496b792942042\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ my_func</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc496b792942042-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc496b792942042-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my_func</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果你的函数接收多个参数，那么可以像下面这样写（类似命令行参数的使用）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc4975146057312\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ my_func arg1 arg2 arg3</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4975146057312-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc4975146057312-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my_func </span><span class=\"crayon-e\">arg1 </span><span class=\"crayon-e\">arg2 </span><span class=\"crayon-v\">arg3</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">定义函数</h3>\n<p>我们可以用下面的语法去定义一个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc4979503062650\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction function_name {\r\n    Body of function\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4979503062650-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc4979503062650-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4979503062650-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc4979503062650-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">function_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc4979503062650-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Body </span><span class=\"crayon-e\">of </span><span class=\"crayon-t\">function</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc4979503062650-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>函数的主体可以包含任何有效的命令、循环语句和其它函数或脚本。现在让我们创建一个简单的函数，它向屏幕上显示一些消息（注：直接在命令行里写）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc497d550511026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction print_msg {\r\n    echo \"Hello, World\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc497d550511026-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc497d550511026-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc497d550511026-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc497d550511026-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc497d550511026-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello, World\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc497d550511026-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在，让我们执行这个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc4980463051284\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ print_msg\r\nHello, World</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4980463051284-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc4980463051284-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc4980463051284-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_msg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc4980463051284-2\"><span class=\"crayon-v\">Hello</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">World</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>不出所料，这个函数在屏幕上显示了一些消息。</p>\n<p>在上面的例子中，我们直接在终端里创建了一个函数。这个函数也可以保存到文件中。如下面的例子所示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc4984844378455\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\nfunction print_msg {\r\n    echo \"Hello, World\"\r\n}\r\nprint_msg</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4984844378455-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc4984844378455-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4984844378455-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc4984844378455-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4984844378455-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc4984844378455-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc4984844378455-2\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc4984844378455-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello, World\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc4984844378455-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc4984844378455-5\"><span class=\"crayon-v\">print_msg</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们已经在 <code>function.sh</code> 文件中定义了这个函数。现在让我们执行这个脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc4987887006874\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ chmod +x function.sh\r\n$ ./function.sh\r\nHello, World</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4987887006874-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc4987887006874-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4987887006874-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc4987887006874-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc4987887006874-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sh</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc4987887006874-3\"><span class=\"crayon-v\">Hello</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">World</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>你可以看到，上面的输出和之前的是一模一样的。</p>\n<h3 id=\"toc_3\">更多函数用法</h3>\n<p>在上一小节中我们定义了一个非常简单的函数。然而在软件开发的过程中，我们需要更多高级的函数，它可以接收多个参数并且带有返回值。在这一小节中，我们将讨论这种函数。</p>\n<h4 id=\"toc_4\">向函数传递参数</h4>\n<p>我们可以像调用其它命令那样给函数提供参数。我们可以在函数里使用美元 <code>$</code> 符号访问到这些参数。例如，<code>$1</code> 表示第一个参数，<code>$2</code> 代表第二个参数，以此类推。</p>\n<p>让我们修改下之前的函数，让它以参数的形式接收信息。修改后的函数就像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc498b897481751\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction print_msg {\r\n    echo \"Hello $1\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc498b897481751-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc498b897481751-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc498b897481751-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc498b897481751-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc498b897481751-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello $1\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc498b897481751-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在上面的函数中我们使用 <code>$1</code> 符号访问第一个参数。让我们执行这个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc498e325783697\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ print_msg \"LinuxTechi\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc498e325783697-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc498e325783697-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">print</span><span class=\"crayon-sy\">_</span>msg<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"LinuxTechi\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>执行完后，生成如下信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc4991776891880\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHello LinuxTechi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4991776891880-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc4991776891880-1\"><span class=\"crayon-e\">Hello </span><span class=\"crayon-v\">LinuxTechi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h4 id=\"toc_5\">从函数中返回数值</h4>\n<p>跟其它编程语言一样，Bash 提供了返回语句让我们可以向调用者返回一些数值。让我们举例说明：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc4995329160476\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction func_return_value {\r\n    return 10\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4995329160476-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc4995329160476-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4995329160476-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc4995329160476-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func_return_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc4995329160476-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc4995329160476-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上面的函数向调用者返回 <code>10</code>。让我们执行这个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc4998631676896\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ func_return_value\r\n$ echo \"Value returned by function is: $?\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc4998631676896-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc4998631676896-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc4998631676896-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func_return</span><span class=\"crayon-sy\">_</span>value</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc4998631676896-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Value returned by function is: $?\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>当你执行完，将会产生如下的输出结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc499b049286312\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nValue returned by function is: 10</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc499b049286312-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc499b049286312-1\"><span class=\"crayon-e\">Value </span><span class=\"crayon-e\">returned </span><span class=\"crayon-e\">by </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><strong>提示</strong>：在 Bash 中使用 <code>$?</code> 去获取函数的返回值。</p>\n<h3 id=\"toc_6\">函数技巧</h3>\n<p>目前我们已经对 Bash 中的函数有了一些了解。现在让我们创建一些非常有用的 Bash 函数，它们可以让我们的生活变得更加轻松。</p>\n<h4 id=\"toc_7\">Logger</h4>\n<p>让我们创建一个 <code>logger</code> 函数，它可以输出带有日期和时间的 log 信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc499f250018692\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction log_msg {\r\n    echo \"[`date '+ %F %T'` ]: $@\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc499f250018692-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc499f250018692-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc499f250018692-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc499f250018692-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log_msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc499f250018692-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"[`date '+ %F %T'` ]: $@\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc499f250018692-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>执行这个函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49a2864895386\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ log_msg \"This is sample log message\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a2864895386-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a2864895386-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">_</span>msg<span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is sample log message\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>执行完，就会生成如下信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49a5918873793\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[ 2018-08-16 19:56:34 ]: This is sample log message</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a5918873793-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a5918873793-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">56</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sample </span><span class=\"crayon-e\">log </span><span class=\"crayon-v\">message</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h4 id=\"toc_8\">显示系统信息</h4>\n<p>让我们创建一个显示 GNU/Linux 信息的函数</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49a9646917491\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction system_info {\r\n    echo \"### OS information ###\"\r\n    lsb_release -a\r\n\r\n    echo\r\n    echo \"### Processor information ###\"\r\n    processor=`grep -wc \"processor\" /proc/cpuinfo`\r\n    model=`grep -w \"model name\" /proc/cpuinfo  | awk -F: '{print $2}'`\r\n    echo \"Processor = $processor\"\r\n    echo \"Model     = $model\"\r\n\r\n    echo\r\n    echo \"### Memory information ###\"\r\n    total=`grep -w \"MemTotal\" /proc/meminfo | awk '{print $2}'`\r\n    free=`grep -w \"MemFree\" /proc/meminfo | awk '{print $2}'`\r\n    echo \"Total memory: $total kB\"\r\n    echo \"Free memory : $free kB\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49a9646917491-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49a9646917491-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">system_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"### OS information ###\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lsb_release</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"### Processor information ###\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">processor</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">wc</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"processor\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">cpuinfo</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">model</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"model name\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cpuinfo</span> <span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">F</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{print $2}'</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Processor = $processor\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Model     = $model\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-13\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"### Memory information ###\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">total</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MemTotal\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">meminfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{print $2}'</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">free</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MemFree\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">meminfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">awk</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{print $2}'</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Total memory: $total kB\"</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49a9646917491-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Free memory : $free kB\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49a9646917491-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>执行完后会生成以下信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49ac598513588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### OS information ###\r\nNo LSB modules are available.\r\nDistributor ID:           Ubuntu\r\nDescription:   Ubuntu 18.04.1 LTS\r\nRelease:         18.04\r\nCodename:    bionic\r\n\r\n### Processor information ###\r\nProcessor = 1\r\nModel     =  Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz\r\n\r\n### Memory information ###\r\nTotal memory: 4015648 kB\r\nFree memory : 2915428 kB</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49ac598513588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49ac598513588-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49ac598513588-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49ac598513588-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49ac598513588-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49ac598513588-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49ac598513588-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49ac598513588-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49ac598513588-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49ac598513588-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49ac598513588-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49ac598513588-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49ac598513588-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49ac598513588-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49ac598513588-1\"><span class=\"crayon-p\">### OS information ###</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49ac598513588-2\"><span class=\"crayon-e\">No </span><span class=\"crayon-e\">LSB </span><span class=\"crayon-e\">modules </span><span class=\"crayon-e\">are </span><span class=\"crayon-v\">available</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49ac598513588-3\"><span class=\"crayon-e\">Distributor </span><span class=\"crayon-v\">ID</span><span class=\"crayon-o\">:</span>          <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49ac598513588-4\"><span class=\"crayon-v\">Description</span><span class=\"crayon-o\">:</span>  <span class=\"crayon-h\"> </span><span class=\"crayon-i\">Ubuntu</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18.04.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LTS</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49ac598513588-5\"><span class=\"crayon-v\">Release</span><span class=\"crayon-o\">:</span>        <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18.04</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49ac598513588-6\"><span class=\"crayon-v\">Codename</span><span class=\"crayon-o\">:</span>   <span class=\"crayon-h\"> </span><span class=\"crayon-v\">bionic</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49ac598513588-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49ac598513588-8\"><span class=\"crayon-p\">### Processor information ###</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49ac598513588-9\"><span class=\"crayon-v\">Processor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49ac598513588-10\"><span class=\"crayon-i\">Model</span>    <span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Intel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">R</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Core</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i7</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">7700HQ</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">CPU</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.80GHz</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49ac598513588-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49ac598513588-12\"><span class=\"crayon-p\">### Memory information ###</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49ac598513588-13\"><span class=\"crayon-e\">Total </span><span class=\"crayon-v\">memory</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4015648</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kB</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49ac598513588-14\"><span class=\"crayon-e\">Free </span><span class=\"crayon-v\">memory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2915428</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kB</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0054 seconds] -->\r\n<p></p>\n<h4 id=\"toc_9\">在当前目录下查找文件或者目录</h4>\n<p>下面的函数从当前目录下查找文件或者目录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49b0999885401\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction search {\r\n    find . -name $1\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b0999885401-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49b0999885401-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b0999885401-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b0999885401-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49b0999885401-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b0999885401-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>让我们使用下面的命令查找 <code>dir4</code> 这个目录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49b3294714799\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ search dir4</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b3294714799-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b3294714799-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search </span><span class=\"crayon-v\">dir4</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>当你执行完命令后，将会产生如下输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49b6639299439\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n./dir1/dir2/dir3/dir4</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b6639299439-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b6639299439-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dir1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dir2</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dir3</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dir4</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h4 id=\"toc_10\">数字时钟</h4>\n<p>下面的函数在终端里创建了一个简单的数字时钟：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49b9562814399\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction digital_clock {\r\n    clear\r\n    while [ 1 ]\r\n    do\r\n        date +'%T'\r\n        sleep 1\r\n        clear\r\n    done\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b9562814399-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49b9562814399-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b9562814399-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49b9562814399-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b9562814399-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49b9562814399-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b9562814399-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cc49b9562814399-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49b9562814399-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b9562814399-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">digital_clock</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49b9562814399-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">clear</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b9562814399-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49b9562814399-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b9562814399-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'%T'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49b9562814399-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b9562814399-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">clear</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cc49b9562814399-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">done</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cc49b9562814399-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3 id=\"toc_11\">函数库</h3>\n<p>库是函数的集合。将函数定义在文件里并在当前环境中导入那个文件，这样可以创建函数库。</p>\n<p>假设我们已经在 <code>utils.sh</code> 中定义好了所有函数，接着在当前的环境下使用下面的命令导入函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cc49bd194498071\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ source utils.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cc49bd194498071-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cc49bd194498071-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">source </span><span class=\"crayon-v\">utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>之后你就可以像调用其它 Bash 命令那样执行库中任何的函数了。</p>\n<h3 id=\"toc_12\">总结</h3>\n<p>本文我们讨论了诸多可以提升效率的实用技巧。我希望这篇文章能够启发你去创造自己的技巧。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114329\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114329votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114329\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/71285d56f5f756f6df8bd1e65052353494be2a08.jpg"},{"url_object_id": "5c7160e2f1b3bb8d9429b0096006bb95", "title": "哪门编程语言更赚钱？看看 Stack Overflow 的最新调查", "url": "http://blog.jobbole.com/114388/", "create_date": "2018/09/16", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/1d66c6135be63e71744b3b8ec59f5545.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,编程语言", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.oschina.net/news/99994/developer-salaries-in-2018-sf-salary-calculator\">开源中国社区</a>   </div><p>Stack Overflow 2018 年最新的薪资计算器已正式推出。最新的计算器除了增加新的国家和地区之外，还更新了数字数据。更新后的薪资计算器新增了 8 个国家和地区的数据，以及更能反映开发者收入的最新数据。</p>\n<p>所以，想知道自己的技术能力值多少钱？不妨试用一下 Stack Overflow 2018 年最新的薪资计算器(<a href=\"https://stackoverflow.com/jobs/salary\" target=\"_blank\">https://stackoverflow.com/jobs/salary</a>)。通过最新的计算器，我们可以看到目前哪些工作岗位在如火如荼地发展着，哪些工作岗位正在走下坡路，而哪些城市的技术从业者收入最高。</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8d578b765aedb88b8fa25bf207b81abd.png\" alt=\"\"><br>\n<em>薪资计算器的统计维度：坐标、教育程度、编码年龄、所属岗位以及专业擅长的技能</em></p>\n<p>不难发现，与 2017 年相比，开发者的收入整体有所增加。其中，在伦敦和旧金山等技术较为发达的地区，薪资中位数较 2017 年平均上涨约 25%。由此看来，今年的技术市场还是很乐观的。</p>\n<p>而收入最高的职位 —— DevOps 专家在多个国家都是稳坐第一（美国、德国、印度和英国）。DevOps 专家是收入最高的开发者。美国 DevOps 专家的年薪中位数接近 10 万美元。其他最高收入的职位是数据科学家、后端开发者、移动开发者、游戏或图形开发者以及全栈开发者。与此同时，所有国家和地区薪水垫底的职位都是设计人员和数据库管理员。</p>\n<p>下面来说一下开发者最关心的语言问题，究竟哪门编程语言最受雇主青睐呢？值得各位关注的是，Go 语言开发者成了高收入者。要知道，Go 目前还不是流行的编程语言，企业仍倾向于使用更成熟的旧语言。在二十五种最常用的语言中，Java 是使用最为广泛的语言，而 JavaScript 占据了第二位。新进者 Go 语言位居第 20 位，Scala 位居第 19 位。</p>\n<p>薪资计算器中的数字也可以与 Stack Overflow 2018 问卷调查中的高薪技术清单进行比较，其中 Scala 和 Go 语言在列表中的位置相对较高。</p>\n<p>下面大家继续看看 Stack Overflow 2018 调查的相关内容：</p>\n<h3><strong>全球职业占比</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/643b6221042e5243602256becab75bf4.png\" width=\"673\" height=\"370\"></p>\n<p>在职业占比的调查中，我们发现，前三分别是：后端开发、全栈开发和前端开发。有近 60% 的受访者将自己视为后端开发，大约 20％ 的受访者认为自己是移动开发。</p>\n<h3><strong>对开源的贡献</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/57ff5a122f24b2317ae7b3a54dc2a1fd.png\" width=\"698\" height=\"170\"></p>\n<p>Stack Overflow 上几乎有一半的专业开发人员参与了开源项目。 参与开源的方式因语言而异。 超过 70％ 的使用 Rust，Julia 和 Clojure 的开发人员参与开源，而使用 VBA，VB.NET 和 C＃的开发人员中只有不到 40％。</p>\n<h3><strong>码龄</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/910499427e2bcd10724876ef67815d4d.png\" width=\"630\" height=\"424\"></p>\n<p>超过一半的受访者拥有五以内的专业编码经验。 使用 Cobol 和 Perl 等语言的开发人员编码经验最丰富，而使用 Matlab，Haskell 和 Kotlin 等则相反。</p>\n<h3><strong>不同开发领域的开发经验</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a91fc939fb8f30ed0b98772222b306e3.png\" width=\"682\" height=\"572\"></p>\n<p>在不同软件开发领域工作的开发人员具有不同的工作经验。 调查发现，DevOps 专家和开发人员拥有最丰富的开发经验。 DevOps 作为一门学科和专业身份相对较新，但在这一领域工作的人员经验丰富。 游戏/图形开发人员和移动开发人员拥有最少的经验。</p>\n<h3><strong>起床时间</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/c6108725a11391beb964a3956bc69e70.png\" width=\"684\" height=\"418\"></p>\n<p>有的开发者可能准时下班到家，有点可能加班到深夜，有的可能天亮才躺在床上。不管什么情况，大多数开发者表示他们一般是 8 点起床。</p>\n<h3><strong>敲电脑的时间</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e3d9288791e3eab2c741d527e50d7de9.png\" width=\"631\" height=\"185\"></p>\n<p>受访者包括专业开发人员、学生和业余爱好者，他们中的绝大多数表示，醒着的大部分时间都待在电脑旁。</p>\n<h3><strong>生活习惯</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/4b64f1d64b73d2f13c72c7a873dee3cd.png\" width=\"689\" height=\"243\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/53d439c741e24182ebf3bed38e3a9567.png\" width=\"690\" height=\"239\"></p>\n<p>调查显示，开发者在饮食方面比较规律，64% 的开发者都会按时吃饭。在锻炼情况方面，超过 60％ 的受访者表示至少每周锻炼一次，但从整体分布来看，从不锻炼的开发者占比也不少。</p>\n<h3><strong>开发语言</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/b90d6d468c2d6e1f4ce56a37b91b14e2.png\" width=\"611\" height=\"571\"></p>\n<p>JavaScript 连续六年成为最常用的编程语言。 Python 在今年的排名上升，超过 C＃，就像去年超过 PHP 一样。 Python 也成为今年增长最快的编程语言。</p>\n<h3><strong>最受开发者喜爱的语言</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/549cb0a5331d719567b2f54cc29dc446.png\" width=\"620\" height=\"488\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e272fb55e52142336f9db16c5a62361f.png\" width=\"620\" height=\"398\"></p>\n<h3><strong>最想尝试的语言</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/71832893840ebf0d8aa4029b393bf1b1.png\" width=\"619\" height=\"496\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/41c57c09d1e27c8ecdcc265e9bd79ed2.png\" width=\"620\" height=\"373\"></p>\n<h3><strong>语言对应薪资</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/b86d7e6c38f35999c89d97a0a69919f3.png\" width=\"568\" height=\"603\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e5f08b4cd0d24fa897c2a66e20167d2f.png\" width=\"507\" height=\"287\"></p>\n<p>在<strong>受欢迎</strong>的几门编程语言中，<strong>Go 语言开发者的薪资处于较高水平</strong>。</p>\n<h3><strong>框架库和工具</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ff8996962bef3e02c8bfb5d90fa10a63.png\" width=\"558\" height=\"435\"></p>\n<p>Node.js 和 AngularJS 仍然是此类别中最常用的技术，React 和 .Net Core 对许多开发人员来说也很重要。</p>\n<h3><strong>数据库</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ad78333eed1dd0513f9fc074eafe67bb.png\" width=\"692\" height=\"523\"></p>\n<h3><strong>桌面/服务器使用率</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/fb4eba1c5da7b5332b01f9a9fe2c9d12.png\" width=\"677\" height=\"527\"></p>\n<h3><strong>最受喜爱的桌面/服务器</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e594c6f1810575403325b628568d65de.png\" width=\"694\" height=\"506\"></p>\n<h3><strong>最受欢迎的开发环境</strong></h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f2f083547fc32c5f47a299002b8b66b8.png\" width=\"650\" height=\"593\"></p>\n<p>由于很多调查的调查结果与中国国内情况不太相符，或存在一定偏差，使得国内开发者怀疑，这些个调查到底有没有把中国考虑在内。对此，小编专门看了一眼调查发布图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e890248d690aa13ae8da40a25e3acd0d.png\" width=\"702\" height=\"386\"></p>\n<p>主要大头集中在美国和印度地区，中国调查占比 1.0%。emmm… 事实证明，中国的确是有考虑在内的，由于占比偏低，最终结果可能存在偏差，以下调查结果仅供参考，如有异议欢迎留言分享！</p>\n<p>详情请参考 <a href=\"https://insights.stackoverflow.com/survey/2018#top-paying-technologies\">Stack Overflow</a> 的调查。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114388\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114388votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114388\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f91b50cabfac3ffddce3fd3f9459483f457d2ea9.jpg"},{"url_object_id": "4709f20bc9cfd6faeaaa14c497085b04", "title": "基于海量词库的单词拼写检查、推荐到底是咋做的？", "url": "http://blog.jobbole.com/114358/", "create_date": "2018/09/07", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/03b5b99cd8b93d7c062277c5de23570b.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,词库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/haolujun/p/9585509.html\">haolujun</a>   </div><div id=\"cnblogs_post_body\">\n<h1 id=\"前言\">前言</h1>\n<p>在我们日常应用中，应该遇到不少类似的状况：</p>\n<ul>\n<li>写文档时，单词拼写错误后，工具自动推荐一个相似且正确的拼写形式；</li>\n<li>使用搜狗输入法时，敲错某个字的拼音照样能够打出我们想要的汉字；</li>\n<li>利用搜索引擎进行搜索时，下拉框中自动列出与输入相近的词语。</li>\n<li>等等，不一一列举。</li>\n</ul>\n<p>这种功能是如何实现的呢？里面用到了哪些算法呢？本文就来介绍一个能够完成这个任务的算法。</p>\n<h2 id=\"问题描述\">问题描述</h2>\n<p>其实，这几个问题都能够转换成同一个问题：即对于给定的输入字符串T，在预先准备好的模式串集合Q中找到与输入串相似的模式串子集。</p>\n<p>那么如何得到准备好的这些模式串集合呢？我们可以通过数据挖掘等一些机制来得到。</p>\n<p>那么接下来的问题就是如何快速的从这个集合中找到与输入串相似的字符串？通常我们用最小编辑距离来表示两个字符串的相似程度。</p>\n<p>例如，对于输入串T，我们限制错误数小于等于2，即在预先准备好的模式集合中找所有与输入串编辑距离小于等于2的字符串。</p>\n<p>有什么算法能够快速完成这个任务呢？</p>\n<h2 id=\"暴力算法\">暴力算法</h2>\n<p>遍历集合Q中的每个模式串P，分别计算其与输入串T的最小编辑距离，如果编辑距离小于指定的错误容忍度x，则输出这个模式串。</p>\n<ul>\n<li>时间复杂度：O(|Q| * n * m)，当|Q|很大时，速度将会很慢。</li>\n</ul>\n<p>那么这个算法可以优化么？可以！</p>\n<p>比如，第一个字很少有人输入错，所以我们可以在模式串集合Q中只对第一个字与输入串第一个字相同的那些字符串进行相似度计算，这样就能够减少相当多的算量，是一个可行方法。</p>\n<p>但是这也有问题，假若少部分人确实第一个字输入错了，那么这个算法找到的所有串也是错的，不能达到纠错的效果。</p>\n<p>所以，针对首字符过滤的优化算法有一定的局限性。</p>\n<h2 id=\"步步优化\">步步优化</h2>\n<p>我们仔细思考这个问题，由于模式串Q是一个集合，那么其中必定有大量的模式串有共同的前缀。能否利用这个前缀进行优化呢？</p>\n<h4 id=\"优化1-利用两个词的相同前缀进行优化\">优化1： 利用两个词的相同前缀进行优化</h4>\n<p>比如：字符串 explore和explain，他们有公共的前缀，这就意味着他们与字符串explode的编辑矩阵的前几列值是相同的，不用重复计算，如下图红色部分所示。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/6b81c4bb8a7804c54bce2e8238499d4d.png\"></p>\n<p>explore与explain无论与任何字符串计算编辑距离，编辑矩阵的前4列肯定一模一样。所以，如果我们已经计算过explore与某个串的编辑距离后，那么当计算该串与explain的编辑距离时，前4列可以复用，直接从第五列开始计算。</p>\n<p>到此，我们得到一个新的算法计算多模式的编辑距离：把模式串集合建立成一棵字典树，深度优先遍历这棵树，在遍历的过程中，不断更新编辑矩阵的某一个列，如果到达的节点是一个终结符，并且T与P（路径上的字符形成的字符串）的编辑距离小于指定的容忍度，则找到一个符合条件的串。</p>\n<h3 id=\"优化2剪枝\">优化2：剪枝</h3>\n<p>虽然我们利用词前缀优化了算法，能够避免拥有相同前缀模式串的编辑矩阵的重复计算，但是必须要遍历所有节点。有没有什么办法能够在计算到某一深度后，根据一些限制条件能够剪去该子树其它剩余节点的计算呢？在搜索算法中，这种优化叫做剪枝。接下来我们讨论一下该如何设计一个剪枝函数。</p>\n<p>重新审视我们的编辑距离定义，其实可以看成是把字符串P和T分别拆分成两段，然后计算对应的段的编辑距离之和，如下图所示。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/20d56bfac8d442debca343d977f2a9c7.png\"></p>\n<p>字符串P和T分别拆分成两段，红色和绿色。红色部分之间的编辑距离与绿色部分之间的编辑距离之和即为字符串P和T的编辑距离。</p>\n<p>举个例子，更形象：</p>\n<ul>\n<li>例子1<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/9ca01e50bde33fdc2a171f2ce7326356.png\"></li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f462819937997512201\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ned(\"explore\", \"express\") = ed(\"explo\", \"exp\") + ed(\"re\", \"ress\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f462819937997512201-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f462819937997512201-1\"><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"explore\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"express\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"explo\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"re\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ress\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<ul>\n<li>例子2<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/5f9235b8943733fe2cf38090a84beb09.png\"></li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f462819943278310781\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ned(\"explore\", \"express\") = ed(\"exp\", \"exp\") + ed(\"lore\", \"ress\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f462819943278310781-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f462819943278310781-1\"><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"explore\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"express\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"lore\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ress\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<ul>\n<li>例子3<br>\n但是，并不是每种划分都是正确的，比如下面图所示：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/bf3bef35858e60c200fae355b5b2ed2c.png\"></li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f462819947806068961\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ned(\"ex\",\"exp\") + ed(\"plore\", \"ress\") = 1 + 4 = 5</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f462819947806068961-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f462819947806068961-1\"><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ex\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"exp\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"plore\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ress\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p><strong>所以，最小编辑距离问题又相当于一个最优拆分，即对于字符串P中位置为i的字符，找到在T中的一个最优位置j，使得</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f46281994b764192034\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ned(P.prefix(i), T.prefix(j)) + ed(P.suffix(i+1), T.suffix(j+1))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f46281994b764192034-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f46281994b764192034-1\"><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">P</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">prefix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">prefix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">P</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">suffix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">suffix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p><strong>最小。</strong></p>\n<p>回到我们这个问题中来，如果我们限制P和T的最小编辑距离小于等于x，</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e3bebd84db26517fba83de949eee80b9.png\"></p>\n<p>我们让 p[i]分别匹配t[i-x],t[i-x+1],……,t[i],t[i+1],……t[i+x]，并找到其中前半段匹配的最小的编辑距离ed1=ed(p[1~i],t[1~j])，如果ed1大于x，我们则能推断出ed(p,t)也终将大于x（ed=ed1+ed2&gt;x）。</p>\n<p>为什么p[i]不匹配t[i-x-1]以及之前的位置呢？那是因为ed(p.prefix(i), t.prefix(i-x-1)) &gt; x，因为必须至少在t.prefix(i-x-1)中插入x+1个字符才能保证字符串长度相等；同理p[i]也不能匹配t[i+x+1]及其之后的位置。所以，根据分段原则，最优匹配肯定出现在t[i-x] ~ t[i+x]之间，如果这个区间的最小编辑距离都大于x，那么我们无需对p[i+1]及其之后的字符进行匹配计算。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/fcf1ee5a9fe3f9f583cd37264f33cb90.png\"></p>\n<p>例如：当遍历到蓝色节点l时，路径形成的字符串expl与T=exist满足剪枝条件，则后序节点不需要遍历，因为后面不可能有任何一个字符串满足与T的编辑距离小于2。</p>\n<p><strong>至此，我们得到了剪枝优化：深度遍历到达字典树的某个节点，其路径上的字符组成字符串P，计算其与T.prefix(i-x), T.prefix(i-x+1),……T.prefix(i+x)的最小编辑距离，如果其中的最小值大于x，则停止遍历这棵子树上的后面的节点。</strong></p>\n<p>其实，这个最终版本的优化算法出自论文：<strong>《Error-tolerant finite-state recognition with applications to morphological analysis and spelling correction》.K Oflazer:1996 </strong></p>\n<h3 id=\"代码实现与效果对比\">代码实现与效果对比</h3>\n<p>代码实现需需要很强的技巧性，因为无论是剪枝函数还是进行最终确认函数都可以复用同一个编辑矩阵，贴一个很丑陋的代码：<a href=\"https://github.com/haolujun/Algorithm/tree/master/muti-edit-distance\">https://github.com/haolujun/Algorithm/tree/master/muti-edit-distance</a></p>\n<p>这个算法在错误容忍度非常小的情况下效率非常高，我随机生成了10万个长度5~10的模式串，再随机生成100个输入串T（长度5 ~ 10），字符集大小为10，x最小编辑距离限制，计算多模式编辑距离，处理总时间如下，单位ms：</p>\n<table>\n<thead>\n<tr>\n<th>算法</th>\n<th>x = 1</th>\n<th>x = 2</th>\n<th>x = 3</th>\n<th>x = 4</th>\n<th>x = 5</th>\n<th>x = 6</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>暴力算法</td>\n<td>21990</td>\n<td>21990</td>\n<td>21990</td>\n<td>21990</td>\n<td>21990</td>\n<td>21990</td>\n</tr>\n<tr>\n<td>优化算法</td>\n<td>97</td>\n<td>922</td>\n<td>4248</td>\n<td>11361</td>\n<td>20097</td>\n<td>28000</td>\n</tr>\n</tbody>\n</table>\n<p>当容忍度很小时，优化算法完胜暴力算法，并且实际应用中x一般取值都非常小，正好适合优化算法。</p>\n<p>当x值增大，优化算法效率逐渐下降，并且最后慢于暴力算法，这是因为优化算法实现复杂导致（递归+更复杂的判断）。</p>\n<p>所以，最终应用时，我们根据x值选择不同的算法。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114358\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114358votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114358\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/3ef52bc5d5cc6d23e102e0ce679d152bdd3b5cc7.jpg"},{"url_object_id": "34647675114e93c21bd8bb2e9ed09743", "title": "从技术转管理，我做了什么来拯救自己？", "url": "http://blog.jobbole.com/113815/", "create_date": "2018/09/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/11/90129c6662feee86738bd3663ce83108.png"], "praise_nums": "2", "comment_nums": 2, "fav_nums": 2, "tags": "职场,管理,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/lxtalx\">zer0Black</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>我是一名新手项目经理，转项目管理岗1年半。在做管理之前，我是一名开发。也就是说，我是最常见的技术转管理了。</p>\n<p>最开始，我极度不适应这个岗位。很累，但是不见成效。经过一年多的摸索，我终于在工作中总结出了一些心得，一些套路。所以我想给技术转管理的同学们讲一讲：</p>\n<p>我做了什么，来拯救自己</p>\n<h2 id=\"个人背景和公司背景\">个人背景和公司背景</h2>\n<p>1.目前为止工作4年半，也就是说，我做了3年开发，1年半管理<br>\n2.我是一名野生程序员（就是非计算机专业毕业）<br>\n3.我写过Android、iOS、web页面、java后端、python后端等等，看起来像传说中的全栈程序员。但其实心知肚明，我就是那种啥都会但啥也不行的程序员<br>\n4.公司此前做产品，后来在产品的基础上转型外包扩大规模<br>\n5.公司转型的基础上，我也转型成了管理<br>\n6.我司项目经理是一个专门的职位，负责项目管理、技术架构、客户对接。总之项目的一切相关问题，包括技术问题，都由项目经理负责</p>\n<h2 id=\"我做了什么\">我做了什么</h2>\n<h4 id=\"事必躬亲会毁了团队也会毁了自己\">事必躬亲，会毁了团队也会毁了自己</h4>\n<p>这恐怕是所有从技术转管理的人，都会犯的通病。我刚开始带团队的时候，核心代码都要自己写。然后看同事进度的时候总是嫌这个慢，那个不行的。看不下去了索性自己上手吭哧吭哧写好。弄得自己非常疲惫。</p>\n<p>通常技术能力强的人，更有机会转型管理岗。所以在带团队的过程中，总是情不自禁的亲自动手完成别人应该做的事情。最终结果就是总会替代同事做他们自己本应该做的事情。</p>\n<p>但这个行为对管理者来说，只会让管理者越来越疲惫。而对整个团队来说，更是温水煮青蛙，一步一步把团队带进深渊。管理者负担太多工作，导致团队长期无法成长。轻则导致管理者累崩。重则导致项目崩塌、团队分崩离析。</p>\n<p><strong><em>我应该怎么办：</em></strong><br>\n实际上，影响别人去做好一件事，比亲自去做要难的多。而我处理这个问题的方式<br>\n1.忍住自己亲自动手的心理<br>\n2.复杂任务拆解细化，分派任务时明确任务目标和验收标准<br>\n3.分派任务时给予同事鼓励，对他们保持充分信任<br>\n4.有难度的任务，提供一定的辅助或者培训</p>\n<h4 id=\"多想多说多做\">多想、多说、多做</h4>\n<p>我开始带团队的时候，一直忙于处理各种各样的项目问题，写代码、沟通需求、进度汇报、现场演示。大部分时间都埋头于项目本身，以为只要把项目做好，按时交付就行。做的太多， 导致思考的时间少了，对团队同事的关注也就少了。</p>\n<p>而一个团队领导者，多做是应该的，更重要的是多思考，多说</p>\n<p><strong><em>思考什么：</em></strong><br>\n1.项目干系人是否清楚，干系人不清楚会导致项目管理混乱，出的东西不满足要求<br>\n2.需求是否合理，需求是否可以优化、技术架构是否满足需求<br>\n3.功能是否拆解到位，任务分派是否可合理<br>\n4.若尝试新技术，是否有把握在出问题的时候力挽狂澜<br>\n5.团队成员状态如何，要如何激励他们<br>\n6.项目流程是否合理，如何改进<br>\n7.项目成本如何控制，时间节点如何把握，质量如何保证</p>\n<p>以上都是我目前每个项目都会思考的问题。项目管理者一定要告诫自己：<code>不要用战术上的勤奋掩盖战略上的懒惰</code></p>\n<p><strong><em>说什么：</em></strong><br>\n1.需求不清楚要问<br>\n2.需求可以优化要说，不要闷声发大财，坑的是自己<br>\n3.有困难处理不了要及时汇报给领导，悉知客户<br>\n4.团队成员有问题要给予正确指导，而不是放任自由<br>\n5.进度情况、项目情况要积极和客户保持沟通</p>\n<h4 id=\"不仅是监督更要是指引\">不仅是监督，更要是指引</h4>\n<p>“那个功能写完了吗？”；“这个功能怎么还没做好”；“你这个东西什么时候能够写完”。</p>\n<p>以上是我日常工作中最常做的事情，即便到了目前，我依然在做这些事。监督催促同事干活！每天像个监工一样，漫步在同事周围，监督他们的进度，在他们耳边逼逼叨。</p>\n<p>但我认为，催促同事干活的不应该是项目经理，而是项目流程，是规则。每个人明确自己的角色，各司其职，由规则约束着大家前行。而不是简单靠项目经理赶着大家往前走。</p>\n<p>但我并没有做好这个工作，目前还是处于制定计划、监督执行的死循环中。对于规则、流程只是有个模糊的想法，还不成型，也未经试验。暂不与大家分享。</p>\n<h4 id=\"救火能力固然重要但更要防范于未然\">救火能力固然重要，但更要防范于未然</h4>\n<p>我由技术转管理的初期，最擅长的事情就是技术。所以一直在项目中充当救火队员的角色。</p>\n<p>有突发情况？我自己来；没有人能攻克技术难点？那我自己来；开发了很久，发现需求理解错误？咔咔咔自己一顿改；总之就是这有问题，咔咔咔自己一顿弄，那有问题，嗒嗒嗒自己一顿搞。总用自己的技术能力挽救项目中的各种突发情况。</p>\n<p>而作为一个项目管理者，救火能力固然重要，要在关键时刻能够站出来力挽狂澜。但更重要的，我想是如何去避免突发情况吧。而要避免突发情况，就要思考如何做好风险管理。提早做好准备，把可能出现的未知风险扼杀在襁褓中。</p>\n<p>在IT项目管理中，我认为风险主要存在于以下几点，应思考准备以便规避风险：<br>\n1.需求变更。开发中需求变更是难免的，但如何控制需求变更，如何管理需求变更是我们着重要考虑的问题。SCALPEL方法，大家可以了解一下<br>\n2.项目干系人不清楚，导致项目需求分歧<br>\n3.技术难点预估不足。总是会存在开发过程中才发某项功能无法实现或者实现成本过高，这主要是由于前期对需求理解不足，对自我或团队太自信造成的<br>\n4.计划制定问题。开发计划制定有问题，可能由于错误的估计了团队的能力，项目的难度造成的。计划风险通常是由项目经理自己造成，需自我强化、学习、思考来避免此问题<br>\n5.组织成员问题。开发成员不足、人员离职、其它项目需紧急支援人手、团队沟通不畅都可能引起此问题<br>\n6.流程风险。过于流程化，导致流程工作占用太多开发时间，流程和灵活是一对冲突的概念。如何解决项目管理中流程化和灵活度的问题，我认为是项目经理较重要的能力之一<br>\n7.性能问题。开发过程中，最怕的是功能做完了，最后发现性能不行。导致前期开发工作全白费。所以在需求阶段，软件的用户量，数据量都是要考虑在内的。在开发之初，就要在程序设计过程中将性能问题考虑进去</p>\n<h4 id=\"保持内心强大\">保持内心强大</h4>\n<p>项目管理是一个磨人的工作。虽然外面说要做风险管理，但突发情况避免不了。一个合格的项目管理者，要有泰山崩于前而色不变的内心。</p>\n<p>需求变了不要紧、计划变了不要紧、成员情况发生变化不要紧。毕竟我们都知道<code>世界上唯一不变的就是变化</code>，尽可能的给自己准备好<code>Plan B</code></p>\n<h4 id=\"背黑锅要上邀功也要上\">背黑锅要上，邀功也要上</h4>\n<p>我相信各位做开发的时候，最讨厌的就是那种黑锅你背，有功他领的leader。既然如此，希望我们也不要变成这样的人。</p>\n<p>项目经理嘛，统管这个项目的一切。项目出了问题，不管因为什么原因，都一定是项目经理的责任。你的同事可能在项目里表现不佳，你的客户可能经常变更需求。不管多少理由，都不是你甩锅的理由。有锅一定要自己扛着，所以，<code>背黑锅要上</code>。</p>\n<p>做的好，也要说出来。超出客户预期的项目闪光点，要告诉客户团队的优秀。项目完成的不错，要告诉老板团队的优秀。让客户让老板知道你们团队做的好，下一次他们才会给你们更充分的信任。项目成员表现优秀的地方，不光要表扬，也要和上级说。你是和你团队成员接触最紧密的人，他们的有点别人不知道，但你知道。所以他们优秀的地方，要宣扬，要让别的部门知道，要让上级知道。所以<code>邀功也要上</code>。</p>\n<p>在帮派里，不能为兄弟们挡刀并引领兄弟们前进的老大是不值得追随的，弟兄们在你手下做事受尽委屈，争不了一口气，那这个老大也做不长。</p>\n<p>技术出身的管理者中，我相信<code>背黑锅要上</code>是大家都能做到的。但技术人员不善言辞，总是闷头干活，不会表达。所以要适当学会邀功，为团队邀功。希望大家都能学会<code>邀功也要上</code></p>\n<h4 id=\"不要抛弃技术它可能是你的救命良药\">不要抛弃技术，它可能是你的救命良药</h4>\n<p>做项目管理以后，尤其是像我现在这种一个人带多个项目的情况。管理工作会占用每天极多的时间。这是工作本身需要你做的，无可厚非。我想说的是，即便如此，也要保证自己对技术的学习。</p>\n<p>了解新技术也好，写写开源项目也好，总之要保持对技术的持续学习。他总能在你需要的时候帮到你。</p>\n<p><code>学如逆水行舟,不进则退</code>，与大家共勉</p>\n<h2 id=\"总结\">总结</h2>\n<p>总体而言，我认为一个新手项目经理，要学会以下事情：<br>\n1.要学会带领团队成长，不要事必躬亲<br>\n2.要多进行思考<br>\n3.要学会风险管理<br>\n4.要保持内心的强大<br>\n5.要学会邀功</p>\n<p>以上，就是我想和大家分享的内容，其中很多点，我自己做的也不是很好，依然需要自我练习和努力。希望各位技术转管理的同学，都能尽快适应自己的工作。</p>\n<article><!-- JiaThis Button END -->\n</article>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113815\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113815votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113815\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx\">zer0Black</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2016/02/7345325ae6842e24247f60a113f61ce3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            目前工作为移动开发，兴趣广泛，计算机各方面均有强烈兴趣。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/lxtalx\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/lxtalx/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 26</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/1851062185\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f49c8437c74dd90a906b7a9579e6520f3044c962.jpg"},{"url_object_id": "b55de04af9ae4faef14ef32e4c533022", "title": "GBDT 回归的原理与 Python 实现", "url": "http://blog.jobbole.com/114351/", "create_date": "2018/09/05", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/9e08e0b08f1c54458be8116208d9b31c.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,GBDT", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/jobbole\">伯乐在线读者</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>提到GBDT回归相信大家应该都不会觉得陌生（不陌生你点进来干嘛[捂脸]），本文就GBDT回归的基本原理进行讲解，并手把手、肩并肩地带您实现这一算法。</p>\n<div>\n<p>完整实现代码请参考本人的p…哦不是…github：</p>\n<ul>\n<li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/imylu/blob/master/imylu/ensemble/gbdt_base.py\" target=\"_blank\">gbdt_base.pygithub.com</a></li>\n<li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/imylu/blob/master/imylu/ensemble/gbdt_regressor.py\" target=\"_blank\">gbdt_regressor.pygithub.com</a></li>\n<li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/imylu/blob/master/examples/gbdt_regressor_example.py\" target=\"_blank\">gbdt_regressor_example.pygithub.com</a></li>\n</ul>\n<h1>1. 原理篇</h1>\n<p>我们用人话而不是大段的数学公式来讲讲GBDT回归是怎么一回事。</p>\n<h2>1.1 温故知新</h2>\n<p>回归树是GBDT的基础，之前的一篇文章曾经讲过回归树的原理和实现。链接如下：</p>\n<blockquote><p><a href=\"https://zhuanlan.zhihu.com/p/41688007\" target=\"_blank\">李小文：回归树的原理与Python实现zhuanlan.zhihu.com<img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/feac768c0a0f8febdb4166c62f50de8a.jpg\" alt=\"图标\"></a></p></blockquote>\n<h2>1.2 预测年龄</h2>\n<p>仍然以预测同事年龄来举例，从<a href=\"http://blog.jobbole.com/114261/\">《回归树》</a>那篇文章中我们可以知道，如果需要通过一个常量来预测同事的年龄，平均值是最佳的选择之一。</p>\n<h2>1.3 年龄的残差</h2>\n<p>我们不妨假设同事的年龄分别为5岁、6岁、7岁，那么同事的平均年龄就是6岁。所以我们用6岁这个常量来预测同事的年龄，即[6, 6, 6]。每个同事年龄的残差 = 年龄 – 预测值 = [5, 6, 7] – [6, 6, 6]，所以残差为[-1, 0, 1]</p>\n<h2>1.4 预测年龄的残差</h2>\n<p>为了让模型更加准确，其中一个思路是让残差变小。如何减少残差呢？我们不妨对残差建立一颗回归树，然后预测出准确的残差。假设这棵树预测的残差是[-0.9, 0, 0.9]，将上一轮的预测值和这一轮的预测值求和，每个同事的年龄 = [6, 6, 6] + [-0.9, 0, 0.9] = [5.1, 6, 6.9]，显然与真实值[5, 6, 7]更加接近了， 年龄的残差此时变为[-0.1, 0, 0.1]。显然，预测的准确性得到了提升。</p>\n<h2>1.5 GBDT</h2>\n<p>重新整理一下思路，假设我们的预测一共迭代3轮 年龄：[5, 6, 7]</p>\n<p>第1轮预测：[6, 6, 6] (平均值)</p>\n<p>第1轮残差：[-1, 0, 1]</p>\n<p>第2轮预测：[6, 6, 6] (平均值) + [-0.9, 0, 0.9] (第1颗回归树) = [5.1, 6, 6.9]</p>\n<p>第2轮残差：[-0.1, 0, 0.1]</p>\n<p>第3轮预测：[6, 6, 6] (平均值) + [-0.9, 0, 0.9] (第1颗回归树) + [-0.08, 0, 0.07] (第2颗回归树) = [5.02, 6, 6.97]</p>\n<p>第3轮残差：[-0.08, 0, 0.03]</p>\n<p>看上去残差越来越小，而这种预测方式就是GBDT算法。</p>\n<h2>1.6 公式推导</h2>\n<p>看到这里，相信您对GBDT已经有了直观的认识。这么做有什么科学依据么，为什么残差可以越来越小呢？前方小段数学公式低能预警。</p>\n<ol>\n<li>假设要做m轮预测，预测函数为Fm，初始常量或每一轮的回归树为fm，输入变量为X，有：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+F_m%28X%29+%3D+F_%7Bm-1%7D%28X%29+%2B+f_m%28X%29\" alt=\" F_m(X) = F_{m-1}(X) + f_m(X)\"></li>\n<li>设要预测的变量为y，采用MSE作为损失函数：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%28y%2C+F_m%28X%29%29+%3D+%5CLarge%5Cfrac%7B1%7D%7Bm%7D%5Cnormalsize%5Csum_%7Bi%3D0%7D%5Em%28%28y_i+-+F_m%28x_i%29%29+%5E+2%29\" alt=\" Loss(y, F_m(X)) = Largefrac{1}{m}normalsizesum_{i=0}^m((y_i - F_m(x_i)) ^ 2)\"></li>\n<li>我们知道泰勒公式的一阶展开式是长成这个样子滴：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+f%28x+%2B+x_0%29+%3D+f%28x%29+%2B+f%27%28x%29+%2A+x_0\" alt=\" f(x + x_0) = f(x) + f'(x) * x_0\"></li>\n<li>如果：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+f%28x%29+%3D+g%27%28x%29\" alt=\" f(x) = g'(x)\"></li>\n<li>那么，根据式3和式4可以得出：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+g%27%28x+%2B+x_0%29+%3D+g%27%28x%29+%2B+g%27%27%28x%29+%2A+x_0\" alt=\" g'(x + x_0) = g'(x) + g''(x) * x_0\"></li>\n<li>根据式2可以知道，损失函数的一阶偏导数为:<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%27%28y%2C+F_m%28X%29%29+%3D+-%5CLarge%5Cfrac%7B2%7D%7Bn%7D%5Cnormalsize%5Csum_%7Bi%3D0%7D%5Em%28y_i+-+F_m%28x_i%29%29\" alt=\" Loss'(y, F_m(X)) = -Largefrac{2}{n}normalsizesum_{i=0}^m(y_i - F_m(x_i))\"></li>\n<li>根据式6可以知道，损失函数的二阶偏导数为：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%27%27%28y%2C+F_m%28X%29%29+%3D+2\" alt=\" Loss''(y, F_m(X)) = 2\"></li>\n<li>蓄力结束，开始放大招。根据式1，损失函数的一阶导数为：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%27%28y%2C+F_m%28X%29%29+%3D+Loss%27%28y%2C+F_%7Bm-1%7D%28X%29+%2B+f_m%28X%29%29\" alt=\" Loss'(y, F_m(X)) = Loss'(y, F_{m-1}(X) + f_m(X))\"></li>\n<li>根据式5，将式8进一步展开为：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+Loss%27%28y%2C+F_m%28X%29%29%3D+Loss%27%28y%2C+F_%7Bm-1%7D%28X%29%29+%2B+Loss%27%27%28y%2C+F_%7Bm-1%7D%28X%29%29+%2A+f_m%28X%29\" alt=\" Loss'(y, F_m(X))= Loss'(y, F_{m-1}(X)) + Loss''(y, F_{m-1}(X)) * f_m(X)\"></li>\n<li>令式9，即损失函数的一阶偏导数为0，那么：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+f_m%28X%29+%3D+-+Loss%27%28y%2C+F_%7Bm-1%7D%28X%29%29+%2F+Loss%27%27%28y%2C+F_%7Bm-1%7D%28X%29%29\" alt=\" f_m(X) = - Loss'(y, F_{m-1}(X)) / Loss''(y, F_{m-1}(X))\"></li>\n<li>将式6，式7代入式9得到：<br>\n<img src=\"https://www.zhihu.com/equation?tex=+f_m%28X%29+%3D+%5CLarge%5Cfrac%7B1%7D%7Bn%7D%5Cnormalsize%5Csum_%7Bi%3D0%7D%5Em%28y_i+-+F_%7Bm-1%7D%28x_i%29%29\" alt=\" f_m(X) = Largefrac{1}{n}normalsizesum_{i=0}^m(y_i - F_{m-1}(x_i))\"></li>\n</ol>\n<p>因此，我们需要通过用第m-1轮残差的均值来得到函数fm，进而优化函数Fm。而回归树的原理就是通过最佳划分区域的均值来进行预测。所以fm可以选用回归树作为基础模型，将初始值，m-1颗回归树的预测值相加便可以预测y。</p>\n<h1>2. 实现篇</h1>\n<p>本人用全宇宙最简单的编程语言——Python实现了GBDT回归算法，没有依赖任何第三方库，便于学习和使用。简单说明一下实现过程，更详细的注释请参考本人github上的代码。</p>\n<h2>2.1 导入回归树类</h2>\n<p>回归树是我之前已经写好的一个类，在之前的文章详细介绍过，代码请参考：</p>\n<blockquote><p><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/Imylu/blob/master/regression_tree.py\" target=\"_blank\">regression_tree.pygithub.com</a></p></blockquote>\n<div></div>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cd6235115581609\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom ..tree.regression_tree import RegressionTree</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6235115581609-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cd6235115581609-1\"><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">regression_tree </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">RegressionTree</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0143 seconds] -->\r\n\n</div>\n<h2>2.2 创建GradientBoostingBase类</h2>\n<p>初始化，存储回归树、学习率、初始预测值和变换函数。（注：回归不需要做变换，因此函数的返回值等于参数）</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cd623f139119084\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass GradientBoostingBase(object):\r\n    def __init__(self):\r\n        self.trees = None\r\n        self.lr = None\r\n        self.init_val = None\r\n        self.fn = lambda x: x</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd623f139119084-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd623f139119084-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd623f139119084-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd623f139119084-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd623f139119084-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd623f139119084-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cd623f139119084-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GradientBoostingBase</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd623f139119084-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd623f139119084-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">trees</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd623f139119084-4\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd623f139119084-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">init_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd623f139119084-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<h2>2.3 计算初始预测值</h2>\n<p>初始预测值即y的平均值。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cd6243173863202\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _get_init_val(self, y):\r\n    return sum(y) / len(y)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6243173863202-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6243173863202-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cd6243173863202-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_get_init_val</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6243173863202-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<h2>2.4 计算残差</h2>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cd6246426540140\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _get_residuals(self, y, y_hat):\r\n    return [yi - self.fn(y_hat_i) for yi, y_hat_i in zip(y, y_hat)]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6246426540140-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6246426540140-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cd6246426540140-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_get_residuals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6246426540140-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">yi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_hat_i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">y_hat_i </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<h2>2.5 训练模型</h2>\n<p>训练模型的时候需要注意以下几点： 1. 控制树的最大深度max_depth； 2. 控制分裂时最少的样本量min_samples_split； 3. 训练每一棵回归树的时候要乘以一个学习率lr，防止模型过拟合； 4. 对样本进行抽样的时候要采用有放回的抽样方式。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cd624a364308776\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fit(self, X, y, n_estimators, lr, max_depth, min_samples_split, subsample=None):\r\n    self.init_val = self._get_init_val(y)\r\n\r\n    n = len(y)\r\n    y_hat = [self.init_val] * n\r\n    residuals = self._get_residuals(y, y_hat)\r\n\r\n    self.trees = []\r\n    self.lr = lr\r\n    for _ in range(n_estimators):\r\n        idx = range(n)\r\n        if subsample is not None:\r\n            k = int(subsample * n)\r\n            idx = choices(population=idx, k=k)\r\n        X_sub = [X[i] for i in idx]\r\n        residuals_sub = [residuals[i] for i in idx]\r\n        y_hat_sub = [y_hat[i] for i in idx]\r\n\r\n        tree = RegressionTree()\r\n        tree.fit(X_sub, residuals_sub, max_depth, min_samples_split)\r\n\r\n        self._update_score(tree, X_sub, y_hat_sub, residuals_sub)\r\n\r\n        y_hat = [y_hat_i + lr * res_hat_i for y_hat_i,\r\n                    res_hat_i in zip(y_hat, tree.predict(X))]\r\n\r\n        residuals = self._get_residuals(y, y_hat)\r\n        self.trees.append(tree)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624a364308776-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624a364308776-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n_estimators</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_samples_split</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">subsample</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">init_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_get_init_val</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">init_val</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">residuals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_get_residuals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">trees</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">lr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_estimators</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">subsample </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">subsample *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">choices</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">X_sub</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">residuals_sub</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">residuals</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">y_hat_sub</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-18\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RegressionTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">residuals_sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_samples_split</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_update_score</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat_sub</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">residuals_sub</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y_hat_i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">lr *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res_hat_i </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat_i</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-25\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">res_hat_i </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-26\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363cd624a364308776-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">residuals</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_get_residuals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_hat</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624a364308776-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">trees</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n\n</div>\n<h2>2.6 预测一个样本</h2>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cd624f380973756\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _predict(self, Xi):\r\n    return self.fn(self.init_val + sum(self.lr * tree._predict(Xi) for tree in self.trees))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd624f380973756-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd624f380973756-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cd624f380973756-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd624f380973756-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">init_val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">lr *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Xi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tree </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">trees</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<h2>2.7 预测多个样本</h2>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cd6252173232346\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef predict(self, X):\r\n    return [self._predict(Xi) for Xi in X]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6252173232346-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6252173232346-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cd6252173232346-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6252173232346-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Xi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Xi </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<h1>3 效果评估</h1>\n<h2>3.1 main函数</h2>\n<p>使用著名的波士顿房价数据集，按照7:3的比例拆分为训练集和测试集，训练模型，并统计准确度。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363cd6255320640918\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@run_time\r\ndef main():\r\n    print(\"Tesing the accuracy of GBDT regressor...\")\r\n\r\n    X, y = load_boston_house_prices()\r\n\r\n    X_train, X_test, y_train, y_test = train_test_split(\r\n        X, y, random_state=10)\r\n\r\n    reg = GradientBoostingRegressor()\r\n    reg.fit(X=X_train, y=y_train, n_estimators=4,\r\n            lr=0.5, max_depth=2, min_samples_split=2)\r\n\r\n    get_r2(reg, X_test, y_test)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6255320640918-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6255320640918-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6255320640918-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6255320640918-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6255320640918-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6255320640918-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6255320640918-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6255320640918-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6255320640918-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6255320640918-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6255320640918-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6255320640918-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363cd6255320640918-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363cd6255320640918-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363cd6255320640918-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">run_time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6255320640918-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd6255320640918-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Tesing the accuracy of GBDT regressor...\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6255320640918-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363cd6255320640918-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">load_boston_house_prices</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6255320640918-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363cd6255320640918-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_test_split</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6255320640918-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_state</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd6255320640918-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6255320640918-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">reg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GradientBoostingRegressor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd6255320640918-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">reg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n_estimators</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6255320640918-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_depth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_samples_split</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363cd6255320640918-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363cd6255320640918-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">get_r2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">reg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0135 seconds] -->\r\n\n</div>\n<h2>3.2 效果展示</h2>\n<p>最终拟合优度0.851，运行时间2.2秒，效果还算不错~</p>\n<figure><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/4f3602e4dd68fc98498fd7573cf47f7b.jpg\" width=\"440\"></figure>\n<h2>3.3 工具函数</h2>\n<p>本人自定义了一些工具函数，可以在github上查看</p>\n<blockquote><p><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tushushu/imylu/blob/master/imylu/utils.py\" target=\"_blank\">utils.pygithub.com</a></p></blockquote>\n<p>1. run_time – 测试函数运行时间</p>\n<p>2. load_boston_house_prices – 加载波士顿房价数据</p>\n<p>3. train_test_split – 拆分训练集、测试集</p>\n<p>4. get_r2 – 计算拟合优度</p>\n<h1>总结</h1>\n<p>GBDT回归的原理：平均值加回归树</p>\n<p>GBDT回归的实现：加加减减for循环</p>\n<p>【关于作者】</p>\n<p>李小文：先后从事过数据分析、数据挖掘工作，主要开发语言是Python，现任一家小型互联网公司的算法工程师。Github: <a href=\"https://github.com/tushushu\" target=\"_blank\" rel=\"noopener\">https://github.com/tushushu</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114351\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114351votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114351\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole\">伯乐在线读者</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ① 本账号用于发布那些在伯乐在线无账号的读者的投稿，包括译文和原创文章。② 欢迎加入伯乐在线专栏作者：http://blog.jobbole.com/99322/        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/jobbole\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/jobbole/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 34</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/ecce700fc49a6c9d59f6f5aac1822d3a8c7a69b3.jpg"},{"url_object_id": "9001107b7d2f77903c7b54070031412d", "title": "死磕一周算法，我让服务性能提高50%", "url": "http://blog.jobbole.com/114324/", "create_date": "2018/08/27", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/10/9184208f96827c412ab7d3570590ef76.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,性能", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/haolujun/p/9527776.html\">haolujun</a>   </div><h2 id=\"前言\">前言</h2>\n<p>我最近一直在公司做检索性能优化。当我看到这个算法之前，我也不认为我负责的检索系统性能还有改进的余地。但是这个算法确实太牛掰了，足足让服务性能提高50%，我不得不和大家分享一下。其实前一段时间的博客中也写到过这个算法，只是没有细讲，今天我准备把它单独拎出来，说道说道。说实话，本人数学功底一般，算法证明不是我强项，所以文中的证明只是我在论文作者的基础上加入了自己的思考方法，并且还没有完全证明出来，请大家见谅 ! 欢迎爱思考的小伙伴进行补充。我只要达到抛砖引玉的作用，就知足了。</p>\n<p>回归正题，我们的检索服务中用到了最小编辑距离算法，这个算法本身是平方量级的时间复杂度，并且很少人在帖子中提到小于这个复杂度的算法。但是我无意中发现了另外一个更牛的算法：列划分算法，使得这个本就很牛的算法性能直接提高一倍。接下来进入正题。</p>\n<h2 id=\"列划分算法\">列划分算法</h2>\n<p>这个算法比较难理解，出自如下论文：《Theoretical and empirical comparisons of approximate string matching algorithms》。In Proceedings of the 3rd Annual Symposium on Combinatorial Pattern Matching, number 664 in Lecture Notes in Computer Science, pages 175~184. Springer-Verlag, 1992。Author:WI Chang ，J Lampe。所以有必要先给大家普及一些共识。</p>\n<p><strong>编辑矩阵</strong> 最小编辑距离在计算过程中使用动态规划算法计算的那个矩阵，了解这个算法的都懂，我不赘述。但是我们的编辑矩阵有个特点：第一行都是0，这么做的好处是：只要文本串T中的任意一个子序列与模式串P的编辑距离小于某个固定的数值，就会被发现。</p>\n<p>给大伙一个样例，文本串T=annealing，模式串P=annual：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ed6cb9c9f4e2315c4c75bf405206ccda.png\"></p>\n<p>注意，第一行都是0，这是与传统最小编辑距离的最大区别，其余的动归方程完全相同。</p>\n<p><strong>对角线法则</strong> 编辑矩阵沿着右下方对角线方向数值非递减，并且至多相差1。</p>\n<p><strong>行列法则</strong> 每行每列相邻两个数至多相差1。</p>\n<p>观察编辑距离矩阵，我们发现如下事实：每一列是由若干段连续数字组成。所以我们把编辑矩阵的每一列划分成若干连续序列，如下图所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/72f5b31135a79ed08e87d6dcd3b48a4e.png\"></p>\n<p>红色框中就是一个一个的序列，序列内部连续。</p>\n<p><strong>序列-δ 定义</strong> 对于编辑矩阵的每一个元素D[j][i] (j是行，i是列)，若 j – D[j][i] = δ，我们就说D[j][i]属于i列上的 序列-δ，我们还观察到随着j增大，j – D[j][i]是非递减的。如下图所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/c95123bff6ecbcabdcf4a0f51eb03e5d.png\"></p>\n<p><strong>序列-δ终止位置</strong> 每个序列都会有起始和终止位置。序列-δ的终止位置为j，如果j是序列-δ的最小横坐标，并且满足D[j+1][i]属于序列-ε，并且ε&gt;δ（即j+1-D[j+1][i]&gt;δ）。</p>\n<p><strong>长度为0的序列</strong> 我们发现如果按照如上定义，每一列上δ的值并不一定连续，总是或有或无的缺少一个数值。所以我们定义长度为0的序列：当D[j+1][i] &lt; D[j][i]时，我们就在序列-δ和序列-(δ+2)之间人为插入一个长度为0的序列-(δ+1)。如下图所示：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ca2bb74d5294b193a24d25247dcdaef3.png\"></p>\n<p>所以，我们按照这个定义，就可以对编辑矩阵的每列进行一个划分，划分的每一段都是一串连续数字。</p>\n<p><strong>说了这么多，这个定义有什么用呢？假若，我们每次都能根据前一列的列划分情况直接推导出后一列的列划分情况，那么就可以省去好多计算，毕竟每一个划分中的每一段的数字都是连续的，这就暗示我们可以直接用一个常数时间的加法直接得到某一个编辑矩阵的元素值，而不用使用最小编辑距离的动态规划算法去计算。</strong></p>\n<p>接下来的重点来了，我们介绍这个推导公式，请打起十二分精神！我们按照序列-δ长度是否为0来介绍这个推论。由于其中一个推论文字描述太繁琐，不容易理解，所以我画了个图：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/0ff49e40437cc4c0f2497a451564da25.png\"></p>\n<p>接下来烧脑开始。</p>\n<blockquote>\n<p id=\"推论1如果列i上长度为0的-序列-δ-的结束位置为j则列i1上的-序列-δ-的结束位置为-j1\">推论1：如果列i上长度为0的 序列-δ 的结束位置为j，则列i+1上的 序列-δ 的结束位置为 j+1。</p>\n</blockquote>\n<p><strong>证明</strong> ：由推论前提我们知道 δ = j – D[j][i] + 1 （想想前面说的δ值不连续，我们就人为插入一个中间值，只不过长度为0）。<br>\n我们观察编辑矩阵就会发现如下两个事实：</p>\n<ul>\n<li>事实1：D[j+1][i+1] = D[j][i] （ 别问为什么， 自己观察， 看看是不是都这样， 其实可以用反证法，我们就不证明了）。</li>\n<li>事实2：D[j+2][i+1] &lt;= D[j][i]。</li>\n</ul>\n<p>通过事实1，我们知道D[j+1][i+1]确实属于 序列-δ，因为 j + 1 – D[j+1][i+1] = j + 1 – D[j][i] = δ。</p>\n<p>通过事实2，我们知道列i+1上的序列δ，终止位置为j+1。</p>\n<p>所以推论1证明结束。</p>\n<blockquote>\n<p id=\"推论2-文字描述略请看图\">推论2： 文字描述略，请看图</p>\n</blockquote>\n<p><strong>证明</strong> ：</p>\n<ul>\n<li>设这个序列长度为L，除了每列的第一个序列外，其余序列的其余位置均是当前的编辑距离小于等于该列上一个位置的编辑距离：即D[j-L+1][i]&lt;=D[j-L][i]，所以，我们可以推出：D[j-L+1][i] &lt;= D[j-L][i];</li>\n<li>再根据编辑矩阵对角线非递减我们知道，D[j-L+1][i+1] &gt;= D[j-L][i];</li>\n</ul>\n<p>综上两点我们得到如下大小关系：D[j-L+1][i+1] &gt;= D[j-L+1][i]。</p>\n<p>此外我们知道我们当前列的序列-δ截止位置为j，也意味着D[j+1][i] &lt;= D[j][i]，同样根据对角线法则，我们得出D[j+2][i+1] &lt;= D[j+1][i] + 1 &lt;= D[j][i] + 1。</p>\n<p>接下来到了最精彩的一步，我们知道列i当前序列-δ内的值是连续的，如果起始编辑距离为A，那么终止编辑距离为A+L-1。</p>\n<p>而由我们的推导可以发现：D[j-L+1][i+1] &gt;= A，D[j+2][i+1] &lt;= (A+L-1) + 1 = A+L，而之间跨越的长度为 (j+2)-(j-L+1)+1= L+2。 我们可以推出列i+1上从行j-L+1到行j+2之间的序列一定不连续，否则D[j+2][i+1] &gt;= A+L+2-1= A+L+1，与我们先前的推导矛盾。所以，在j-L+1和j+2之间一定有一个列终止，这样才能消去一个序号。</p>\n<blockquote>\n<p id=\"此外我们还有一个疑问列i1上的序列-δ结束位置一定在j-l1和j1之间么我们要证明这个事\">此外我们还有一个疑问，列i+1上的序列-δ结束位置一定在j-L+1和j+1之间么？我们要证明这个事。</p>\n</blockquote>\n<p><strong>证明</strong> ：</p>\n<p>因为δ=j-D[j][i]=j-L+1-D[j-L+1][i]&gt;=j-L+1-D[j-L+1][i+1]，即列i+1上的 序列-δ的结束位置一定在j-L+1或者之后；</p>\n<p>由于j+1-D[j+1][i]&gt;δ，根据对角线法则D[j+2][i+1] &lt;= D[j+1][i]+1，有j+2-D[j+2][i+1]&gt;=j+2-(D[j+1][i]+1)=j+1-D[j+1][i] &gt; δ， 固列i+1上的序列-δ的终止位置一定在j+2之前，即j-L+1到j+1之间。</p>\n<p>后面推论2的分情况讨论，我一个也没证明出来，作者在论文中轻飘飘的一句话“后面很好证明，他就不去证明了”，但是却消耗了我所有脑细胞。所以，如果哪位小伙伴把推论2剩下的内容证明出来了，欢迎给我留言，我也学习学习。</p>\n<p>这个算法的时间复杂度是多少呢？作者用启发式的方法证明了算法的复杂度约为$ O(mn/sqrt[2]{b}) $，其中b是字符集大小。</p>\n<h4 id=\"代码实现\">代码实现</h4>\n<p>接下来说一下代码实现，给出我总结出来的步骤，否则很容易踩坑。</p>\n<ul>\n<li>编辑矩阵第一列，肯定只有一个序列。</li>\n<li>每次遍历前一列的所有序列，根据推论1和推论2计算后一列的划分情况。</li>\n<li>如果前一列遍历完毕，但是下一列还有剩余的元素没有划分。没关系，下一列剩下的元素都归为一个新的序列。</li>\n<li>预处理一个表，表中记录T中的每个字符在P中的位置。可以直接用哈希算法（最好直接ascii码）进行定位，如果位置不唯一，可以拉链。进行列划分计算时，从前往后遍历那一链上的位置，直到找到第一个符合条件的，速度出奇的快。尽可能少使用或者不要使用map进行定位，测试发现相当慢。</li>\n</ul>\n<p>接下来做最不愿意做的事：贴一个代码，很丑。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f35ef0cf87908839190\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninline int loc(int find[][200], int *len, int ch, int pos) {\r\n  for(int i = 0; i &lt; len[ch]; ++i) {\r\n    if(find[ch][i] &gt;= pos)  return find[ch][i];\r\n  }\r\n  return -1;\r\n}\r\n\r\nint new_column_partition(char *p, char *t) {\r\n  int len_p = strlen(p);\r\n  int len_t = strlen(t);\r\n  int find[26][200];\r\n  int len[26] = {0};\r\n  int part[200];  //记录每一个序列的结束位置\r\n  //生成loc表，用来快速查询\r\n  for(int i = 0; i &lt; len_p; ++i) {\r\n    find[p[i] - 'a'][len[p[i] - 'a']++] = i + 1;\r\n  }\r\n  \r\n  int pre_cn = 0, next_cn = 1, min_v = len_p;\r\n  part[0] = len_p;\r\n  \r\n  for(int i = 0; i &lt; len_t; ++i) {\r\n    //前一列partition数\r\n    pre_cn = next_cn;\r\n    next_cn = 0;\r\n    int l = part[0] + 1;\r\n    int b = 1;\r\n    int e = l;\r\n    int tmp;\r\n    int tmp_value = 0;\r\n    int pre_v = part[0];\r\n    //前一列第0个partition长度肯定&gt;=1\r\n    if(len[t[i] - 'a'] &gt;0 &amp;&amp; (tmp = loc(find, len, t[i] - 'a', b)) != -1 &amp;&amp; tmp &lt;= e) {\r\n      part[next_cn++] = tmp - 1;\r\n    } else if(pre_cn &gt;= 2 &amp;&amp; part[1] - part[0] != 0){\r\n      part[next_cn++] = part[0] + 1;\r\n    } else {\r\n      part[next_cn++] = part[0];\r\n    }\r\n    //每列第一个partition尾值\r\n    tmp_value = part[0];\r\n\r\n    //遍历前一列剩下的partition\r\n    for(int j = 1; j &lt; pre_cn &amp;&amp; part[next_cn - 1] &lt; len_p; ++j) {\r\n      int x = part[j], y = pre_v;\r\n      pre_v = part[j];\r\n      l = x - y;\r\n      if(l == 0) {\r\n        part[next_cn++] = x + 1;\r\n      } else {\r\n        b = x - l + 2;\r\n        e = x + 1;\r\n        if(b &lt;= len_p &amp;&amp; len[t[i] - 'a'] &gt; 0 &amp;&amp; (tmp = loc(find, len, t[i] - 'a', b)) != -1 &amp;&amp; tmp &lt;= e) {\r\n          part[next_cn++] = tmp - 1;\r\n        } else if(j + 1 &lt; pre_cn &amp;&amp; part[j + 1] - x != 0) {\r\n          part[next_cn++] = x + 1;\r\n        } else {\r\n          part[next_cn++] = x;\r\n        }\r\n      }\r\n      l = part[j] - part[j - 1];\r\n      if(l == 0) {\r\n        //新得到的partition长度为0，那么下一个partition的起始值比上一个partition尾值少1\r\n        tmp_value -= 1;\r\n      } else {\r\n        tmp_value += l - 1;\r\n      }\r\n    }\r\n    \r\n    if(part[next_cn - 1] != len_p) {\r\n      part[next_cn++] = len_p;  \r\n      tmp_value += len_p - part[next_cn - 2] - 1;\r\n      if(tmp_value &lt; min_v) {\r\n        min_v = tmp_value;\r\n      }\r\n    } else {\r\n      min_v = min_v &lt; tmp_value ? min_v : tmp_value;\r\n    }\r\n  }\r\n  return min_v;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f35ef0cf87908839190-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5b9f35ef0cf87908839190-81\">81</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-1\"><span class=\"crayon-e\">inline </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ch</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-8\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_column_partition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">26</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">26</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//记录每一个序列的结束位置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//生成loc表，用来快速查询</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-18\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-21\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_t</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//前一列partition数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//前一列第0个partition长度肯定&gt;=1</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-34\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-36\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-38\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//每列第一个partition尾值</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-42\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//遍历前一列剩下的partition</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-45\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_v</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-46\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">pre_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-47\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-48\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-50\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-54\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-56\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-58\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-60\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-61\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-62\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//新得到的partition长度为0，那么下一个partition的起始值比上一个partition尾值少1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-65\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-67\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-69\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-71\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-72\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">len_p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">part</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">next_cn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-73\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-75\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-77\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">_</span>value<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp_value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-79\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f35ef0cf87908839190-80\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_v</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b9f35ef0cf87908839190-81\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0371 seconds] -->\r\n<p></p>\n<h2 id=\"结语\">结语</h2>\n<p>这个算法应用到线上之后，效果非常明显，如下对比。</p>\n<ul>\n<li>优化前CPU：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/de059dade8a0991336671e2ca30ec6cc.png\"></li>\n<li>优化后CPU：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/119372838e68d1a9ee93196f799522a2.png\"></li>\n</ul>\n<p>能力有限，证明不充分，有兴趣的小果伴可以直接去看原版论文，欢迎交流，共同进步。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114324\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114324votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114324\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/506f77aba037cb2bd78064b80470760038a6d491.jpg"},{"url_object_id": "4d8d8d269b4a01449e795cdb98474804", "title": "程序员找工作面试会遇到哪些坑", "url": "http://blog.jobbole.com/114356/", "create_date": "2018/09/05", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/4a043f41f5b2e7764b45919c95078c9f.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "职场,面试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/smyhvae/p/9587950.html\">千古壹号</a>   </div><div id=\"cnblogs_post_body\">\n<h2 id=\"前言\">前言</h2>\n<p>我在JD工作已经有四个多月了，加班一直都比较多，不是因为工作量太大，而是因为自己不会的东西太多。电商行业的确是一个很锻炼人的地方。</p>\n<p>2018年4月份，我写的那篇文章《<a href=\"https://www.cnblogs.com/smyhvae/p/8732781.html\">裸辞两个月，海投一个月，从Android转战Web前端的求职之路</a>》，引起了很多同学的共鸣，甚至有几位同学留言说他们连续看了好几遍。这就让我诞生了一个想法：<strong>集中写一些和“职场”有关的文章</strong>。</p>\n<p>先简单介绍一下我的个人履历：我于2013年6月毕业于一个很普通的二本学校，2016年6月毕业于电子科技大学（985院校）。从学校毕业后，我的第一份工作是在一家不大不小的公司写代码。2018年4月，我来到JD工作，继续写代码，但是换了一个方向，几乎是从零开始积累。</p>\n<p>我经历过<strong>普通学校</strong>找工作时的无助，也经历过<strong>名校</strong>找工作时的各种大好机会。我经历过校招，也经历过社招。</p>\n<p>校招和社招的区别还是很大的，我准备分两篇文章来写。就比如，一个最典型的区别是：</p>\n<ul>\n<li>校招：公司全国各地跑，去学校招人。</li>\n<li>社招：求职者全国各地跑，去公司面试。</li>\n</ul>\n<p>今天这篇文章，我们就来聊一聊<strong>校招找工作时</strong>会遇到哪些坑。需要注意的是，这些坑不一定是用人单位让我们踩的，也有可能是我们自己给自己挖的坑。而最大的坑就是：我们什么都没做，不闻不问，让机会悄悄溜走。</p>\n<h2 id=\"找工作的最佳时间\">找工作的最佳时间</h2>\n<p>如果你现在在上大学，找工作的最佳时间，应该是大四上学期。也就是说，大三暑假这两个月，你要开始好好规划、好好准备了。如果找到比较满意的工作，可以考虑毕业前去实习。</p>\n<p>如果你现在在读研（学制一般是三年），找工作的最佳时间，是研三的9月份和10月份。也就是说，研二暑假的这两个月，你一定要多去图书馆，提升自己。</p>\n<p>当然，有些大公司会很早就开始招实习生，如果你有意向，也要尽早关注和准备。</p>\n<p>总而言之，校招找工作前，请一定利用好暑假那两个月的黄金时期，做一些功课，提升专业技能。可能会有些同学会利用暑假的时间做家教、学驾照等，具体怎么安排需要你们自己去权衡。我只提醒一点：临近毕业，没有什么是比你们的前程更重要的。错过了，就是一辈子。</p>\n<p>我猜，应该有一部分同学， 临近毕业的时候，还没有找到工作。如果是这种情况，我给不了什么建议，但有一点可以确定的是：<strong>请一定利用好在校期间的求职机会。如果等到毕业之后再找工作，将会非常艰难，要求也会非常高</strong>，因为那个时候，你走的不再是校招渠道，而是社招渠道，到时候你的竞争对象可是全国人民。</p>\n<h2 id=\"选哪个城市\">选哪个城市</h2>\n<p>找工作前，很多问题要想清楚，不要盲目找。首先要想清楚的是：毕业后你打算去哪个城市发展。</p>\n<p>就业机会、工资、房价、和妹子异地等等，这些都是需要去权衡的因素。至于何去何从，只有你自己能决定。</p>\n<p>就拿互联网行业的就业机会来举例，北京的互联网公司数量，占据了全国互联网公司数量的一半以上。看看下面这张图就知道了：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1349bf290aaa542c51c327323218744a.png\"></p>\n<h2 id=\"要投递什么岗位\">要投递什么岗位</h2>\n<p>大学里，有一些专业，毕业后是不太好找工作的，导致很多女生毕业后去做了微商。</p>\n<p>说到岗位，谈一下我所熟悉的互联网公司。如果你想进互联网公司，不一定要做程序员，其他岗位你可以考虑下，比如：产品、运营、测试等。这些岗位，在学校都是没有对应的专业的。需要的是你做出改变的勇气，并踏出第一步。</p>\n<h2 id=\"校招面试有哪些环节\">校招面试有哪些环节</h2>\n<p>一般来说，面试的流程分为：<strong>官网投简历、宣讲会、笔试、面试、offer发放</strong>。现在，我来逐一阐述。</p>\n<p><strong>投简历</strong>：</p>\n<p>大公司的校园招聘信息、流程、时间节点，一般都会在公司的官网挂出来。投简历时，我们只需按照上面的提示，进入指定的系统进行操作即可。比如腾讯校园招聘的官网是长这样的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/2f1e03af220f9606e9bbe740f7a1462b.png\"></p>\n<p>小公司的校园招聘信息，一般会挂在其他的聚合类网站上（比如学校的招聘网站、第三方的招聘网站等）。当然，我建议你，无论公司大小，都要去公司的官网瞧一眼。</p>\n<p><strong>宣讲会</strong>：</p>\n<p>企业去一个城市招人时，一般会先去学校举办一场宣讲会，给公司做做推广和宣传，说白了就是打广告。就拿四川的成都市来举例，成都市的高校数量，少说也有十几个，企业会在每个学校开宣讲会吗？当然不会。一般会首选电子科大学和四川大学，稍微有点情怀的企业，会再考虑一下西南交通大学。</p>\n<p>宣讲会一定要参加吗？答案是：如果你有空，就去参加；如果你没空，可以不去。有一点要注意：别错过笔试和面试的时间就好。</p>\n<p>参加宣讲会，只会让你对那家公司更加蠢蠢欲动，并不会增加你面试成功的概率。因为所有公司的宣讲会都是报喜不报忧，甚至有很多夸大其词的成分。</p>\n<p>我个人认为，企业在宣讲会上把公司夸得天花乱坠并不是什么好现象。当毕业生工作一段时间后，对所在公司的评价一般都是：“还行吧，就那样”，这个时候再想想自己曾经满怀期待参加过的那场宣讲会，难免会有一些心理落差。</p>\n<p><strong>笔试</strong>：</p>\n<p>有些公司的笔试会安排在学校的教室里，也有一些公司是<strong>在线笔试</strong>的形式。稍微大一点的互联网公司，基本都是在线笔试。</p>\n<p>所谓在线笔试，指的是：你在宿舍里打开电脑，开启电脑的摄像头，在指定的网站上做题目。</p>\n<p>有同学可能会问，在线笔试肯定很容易作弊吧？答案是肯定的。但是，作为应聘者，最重要的一条考核指标就是<strong>诚信第一</strong>。就算你以作弊的形式通过了笔试，可如果在面试环节，面试官问你：“你之前参加的笔试题目，给我讲一下你是怎么做出来的？”这很容易就看出你的水平和诚信问题了。所以说，轻微地作弊没有太大影响，但不要太过分就行了。</p>\n<p>温馨提示一下，笔试这个环节，至少会刷掉一半的人。如果你参加完笔试，发现自己很多题目都不会做，不要犹豫，赶紧准备下一家。</p>\n<p><strong>心理测试/行测题</strong>：</p>\n<p>在安排笔试 or面试之前，很多公司会首先要求你做一套<strong>心理测试题</strong>或者是<strong>行测题</strong>。这个环节，一般都不会刷人，如果遇到不会做的题目，网上基本也能找到答案。</p>\n<p>但有一些公司的心理测试题是具有一票否决权的。也就是说，就算你的笔试和面试的表现再好，可如果心理测试没通过，不好意思，你被刷了。</p>\n<p>比如华为公司在这一环节进行大量刷人，是出了名的。不少同学参加完华为的心理测试题，自我感觉良好，最后还是莫名其妙被刷。比如深圳的大疆公司，也会在这一环节刷掉一大批人。如果被刷，不要气馁，并不是你心理有问题，只能说，你与该公司的价值观不符，不如另谋高就。</p>\n<p><strong>面试</strong>：</p>\n<p>面试一般会安排在酒店进行。这个环节应该是最辛苦的，因为你要起得很早，坐公交地铁去市区，一天跑好几趟。你舍不得打车去，因为花了几十块钱赶到面试现场，最后只面了几分钟就完事，这种感觉是很失落的。</p>\n<p>面试请尽量不要迟到，如果和别的面试冲突了，建议提前联系 hr ，商量一下，另行约定时间，hr一般都会同意。联系hr时，建议先发短信，如果没有回复，再电话联系。</p>\n<p><strong>offer发放</strong>：</p>\n<p>如果你拿到了offer，那一定要以offer邮件为准。邮件上至少需要注明：月薪是多少、社保和公积金的缴纳基数和比例是多少。如果你接手offer，就可以开始签三方了。</p>\n<p>有些公司的hr可能会这样说：“恭喜你通过我们公司的面试，需要你马上过来签合同；否则，机会就留给别人了。”这个时候，你要好好斟酌一下机会成本。</p>\n<p>最后总结一句：一定不要错过各个面试环节的<strong>时间节点</strong>。</p>\n<h2 id=\"我们要做哪些准备工作\">我们要做哪些准备工作</h2>\n<p>针对每一次面试，我们要做到「有备而来」。</p>\n<h3 id=\"准备一段自我介绍\">准备一段自我介绍</h3>\n<p>毫无疑问，每一次面试，面试官问的第一个问题一定是：“你先做一段自我介绍”。假设一家公司有三轮面试，你估计要讲三遍自我介绍。</p>\n<p>根据我的经验来看，你完全可以提前准备一段自我介绍的<strong>模板</strong>，以后只要面试官问你该问题，你就这么回答。这是完全ok的。</p>\n<p>但是，自我介绍的模板一定要认真准备。你需要准备一段适合你自己的、为你自己量身定做的、符合你个人特点的模板，而且要走心。你有什么优势、有什么不足、有什么话你觉得可以让面试官眼前一亮的，都可以放到模板里。</p>\n<h3 id=\"把需要投递的公司在表格上记录下来\">把需要投递的公司，在表格上记录下来</h3>\n<p>校招时，我们每天都会不停地往各大网站投简历、填资料，这种操作称之为<strong>海投</strong>。时间一久，哪些公司你投过简历，根本就不记得。所以，最好是用表格把每个公司记录整理下来，表格里至少要包含如下信息：</p>\n<ul>\n<li>公司名称</li>\n<li>公司网址</li>\n<li>投递的网址、投递账号</li>\n<li>笔试、面试时间</li>\n<li>我当前的面试进展</li>\n</ul>\n<h3 id=\"把将要面试的公司做一个-todo-list\">把将要面试的公司，做一个 todo list</h3>\n<p>如果你今天有两个面试、明天有三个面试，难道面试的时间都要记在脑子里么？当然不是，我建议你列一个 todo list（待办事项）。比如，我当初参加校招时，是这样列出来的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/48964a86d1f82e7d54656d585eeb0f7f.jpg\"></p>\n<h2 id=\"校招找工作有哪些渠道\">校招找工作有哪些渠道</h2>\n<h3 id=\"各大公司的官网\">各大公司的官网</h3>\n<p>在向一个公司投简历之前，你需要做的第一件事，就是去看该公司的官网。大公司的校招信息，一定会首发在官网上。</p>\n<h3 id=\"第三方的招聘网站\">第三方的招聘网站</h3>\n<p>有些小公司可能没有网站，就算有网站，也是常年不更新。这些公司的招聘信息，一般会发布在第三方的招聘网站上。我所知道的常见网站有以下几个：</p>\n<ul>\n<li>大街网：www.dajie.com</li>\n<li>牛客网：www.nowcoder.com。牛客网上发布的招聘信息以互联网公司为主。</li>\n</ul>\n<h3 id=\"内推\">内推</h3>\n<p>我的上一篇文章，被读者问的最多的一个问题是：我是哪里找来的这么多的内推渠道。答案是：我都是找的校友。</p>\n<p>内推指的是“内部推荐”。比如说，我在京东上班，你可以直接把简历发给我，我再把你的简历转发给公司的hr。hr看了简历之后，如果满意，就会直接通知你来面试。</p>\n<p>有些童鞋可能会有疑问：“如果其他同学都走内推渠道了，那对于那些正常走校招渠道人来说，也太不公平了吧？”如果你有这种想法，那就大错特错了。当你去追求公平的时候，就已经输了。</p>\n<p>实质上，内推是有大大的好处的，我来给你分析下：</p>\n<p>从应聘者的角度讲，内推流程会快很多，可以省去漫长的校招流程。况且，如果内推没通过，可以继续走校招流程，二者并不冲突。</p>\n<p>从公司的角度讲，可以省去一大把筛选简历的时间。茫茫人海，简历多如牛毛，如果逐一筛选，实在是没有这个时间和精力，很容易漏掉有才华的人。一般来说，公司员工内推的简历，质量也不会太差。举个例子，小明毕业于电子科技大学，毕业后去BAT上班，小明给公司内推的简历，大部分都是来自电子科技大学的校友。所以说，内推的简历，整体质量都是比较高的。</p>\n<p>从小明的角度来讲，他如果把别人内推成功了，小明自己也会获得“伯乐奖”。</p>\n<p>千里马常有，而伯乐不常有。内推，会让hr在人群中多看你一眼。</p>\n<p>从上面的分析中，可以看出：毕业于一所好的大学，别的优势先不说，但至少会让你拥有重要的资源、环境、人脉。</p>\n<p>需要提醒你的是，内推渠道一般会比正式的校招渠道要早。如果你觉得自己的能力还不够，就不要去找别人内推凑热闹。有这个时间，还不如好好复习，准备校招面试。</p>\n<h2 id=\"是去大公司还是小公司\">是去大公司还是小公司</h2>\n<p>校招，毫无疑问，一定是优先考虑大公司。大公司的优势非常多，这一点，我以后准备专门写一篇文章。</p>\n<p>人生的第一份工作是很重要的。如果你去了一个毫不起眼的小公司，等你下次跳槽的时候，几乎没啥优势可言，除非你的能力非常强。但如果你的第一份工作是在大公司，以后跳槽的时候，你就是被别人捧在手心的宝贝。当然，我这么说，并不是鼓励大家跳槽，而是让大家明白：让自己升值，很重要。当你处在一家大公司的时候，你就已经升值了。</p>\n<p>关于“大公司与小公司的区别”，不少在校大学生，听过的最多的一句话是：“在大公司打工，你只是做一颗螺丝钉，发挥不了太大的作用；在小公司工作，你的综合能力会得到很好的锻炼”。在我看来，这句话是完全扯淡的。</p>\n<p>任何一项庞大的工程，本来就是分工协作的，你可以今天当螺丝钉，明天当螺丝帽，综合能力一样可以得到体现。</p>\n<p>我不鼓励应届生去小公司，主要是因为：很多小公司都比较坑，会通过各种手段损害、压榨员工的利益（具体内容我就不详细说了）。这种公司只能用三个字来形容：不靠谱。</p>\n<p>不少学生可能会有这样的期待：“我希望加入一家小公司，与公司一同成长。”如果你有这种想法，说明你还太年轻。据统计，92%的创业公司，活不过三年。你以为，在中关村摆个柜台，十年之后，就可以成为第二个刘强东么？</p>\n<p>当然了，有些情况，需要特殊考虑。举几个例子：</p>\n<p>比如说，小公司看中了你的能力，专门以高薪挖你过去，这个时候，你确实可以考虑一下。每一家成功的创业公司，一开始都是靠几个有非凡梦想、非凡能力的人撑起来的。阿里巴巴当初创业的时候，不也是有十八罗汉么？</p>\n<p>比如说，你拿到了两个offer：一家大公司、一家小公司。大公司是国企，据说在里面待着会比较闲，能力得不到提升。这个时候可以考虑去小公司，或者继续找其他的工作。</p>\n<p>比如说，你作为一个有梦想的热血青年，想去创业，那当然是应该值得鼓励的。</p>\n<p>充满期望、蒸蒸日上的小公司有吗？当然有，但比例很少。如果你想冒险一试，我不反对。</p>\n<p><strong>总结一下</strong>：如果你是像大部分人一样，是去给资本家打工的，请优先考虑大公司。</p>\n<h2 id=\"用人单位会有哪些坑\">用人单位会有哪些坑</h2>\n<p>用人单位的坑是很多的，尤其是在社招的时候，有非常非常多的坑。不过，本文讲的是校招，我就大概列举几条。</p>\n<h3 id=\"没有官方网站的公司要慎重\">没有官方网站的公司，要慎重</h3>\n<p>面试一家公司之前，要先了解一下该公司的基本介绍、公司所做的产品和服务、公司的成立时间、公司的人员规模、公司的办公地址等，另外还要了解公司的业绩和发展前景。这是作为求职者最基本的常识。</p>\n<p>为了清楚以上这些信息，我们首先应该想到的是：去该公司的官网看看。如果这家公司没有官网，那就一定要慎重。</p>\n<p>其次，我们还要去「国家企业信用信息公示系统」上查一下公司的基本信息，网址是：</p>\n<blockquote><p><a href=\"http://www.gsxt.gov.cn/\">http://www.gsxt.gov.cn/</a></p></blockquote>\n<p>上面这个网站，打开后的界面如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/3a3976342fae51347b55ff1f9e6a7be1.png\"></p>\n<p>通过这个网站，我们可以查到任何一家公司的基本信息：（成立时间、法定代表人等）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/73c8522391338c9c8ec075909df4660a.png\"></p>\n<p>如果你在上面这个网站上没有找到某公司的信息，放心吧，这个公司一定是个骗子。</p>\n<p>另外，我们还可以去其他的第三方网站上查某公司的更多信息，在此推荐几个网站给大家，方便大家查询各种公司的各种信息：</p>\n<ul>\n<li>天眼查：www.tianyancha.com</li>\n<li>企查查：www.qichacha.com</li>\n<li>看准网：www.kanzhun.com</li>\n</ul>\n<p>有些小公司会跟你说：“试用期期间，会安排你去另外一个地方集中培训几个月，你甚至要先交点钱。”这个时候你要注意了，这很有可能是一个传销组织。之前在各大招聘网站上，发生过很多求职者被骗的例子。比如下面这条新闻，可是震惊大江南北的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/20bbf0cfd73920b10e2fe9ed89e10b94.png\"></p>\n<h3 id=\"有些公司只是来做宣传的\">有些公司只是来做宣传的</h3>\n<p>有些公司，你从来就没听说过他的名字，或者说，你从来没有听说过该公司的产品。但是在宣讲会上，这些公司却把自己夸的天花乱坠。放心吧，这些公司基本不是来招人的，而是来做宣传的。你参加了这个公司的笔试题，然后就不会有下文了。</p>\n<p>但是应聘者的时间是很宝贵的，参加了这个公司的笔试，也许就错过了另外一家公司的机会。所以说，你自己要好好权衡。</p>\n<h3 id=\"毕业前签约毕业后毁约\">毕业前签约，毕业后毁约</h3>\n<p>有些公司是挺搞笑的，你毕业前，公司和你签约了；等你毕业后，公司马上和你毁约，甩掉你。</p>\n<p>大公司一般不会这么做，有损公司名誉，就算这么做，好歹也是等你工作几个月再裁掉你（比如酷派公司在2017年就对应届生这么干过）。</p>\n<p>给大家举一个真实的例子：</p>\n<p>我当初在读大四的时候，有一家本地的刚成立的小公司来我们学院疯狂招人，光是我们班，就招了近10个过去。辅导员甚至鼓励学生们去那家公司。</p>\n<p>辅导员当时乐开了花，恨不得那些没找到工作的学生，都去跟这个公司签合同。为什么这么说呢？如果大家都有工作了，那学生的就业率就是100%，辅导员的业绩和指标就上去了。我非常清楚的记得，合同签完之后，那家公司的老板请辅导员和学生们大吃大喝了一顿。</p>\n<p>最后的结果是什么样子呢？毕业之后，那家公司把招到的学生全部辞退了，因为公司的工厂都还没建好，又怎么可能还招人干活呢？</p>\n<p>那些学生怎么办呢？只能各回各家，各找各妈。学校和辅导员只关心学生们<strong>在校期间</strong>的就业率，等你一毕业，就跟学校没有关系了。</p>\n<p>所以说，我的建议是：一些小公司，尤其是那种刚成立不久的公司，应届生一定要慎重。就怕你到时候不仅没工作，而且也错过了找其他工作的时机，上哪儿哭去？</p>\n<h3 id=\"社保和公积金\">社保和公积金</h3>\n<p>社保和公积金这部分，也是个大坑。你一定要了解清楚。</p>\n<p>社保一般由五个部分组成：养老、医疗、失业、工伤、生育。</p>\n<p>应届生们一般只关心的问题是“公司会不会交社保和公积金”。但这远远不够，你更应该关心的是“交的基数和比例”。</p>\n<p>给大家举个我自己的例子：</p>\n<p>我毕业之后，第一份工作是在 <strong>H公司</strong>（公司的名字先这么叫着） ，给我的月薪是 <strong>1W</strong>（这不是我的真实工资，我只是为了方便给大家打比方，但缴纳的比例是真实的）。这1W的月薪，是这么组成的：</p>\n<ul>\n<li>基本工资 5000元 （这同样也是我缴纳社保、公积金的基数）</li>\n<li>绩效工资 4000元（绩效工资每个月都会给满）</li>\n<li>房补 1000元</li>\n</ul>\n<p>当时拿到offer的时候，公司说从试用期开始就会给我交社保，于是我也就安心了。当我拿到第一个月的工资时，我才发现 H公司 是多么的抠门：</p>\n<ul>\n<li>医保每月共缴纳 40元。包括：公司缴纳 5000 * 0.6% = 30元，个人缴纳 5000 * 0.2% = 10元。而且缴纳的是深圳市二档医保。普通门诊是无法报销的。</li>\n<li>公积金每月共缴纳 500元。包括：公司缴纳 5000 * 5% = 250元，个人缴纳 5000 * 5% = 250元。</li>\n</ul>\n<p>等我来到了 JD公司工作，公司每月给我缴纳的医保和公积金情况是这样的：（同理，这个基数不是我真实的工资和基数，我只是为了方便给大家打比方，但缴纳的比例是真实的）</p>\n<ul>\n<li>医保每月共缴纳 2100元。包括：公司缴纳 10000 * 13% = 1300元，个人缴纳 10000 * 8% = 800元。而且缴纳的是深圳市一档医保，普通门诊可以报销。</li>\n<li>公积金每月共缴纳 2400元。包括：公司缴纳 10000 * 12% = 1200元，个人缴纳 10000 * 12% = 1200元。</li>\n</ul>\n<p>把 H公司 和 JD公司 对比一下，你会发现：H公司缴纳的基数和比例很少。每个员工少缴纳几千，再乘以员工总人数，这样算下来，H公司 能省一大笔钱。</p>\n<p>我想，我已经讲得够清楚了吧？</p>\n<h2 id=\"关于培训机构\">关于培训机构</h2>\n<p>前几年，互联网行业如井喷式发展，连猪都能飞起来，互联网行业的工作也随之热门起来。大家听说互联网的工资高，于是纷纷涌进来。</p>\n<p>工资高是真的，但加班疯狂也是真的。</p>\n<p>我知道，很多非计算机专业的学生，为了学编程写代码，会花半年的时间，交几万块钱，去参加线下的培训班。如果你现在还有这种想法和行为，我的建议是：请三思、请慎重。</p>\n<p>首先，程序员这个岗位的学习成本和难度并不低，你要考虑一下写代码是否真的适合自己。很多时候，你觉得自己对某个东西感兴趣，是因为不了解。</p>\n<p>其次，你参加了培训班之后，再去找工作，我猜你在简历上保证不敢说自己参加过培训班。因为，现在很多公司招人，对培训班出来的学生是比较抵触的，这些学生只是为了速成，计算机基础的底子太差。</p>\n<p>不少培训机构说：“只要你来参加我的培训班，我保证给你推荐就业”。这句承诺基本是骗人的。会不会给你推荐就业我不知道，但培训机构的老师教你<strong>简历造假</strong>，是常有的事。</p>\n<p>再次，如果你真的一点基础都没有，直接去参加线下的培训班，节奏肯定是肯快的，你估计适应不了。还不如买一些线上的视频来自学，自己在家里看，想暂停就暂停，还可以倍速播放。我看慕课网上的IT视频，质量都挺高（慕课网的同学看到后请自觉赞赏）。当然了，看线上视频自学，你得有很好的自制力才行。</p>\n<p>最后，如今的经济形势不太好，很多互联网公司都抱团取暖，互联网的岗位显然是僧多粥少。而最大的问题在于：很多程序员只是处于入门的水平，真正有水平的程序员太少了。</p>\n<h2 id=\"关于考研\">关于考研</h2>\n<p>不要一边考研一边找工作。如果同时做两手准备，很有可能最后两边都没有收获。</p>\n<p>是否考研，你在大三的时候就应该考虑清楚。如果你打算考研，就请专心考研，不要给自己留退路。</p>\n<p>那到底有没有必要考研，这个话题有点长，以后专门写一篇吧。</p>\n<h2 id=\"一些其他的疑问\">一些其他的疑问</h2>\n<h3 id=\"面试要不要穿正装\">面试要不要穿正装？</h3>\n<p>要不要穿正装，取决于你面试的是什么岗位。</p>\n<p>如果你面的是销售岗位，那毫无疑问，无论刮风下雨，无论烈日炎炎，都要穿西装打领带。不过你放心吧，校招面试的地方一般都是在酒店等有空调的地方，不会太热。</p>\n<p>如果你面试的是屌丝程序员岗位，着装是没有特别的要求的，不要太随意即可。穿个大头鞋去面试是肯定不允许的。当然了，短袖<strong>衬衫</strong>肯定是要比短袖<strong>T恤</strong>要更有精气神儿。这个你们就自己决定吧。</p>\n<p>如果你面试的是其他岗位，是否要穿正装，你最好是提前问清楚（问学长学姐、问其他面试的人等）。</p>\n<h3 id=\"该如何谈薪资\">该如何谈薪资</h3>\n<p>校招的薪资一般都是白菜价（统一价），这个没什么好谈的。除非你能力非凡，拿到 special offer，那当然可以跟hr谈一谈。</p>\n<h3 id=\"成绩单的原件一定要放在自己手里留着\">成绩单的原件一定要放在自己手里留着</h3>\n<p>有些公司面试，会看你的成绩单。有些同学在校期间是学霸，会主动把成绩单放在简历下方递给面试官。</p>\n<p>我需要提醒你的是：把成绩单的<strong>复印件</strong>给别人就好，请你自己妥善保管好<strong>原件</strong>。</p>\n<h3 id=\"简历可能要投很多次但一定要有耐心\">简历可能要投很多次，但一定要有耐心</h3>\n<p>一般来说，投递十家公司，如果能有一家公司给你回应，那就算很不错的了。所以，你一定不要气馁，多投一点，没关系。而且，在投递的过程中，请不断完善简历。</p>\n<h2 id=\"我自己的校招经历\">我自己的校招经历</h2>\n<p>我可以比较自豪的说，我是毕业于985院校的研究生。我也可以很自豪的说，在我研三找工作的时候，你能想到的任何一家有名气的互联网公司，都会来我们学校做招聘。</p>\n<p>但经过一个多月的海投，我最终只拿到了两家公司的offer：中兴公司 和 H公司。</p>\n<p>很遗憾，那些你能想到名字的互联网公司，我都投过简历，但都挂了，无一幸免。眼看着我们班的其他同学手里的offer，覆盖了每一家大型互联网公司，我这心里真不是滋味。</p>\n<p>我的室友是班上公认的学霸（我在读研期间，宿舍是二人间），专业能力也非常强，很多同学平时遇到上问题都是向他请教。可惜，他到了十月份的时候，手里一个offer都没有，最后去了老家那边的国家电网，做一个小镇的无名码农。</p>\n<p>关于校招的内容，我就写到这里。针对校招，如果你有好的建议、你踩过了哪些坑、你有推荐的资源或网站，欢迎在文本的下方留言。</p>\n<p>想看看我对社招的看法吗？且听下文分解。</p>\n<h2 id=\"最后一段\">最后一段</h2>\n<p>有人说，找工作全靠运气。但我认为：在运气来临之前，越努力，越幸运。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114356\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114356votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114356\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/4e2da4795d7525d292c45ac4cc7df0bcacf45e47.jpg"},{"url_object_id": "a49e55ee9903149a00118337ee891fd3", "title": "一名 IT 经理是怎么把一个项目带崩的", "url": "http://blog.jobbole.com/107390/", "create_date": "2018/09/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/862d3441fe78a8d48f7dc96d0acc95d2.jpg"], "praise_nums": "4", "comment_nums": 6, "fav_nums": 3, "tags": "职场,PM", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/lxtalx\">zer0Black</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>我是一名项目经理，在过去的四个月里，我把一个项目带崩了（上线后频出问题，用户无法使用）。在最近的几天，我每天都在反思自己，我都在问自己以下几个问题：</p>\n<p>1.我做错了什么？<br>\n2.我在其中占有多重的因素？</p>\n<p>以下内容，我将回答以上问题，并在最后说一下我的补救措施。</p>\n<h2 id=\"项目和团队背景\">项目和团队背景</h2>\n<p>首先给大家说明一下项目背景，以便各位对此项目有更清晰的了解：</p>\n<p>1.该项目是一个二次开发项目，第一个基础版本（打印申报系统）也由我带领开发。<br>\n2.系统是需要和国家系统对接，有三条主流程。<br>\n3.需求频繁变化，由于系统需要对接国家系统，需求方对需求也不甚了解。曾在5月份一个月内需求变更超过8次，都是主流程变更。<br>\n4.项目大小按照最初需求估算，约在100人天左右。<br>\n5.项目两条主流程无法测试，依赖于外部U盾，但开发过程中并没有U盾。<br>\n6.客户现场使用U盾调试和开发时间约为20天左右。<br>\n7.我当时同时负责大大小小4个项目，没有进入开发，仅管控进度。<br>\n8.团队成员共3名，其中两名是当时开发基础版本的项目成员，他们对此项目较为熟悉。<br>\n9.项目推进过程中，需要多次去现场调试测试，由团队中的两名工程师共同前去。</p>\n<h2 id=\"我做错了什么\">我做错了什么</h2>\n<h4 id=\"除了监控进度还要管理质量\">除了监控进度，还要管理质量</h4>\n<p>在项目的开发初期，我制定了一份详细的开发计划，用于指导整个开发过程。开发计划交付与了客户，而答应了的事情就要做到，所以在整个项目过程中，我对进度管控很严。我定期检查功能是否完成，定期和客户汇报情况，保证了开发进度顺利推进。但也由此埋下了祸根，仅仅看需求是否完成，而未关注完成的质量如何。</p>\n<p>项目质量出现了许多细节性问题。比如：</p>\n<p>1.上线后，客户那边发现其中一条主流程都走不下去<br>\n2.其中申报功能，系统提示成功。但实际上并没有真的申报成功，申报后在国家系统无法查询到<br>\n3.打印功能小问题较多，打印获取的数据错误<br>\n4.同步数据的功能无法同步或者同步的数据错误<br>\n5.执行时间过长的功能，数据库会强制断开连接</p>\n<p>等等问题，就不一一列举</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.进度和开发速度固然重要，但以质量换速度不可取<br>\n2.如果开发时间和质量冲突，优先保质量，毕竟你埋下的坑，总是要坑你自己的<br>\n3.再困难的情况下，也要保证基本测试<br>\n4.时间极其不允许的情况下，也要保证主线功能顺利执行</p>\n<h4 id=\"既要给予信任也要保持警惕\">既要给予信任，也要保持警惕</h4>\n<p>项目中的三名成员，都是合格的开发，对使用的框架非常熟悉。其中两名还是基础版本开发成员，对需求也很熟悉。所以项目中，我放心的把整个项目交给了他们。基于对他们的放心，加上其他项目事情繁杂，对此项目关注度，对他们的关注度就不够了。</p>\n<p>我在项目中给予了他们非常充分的信任，信任他们可以把一切事情都做好。但我没有在正确的时候给予他们正确的指引，项目中出现的困难点，我也没有帮助他们解决，甚至于没有给出思路。所有的一切，都靠他们自己完成。我在这个项目里做的，就是对接客户，催进度。再无第三件事。</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.不论什么原因，都要关注到项目成员的状态<br>\n2.给予信任没错，但也要适当保持警惕，他们多少会因为经验问题疏忽遗漏一些问题<br>\n3.给予信任，也要给予帮助，不以时间为理由推脱你应该对他们进行的指点和帮助。毕竟现在剩下来一分钟，以后要花一个小时去弥补</p>\n<h4 id=\"若无法全局掌控就指派专人负责\">若无法全局掌控，就指派专人负责</h4>\n<p>这是我在项目中做的最错误的地方。</p>\n<p>由于种种原因，我无法掌握到项目的每个要点和细节。而项目中有三个开发。我并没指明其中某一个来负责整个项目，所有事情都让他们自己商量。从客户对接来的问题，我也是仅告知对应的开发。整个项目中，没有一个人对项目中的每个要点了如指掌。</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.手里捏着管理的权利，却没有做到管理的事情。是我在这个项目里最大的问题<br>\n2.授权！授权！授权！如果自己无法亲力亲为投入项目管理工作，就授权给团队某个成员管理权限，让他代替你去做管理工作<br>\n3.管理一人，总比管理多个人轻松，也更有效</p>\n<h4 id=\"要控制需求更要控制流程\">要控制需求，更要控制流程</h4>\n<p>项目是二次开发、成员对项目很熟悉、项目工作量不大、时间紧。</p>\n<p>基于以上原因，我掉以轻心，没有在项目初期进行项目的设计和规划，未指定任何开发规范。仅仅告诉开发的同事要多复用，也未检查他们是否真的复用了。</p>\n<p>项目开发中的需求变更，客户反馈意见，我我都仅仅是告知他们一声，未做详细的修改规划，所有事情都靠嘴说，所有变动都放在了我和他们的脑子里。</p>\n<p>对项目上心程度不够，未对客户的需求变更做控制和管理。所有变更都压给了开发的同事。</p>\n<p>整个项目以及其不规范的方式在运行，我也未在其中起到控制作用，项目开发一团乱麻。</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.不做设计，不进开发<br>\n2.以管理工具指导开发进行，开发过程中所有变更、反馈做记录<br>\n3.控制需求变更，拒绝不合理的需求<br>\n4.需求变更规范化操作，统一变更，而不是直接压给开发</p>\n<h4 id=\"无论什么情况下都要进行code-review\">无论什么情况下，都要进行code review</h4>\n<p>整个项目过去了几乎四个月，我仅仅花了两个多小时简单看了下代码，未指出代码的任何问题。这也导致出问题后来我花了成倍的时间来处理code review的工作，并且项目成型后的代码修改困难。</p>\n<p>项目开发过程中，也未让开发间互相进行代码review，也没有进行代码评审会。</p>\n<p>其实代码中出现了很多问题，最后检查代码的时候，发现各种命名不规范、代码复用不到位、简单逻辑复杂写等等。而这些问题，很大一部分都是早期未做规定，未指定人负责项目、未进行早期code review造成的。开发各自为战，难免造成代码问题。</p>\n<p>代码质量的问题，淋漓尽致的体现的在项目中，项目中的诸多bug，都是因为代码不规范引起的。甚至于开发人员自己对自己写过的东西，都有些拎不清了。</p>\n<p><strong><em>反思：</em></strong></p>\n<p>1.代码质量非常重要，代码越规范bug越少<br>\n2.代码互评能让开发更注重自己代码的质量<br>\n3.code review非常有必要，越早期的code review越能有效的节省后期的时间</p>\n<h2 id=\"我在其中占有多重的因素\">我在其中占有多重的因素</h2>\n<p><strong><em>100%</em></strong></p>\n<h2 id=\"我怎么填坑的\">我怎么填坑的</h2>\n<p>项目上线，问题频出，用户不满。花了8天时间来处理这个问题。幸亏项目不大，我一个人也能够挽回。</p>\n<p>目前暂时解决完毕，我简单说一下我是怎么填坑的：</p>\n<p>1.和开发主流程的同事详细熟悉了所有需求要点<br>\n2.基于我对项目需求的熟悉，我花了三天把所有主流程的所有代码分析完毕，做出了我认为应该的修改，并实施部署到生产环境测试（这是在给开着的飞机换引擎，但需要U盾才能测试，仅有生产环境的机器有U盾，别无他法）<br>\n3.每天花超过12个小时来进行code review 和修改，几乎每天code review + 修改到凌晨2点多（仅修改了问题较大且影响较小的地方。小问题未修改、牵涉面较广的地方未修改）<br>\n4.每次上班时间的修改让开发同事坐在旁边和我一起进行，我进行修改，开发同事在一旁监督。确保我不出错<br>\n5.优化功能点，把我发现的提示问题，和优化点都同步修改进代码中，确保用户体验不要太糟，以期能挽回一些用户心态</p>\n<h2 id=\"我所吸取的教训总结\">我所吸取的教训总结</h2>\n<p>1.先设计，后开发<br>\n2.管理权下放，项目中必须有人全身心负责<br>\n3.无论什么情况都要进行code review<br>\n4.压缩质量得到的进度保证不可取，开发周期不合理决不答应客户。否则坑了自己坑了同事，更坑了客户</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"107390\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"107390votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"107390\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 6 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx\">zer0Black</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2016/02/7345325ae6842e24247f60a113f61ce3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            目前工作为移动开发，兴趣广泛，计算机各方面均有强烈兴趣。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/lxtalx\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/lxtalx/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/lxtalx/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 26</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/1851062185\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/158533223be951655a2f62a70168e5e8fc06b8cc.jpg"},{"url_object_id": "757a9d509dad152ec7c7abb8b8a7419b", "title": "彼之蜜糖，吾之砒霜 —— 聊聊软件开发中的最佳实践", "url": "http://blog.jobbole.com/114361/", "create_date": "2018/09/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/aac3e1c638967b5812c7816b91669d20.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 2, "tags": "IT技术,实践", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/sherrywasp/p/9436623.html\">sherrywasp</a>   </div><div id=\"cnblogs_post_body\">\n<p> <img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ac6c4eb408f3b5aadc0c97490a6a5bb0.jpg\" alt=\"\"></p>\n<p>“描述一个事物，唯有一个名词定义它的概念，唯有一个动词揭露它的行为，唯有一个形容词表现它的特征。要做的，就是用心去寻找那个名词、那个动词、那个形容词……”</p>\n<p>—— 福楼拜 (Gustave Flaubert)</p>\n<p>我想讲个故事。</p>\n<p>很久很久以前（一般讲故事都是这样开头吧）， 两个老工程师在一起聊天，谈各自生涯中最自豪的工程。其中一个先讲述了他的杰作：</p>\n<p>“ 我们建造的桥，横跨一个峡谷，峡谷很宽很深。我们花了两年时间研究地质，选择材料。聘请了最好的工程师团队来设计方案，而这又花了五年时间。 我们签下了最大的工程队，委托他们建造基础结构、塔墩、收费亭，以及用于连接桥梁和高速公路的道路。桥面下层是铁路，我们甚至还修了自行车道。 那座桥花费了我数年的心血。”</p>\n<p>另外一个听完之后，陷入了沉思，过了一会儿，说到：</p>\n<p>“ 有一天晚上，我和一个朋友喝了点伏特加，然后我俩扔了一根绳子，越过一个河谷。呃…… 就是一根绳子，两头系在两颗树上。 河谷两边各有一个村庄，起初，有人加了个滑轮，用来传递包裹。然后，有人拉起了第二根绳子，勉强可以走走，虽然很危险，但小伙子们很喜欢。 后来，一群人重新修建了一下，使得更牢固。于是，女人们也开始从上面走，每天带着她们的农产品过桥。 就这样，在桥的另一边形成了一个市场。因为地方开阔，造了很多房子，慢慢地发展成了一个镇子。 绳索桥被木桥替代，这样就可以走马车了。 后来，镇上的人们修了一座真正的石桥。再然后，人们又把石料改成了钢材。 如今，那座钢构悬索桥依然伫立在那里。”</p>\n<p>前一个工程师沉默良久，说到：“ 有意思。我那座桥建成大约十年后，被拆除了。事实证明我们选错了地点，建好的桥没人用。据说有几个野路子的家伙，在下游几英里处，拉了一根绳子，所有人都从那走。”</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/f5322a1403f8c44ee9b3f966e2735857.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\">金门大桥（旧金山）</p>\n<p>我很喜欢这个故事。故事的出处，在一款消息队列产品—— ZeroMQ 的<a href=\"http://zguide.zeromq.org/page:all#header-167\" target=\"_blank\">官方指南第6章</a>里。</p>\n<p>说完故事，我想聊聊软件开发中，常常可以听到的一个概念 —— <strong>Best Practice</strong> ：<strong>最佳实践</strong>。Wikipedia 上对其解释为：</p>\n<p><em>A best practice is a method or technique that has been generally accepted as superior to any alternatives because it produces results that are superior to those achieved by other means or because it has become a standard way of doing things.</em></p>\n<p>(最佳实践是一种：因其产生的结果优于其它选择下的结果，或其已经成为一种做事的标准，从而被普遍认可优于任何替代方案的方法或技术。)</p>\n<p>这个概念源于管理学，然后在 IT 界泛滥。简而言之，就是所谓“正确的做法”。</p>\n<p>最佳实践本身是美好的存在，犹如夜空中的一轮明月，照亮黑暗中的方向，指引着摸索前行的凡人。</p>\n<p>但凡事有度，子曰：“过犹不及。”</p>\n<p>我今天想说的，就是这<strong>月亮的背面</strong>。（传说中，月球背面隐藏着…… 嘘~）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/0a06d21f159eb9efbafc53eba808fd2d.jpg\" alt=\"\"></p>\n<p>潮汐锁定导致月球永远以同一面朝向地球</p>\n<p>首先，<strong>最佳实践容易带来思想包袱，让人无法专注于解决问题本身。</strong></p>\n<p>总是希望采用最好的技术方法，不愿意在不正确的做法上浪费时间，导致瞻前顾后，甚至裹足不前。此时的最佳实践，已然成为了一种毒药，一旦偏离了问题本身这个出发点，就会不知不觉走进“宏大构想”的思维陷阱。把简单的问题复杂化，阻碍了迈出第一步，直到能规划出“包罗万象”的解决方案后才肯动手，拖延症就这样来了，时间却走了。</p>\n<p>你想好了未来每一天怎么过吗…… 没想好？ 那……不活了？</p>\n<p>其次，<strong>对最佳实践的执念容易让人钻牛角尖，将目标的重心带偏。</strong></p>\n<p>过度关注实施过程是否符合标准化，忽视了项目中其它重要的东西，比如用户体验，比如实际需求。就像故事里讲的那样：第一座大桥，几乎是教科书般的标准化路数，可产品落地后和客户需求却差了好几英里；第二个看上去很野路子，但精准地解决了痛点，从始自终都是紧紧围绕实际需求迭代，每一次的进步都可以产生效用，这才叫杀手级应用。</p>\n<p>这让我想起了 <strong>Plan-9</strong> 的传说。</p>\n<p>你听说过 Plan-9 OS 吗？ 一款由贝尔实验室的极客们打造的用于完善 UNIX 不足的操作系统。什么不足？在 UNIX 的哲学中，有一条叫做 “一切皆文件” ，但实际上UNIX本身并没有严格遵从这一条。于是，Plan-9 OS 完美实现了这一点。然后呢……？ 没有然后了。它从没进过市场，所以如果你没听说过它，一点也不奇怪。Plan-9 OS 没有解决任何现实问题，没人在乎 “一切皆不皆文件”。</p>\n<p>这种执念的另一种表现就是<strong>工程师思维，沉迷于奇技淫巧中无法自拔，</strong>程序员尤其容易中招。</p>\n<p>比如性能优化。“优秀的程序员应该榨干每一字节内存”，听起来很熟悉，不是吗？但经济学上来讲，边际效应决定了一次项目中，越优化性价比越低。有一个很容易被忽略的事实：<strong>硬件其实比程序员要便宜</strong>。</p>\n<p>再比如对设计模式的崇拜。设计模式当然是好东西，但如果像强迫症一样使用它们，坚持用上它们才是正确的编程，就会导致按图索骥，强行让问题去适应设计模式，而不是让解决方案针对问题，这就本末倒置了。</p>\n<p>我有个基友，C++ 极客。毕业后入了腾讯，积累了巨额财富后，自己创业了。当然，当老板可比写 C++ 难多了，于是现在又去积累巨额财富了。想当年和那厮聊天，言必出设计模式，没事侃正则，再没事就研究 GC 策略 (好像玩 C++ 的普遍这德性) 。前不久看他代码，差点没认出来，这家伙画风一转，现在连接口都懒得多用（估计看到这，某些狂热分子肯定在破口大骂：你什么意思，你说你没用面向接口编程？）那位兄台甚至都懒得多聊，轻描淡写来一句，“没心思，以后有需要再加。”</p>\n<p>顺便扯一句，那哥们最近负责开发一款手游，他跟老板汇报的时候，预估的研发周期要12个月，然后老板跟他说：“好，12月出公测。” (哈~ 估计他肯定舌头打结把“12个月”说成了“12月”)。看到这的你，是否回忆起了你的老板？</p>\n<p>这也是我接下来想说的关于最佳实践的另一个问题：<strong>项目实施。</strong></p>\n<p>工作数年，大小项目经历若干，慢慢体会到，一个项目的开发顺利与否，并不在于技术选型是否为最佳实践，更多的时候，取决于开发方案和技术储备之间的平衡。<strong>做项目毕竟是要讲方案落地的</strong>，如果最佳实践中的技术成本，超出了开发者的落实能力，那就是坑，这时盲从最佳实践无异于挖坟。如果是一个人的项目，抽时间恶补一通，兴许能填填坑，这取决于IQ。但要是一个团队，那就不是什么 IQ，EQ，QQ 的问题了，这中间产生的学习成本，集体培训成本，反复沟通成本，大量的初级错误，千奇百怪的代码，互相冲突引发的焦躁情绪，等等。这些负面的东西如果不能妥善的处理，足以抵消掉最佳实践带来的好处。别忘了，deadline 正在迫近。</p>\n<p>我自己曾经在一个项目组里，强行推行 <strong>Git</strong> 做源代码管理，当时组里共9人，有7人只会 SVN，但我坚持 Git 是 “最佳实践”。要不说年少无知少不更事呢，罢了，后来的事情我不想回忆了…… 那次项目之后，我再也不在一群只会 SVN 的队伍里提 Git 了。</p>\n<p><strong>一个人做软件已经很难，比这更难的，是一群人做软件。</strong></p>\n<p>当尘埃落定，蓦然回首，最佳实践很可能<strong>没你想象中那么重要</strong>。它更多的是一种精神层面的求道，并非物质世界的必要。</p>\n<p>扎克伯格 ( Mark Zuckerberg ) 于2004年在哈佛柯克兰公寓 ( Kirkland House ) 里写出 <strong>TheFacebook</strong> 的时候 ( 次年更名为Facebook ) ，用的是 “世界上最好的编程语言” PHP。这门可能是业界被吐槽次数最多的语言一直支撑着FB帝国的诞生，直到席卷全球。<strong>Stack Overflow</strong> 的联合创始人 Jeff Atwood 曾公开揶揄 Facebook 是一家 “召集全球顶级程序员在 Windows XP 上写 PHP ” 的公司。但这无所谓，24年前的马克也不纠结。一直等到需要的时候 (2010年)，Facebook自己动手研发了一个编程语言 —— Hack，来解决 PHP 带来的危机。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/ed53b98d1cb369ab305dcb69e00fbe53.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\">《社交网络》</p>\n<p>最佳实践，关键在时机（Timing）。</p>\n<p>如果说用 Facebook 这个 “根本不存在” 的网站来举例，纯属虚构的话，那我们来说点真实的例子，Web 技术的基石——<strong>HTML</strong>。由20世纪最重要的100人之一的 <strong>Tim Berners-Lee</strong> 创造的 HTML，其发明之伟大，足以单独开篇博文来赞美了，这里就不赘述了。</p>\n<p>这样一个造福全人类的神作，本身的设计结构绝非完美，甚至可以用混乱不堪来形容。没有严格统一的约束，形同虚设的规范，标准化进程的难产。以至于在很长一段时间内，连自身元素的定义，都可以向浏览器厂商妥协。但是，种种被人诟病的存在，丝毫不影响 HTML 改变世界的脚步。你我今天能相会于园，皆仰赖它的诞生。</p>\n<p>同样的例子还发生在 Web 世界另一个巨擎上——<strong>JavaScript</strong>。当今世界，Web 前端技术已经水银泻地般肆虐整个开发界，前端框架百花齐放、JS 衍生品鳞次栉比。所有这一切的背后，全都源于上世纪90年代横空出世的 JavaScript。</p>\n<p>那么，JavaScript是最佳实践吗？</p>\n<p>别逗了，如果有什么语言可以和刚才说到的 PHP 竞争一下谁被骂的次数更多，那非 JavaScript 莫属。这个仅花了十天设计出来的语言，打一出身就被贴上了怪胎的标签。混乱的标准，多样的实现，安全漏洞，语法随意，反人类…… 总之，JavaScript 和最佳实践半毛钱关系都扯不上，但它却是撑起当今互联网半壁江山的擎天柱。</p>\n<p>所以，用最接地气地话来说，不管黑猫白猫，逮着耗子就是最佳实践猫。</p>\n<p><strong>彼之蜜糖，吾之砒霜。</strong>所谓最佳实践，其定义本身往往也是分歧的源头。什么是最佳？这个最佳是独一无二的吗？世界上有很多很多现实问题，可能根本就没有所谓的最佳实践。</p>\n<p>请听题，世界上最好的编程语言是哪个？</p>\n<p>第二题，世界上最好的文本编辑器是哪个？</p>\n<p>朋友，这天还聊得下去吗……</p>\n<p>最后，说一个我自己的故事。</p>\n<p>很久很久以前，为了找一款满意的文本编辑器，我干了一件可能是前无古人，后不知道有没有来者的蠢事 —— 我打开 Wikipedia，搜索 “ text editor ” ，然后转到一个叫做 “ List of text editors ” 的页面，接下来的一个月，我几乎把当时那个页面上，所有我能下载安装的文本编辑器，全部试用了一遍……</p>\n<p>嗯？你问我为什么这么做？呵呵，不把全世界的文本编辑器遍历一遍，我怎么知道哪个是最好的？</p>\n<p>这事细节我不想再提了，我也不想回忆了。要不说年少无知少不更事呢，时至今日，我想不出比这更愚蠢的事了。WTF~~</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/92c09b44bc648c3b042a9922c6cdd156.png\" alt=\"\"></p>\n<p>这个页面上的表格行数逐年增多</p>\n<p>如今，再有人问我最好的编程语言或者最好的文本编辑器的问题的话，我会说：</p>\n<p>“朋友，要打架吗？”</p>\n<p>这两个问题的最佳实践，唯有暴力。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114361\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114361votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114361\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/22aa7c4120eab2754c226f2916d800342e6adfb3.jpg"},{"url_object_id": "f24ce825da4820b7e7dbda3b9fa2020b", "title": "Linux 27 周年，这 27 件相关的有趣事实你可能不知道", "url": "http://blog.jobbole.com/114321/", "create_date": "2018/08/26", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/07da294f28a2b2db5b251dfd6a548197.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.omgubuntu.co.uk/2018/08/interesting-facts-about-linux\">OMG Ubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/99331/27-interesting-facts-about-linux\">开源中国</a>   </div><p>许多人认为10月5日是 Linux 系统的周年纪念日，因为这是 Linux 在1991年首次对外公布的时间。不过，你可能不知道的是，早在1991年8月25日，当年还是大学生的 Linus Torvalds 就向 comp.os.minix 新闻组的人透露了由于“业余爱好”他正在研究操作系统的消息。因此，该时间也被许多爱好者视为 Linux 的真正诞生日期。</p>\n<p>为纪念 Linux 27 岁诞辰，<a href=\"https://www.omgubuntu.co.uk/2018/08/interesting-facts-about-linux\" target=\"_blank\">OMG Ubuntu</a> 列出了 27 个与 Linux 和 Linus Torvalds 相关的有趣事实。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/08/07da294f28a2b2db5b251dfd6a548197.jpg\" alt=\"\"></p>\n<p>1、截至 2018 年，Linux 内核已有 20,323,379 行代码。尽管近期有所减少，但庞大的代码量意味着 Linux 仍然是地球上（单个）最大的开源项目。</p>\n<p>2、Linux 差点不叫这个名字！Linus Torvalds 原本想把他的“业余爱好”项目称为“FreaX”（“ Free”和“Unix”的组合）。值得庆幸的是，他早期使用的代码托管服务器的所有者说服了他，最终取名为 “Linux”（“Linus”和“Unix”的组合）。</p>\n<p>3、首个 Linux 版本 100％ 由 Linus Torvalds 编写，但最新的版本仅包含不到 1％ 的 Linus 编写的代码。他并不懈怠，现在主要是忙于管理和合并其他开发者编写的代码。</p>\n<p>4、Linux 被世界上所有主要的太空计划使用，包括 NASA 和 ESA 。</p>\n<p>5、谈及更广阔的宇宙，有以 Linux 和 Linus Torvalds 命名的小行星。</p>\n<p>6、Linux 的吉祥物 Tux 之所以是一只企鹅，据 Linus 回忆是因为他曾经被一只愤怒的企鹅咬伤。</p>\n<p>7、Linux 完全统治超级计算机。截至2018年，世界上最快的 500 个超级计算机 100％ 运行 Linux 。</p>\n<p>8、Linux 开发社区非常活跃。据统计，在过去 15 个月里，Linux Kernel 以平均每小时 7.8 个补丁的速度被合并。</p>\n<p>9、 Linux 早期以 MINIX 操作系统为原型，导致 Linus 采用类似于 Minix 的文件系统布局来实现他的新兴项目。之后由于被证明效率低下，Linus 采用“扩展文件系统”（ext）取代它，至今仍在使用。</p>\n<p>10、Linux 1.0 于1994年3月14日发布，共包含 176,250 行代码。2.0 版本紧随其后，于1996年发布。</p>\n<p>11、Linux 正运行在从智能手机到服务器，再到潜艇和太空火箭等大量事物上。</p>\n<p>12、乔布斯曾在2000年为 Linus Torvalds 提供一份工作，条件是他停止在 Linux 上的开发。Linus 拒绝了。</p>\n<p>13、Linux 有多成功？它的长期竞争对手微软，在90年代初曾试图“熄灭”该项目，到现在却在利用 Linux 进行服务器业务，甚至在为内核开发做贡献！</p>\n<p>14、说到贡献，谷歌、英特尔、华为、三星、红帽、Canonical 和 Facebook 是近年来 Linux 内核开发的主要贡献者。</p>\n<p>15、Linus 出生于芬兰，一个双语国家，并认为瑞典语是他的“母语”。他说，由于发音不同，他常常觉得用英语说话“不舒服”，但却更喜欢阅读英文书籍。</p>\n<p>16、Linux 可能是现在最大的自由软件项目（参见第一条），不过在1991年首次发布时，它仅有约 10 万行代码。</p>\n<p>17、在重新调整其开发和发布时间表后，新版本的 Linux kernel 现在基本每隔 66 天左右发布一次。</p>\n<p>18、Linux 不是 Linus Trovalds 唯一知名的作品，还有 Git 版本控制系统和潜水应用 Subsurface 。</p>\n<p>19、据估计，90％ 的好莱坞视觉效果在生产流程的某个阶段依赖于 Linux 。</p>\n<p>20、根据 openhub.net 的统计数据，超过 95％ 的 Linux 是用 C 语言编写的。</p>\n<p>21、最新版本的 Linux kernel 可能有 13.3％的代码由空行组成。这并非毫无意义，空行是严谨的编码风格的一部分，使内核保持整洁、高效和有序。</p>\n<p>22、基于 Linux 的 Android 是目前全球最成功的移动操作系统。</p>\n<p>23、Linux 的每个内核版本都有一个有趣的代号，比如 v4.13 的 “Fearless Coyote” (v4.13) 和 v4.18 的 “Merciless Moray” 。</p>\n<p>24、据红帽所述，排名前十的公有云中有 9 个是运行在 Linux 上的。</p>\n<p>25、Ubuntu 是世界上最流行的基于 Linux 的桌面操作系统，它在全球拥有约 2000 万用户。Linux 占台式计算机约 2％ 的使用份额。</p>\n<p>26、第一本关于 Linux 的出版物是 Matt Welsh 于1993年出版的 “Linux 安装和入门” 。第一本专刊 “Linux Journal” 于1994年3月出版，并首次对 Linus 进行了采访。</p>\n<p>27、Linux 是开源领域最着名的模范，但其实早期版本的 Linux 是禁止商业使用或再分发的。直到1992年发布 0.12 版本，Linus 才采用 GPL 协议。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114321\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114321votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114321\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8d90d339ad3f964cdd84201e17fd7d46aecb20bf.jpg"},{"url_object_id": "a47d0bf593223db07b3e04d691f43a44", "title": "走近北京后厂村程序员的真实生活：“拿命换钱”", "url": "http://blog.jobbole.com/114364/", "create_date": "2018/09/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/a3f700ca2ede780d76b0ad474852fa91.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "职场,程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jwview.com/\">中新经纬/赵佳然</a>   </div><p>北京的西北角是个特别的区域，这里汇集了众多互联网及IT企业，实力雄厚的上市公司将自家logo悬挂在大厦的顶端，而刚起步的创业公司也会选择在这里租下一亩三分地。</p>\n<p>中关村、上地、西二旗、后厂村……它们成为了一个个地标，而在这里工作的年轻人，总是第一时间被打上“码农”“程序员”的标签。在大家眼中，他们往往身着格子衬衫，头戴耳机身背双肩包，披星戴月地上下班，每天十几个小时面对着电脑屏幕。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/162/w550h412/20180909/XkLf-hivtsyk4553107.jpg\" alt=\"西二旗地铁站 中新经纬赵佳然摄\">西二旗地铁站</div>\n<p>我们习惯把他们看作一个整体，从性格、着装到消费水平都大致定型。然而，他们也许曾在某个地铁站多次擦肩而过，但每个人心中的目标、理想和焦虑，都各不相同。</p>\n<p><strong>我把家从三环里搬到了六环外</strong></p>\n<p>老田今年28岁，北京生北京长，是个标准的“土著”。10年前的他大概没有想过，自己会来到当时名不见经传的后厂村工作。</p>\n<p>2013年夏天，老田本科毕业，专业是当年正吃香的计算机与科学技术。他顺利地找到了一份某大型电信公司的内勤工作，但入职后发现，工作的内容与所学的专业知识并无相关。</p>\n<p>“就是天天处理人际关系，没别的。”他回忆道。</p>\n<p>不是没有考虑过换行，老田曾经要求过调岗，但却在面试的时候受了挫。“对方本来要问我一个专业问题，后来突然看了看我简历说：‘你是13年毕业的啊，那这个你可能没学过。’后来我就没怎么想着调岗的事了，想看看其他机会吧。”</p>\n<p>不过这份工作也有极大的优势：工作量少，离家近。老田每天可以8点起床，溜达15分钟到单位，下午5点半之前到家，琢磨晚上给爱人做点什么吃。老田最大的爱好就是做饭，人生理想是拥有属于自己的饭馆，不过这个目标现在看来还远得很。</p>\n<p>今年年初，也是老田结婚的第二年，他们摇号中了一套共有产权房，这意味着两人从无贷一身轻的状态，变成了每个月需还款7000多元。这突然的改变，也让他不得不再次审视自己的收入情况。“必须要多攒点钱了。”他对自己说。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/58/w550h308/20180909/sITD-hivtsyk4553147.jpg\" alt=\"清晨的后厂村路，老田每天的必经之地 受访者供图\">清晨的后厂村路，老田每天的必经之地 受访者供图</div>\n<p>经过熟人介绍，他来到了“大名鼎鼎”的后厂村，在一家央企做工程师。还没开始体会到工作的高强度，通勤的问题就先来了：家住在东三环内，公司在北五环外，高峰期堵得严严实实，咋办？</p>\n<p>与爱人商量之后，老田决定工作日住到六环外的亲戚家。“往北走高速，开20多分钟就到了，回家直接睡觉。”就这样，从公司到住处，从工作到睡觉的循环开始了。</p>\n<p>由于已经4年没上手专业技能，突如其来的高强工作量让他发懵。他坦言，工作以来，这是头回一想到上班就开始焦虑。三个月过去，好不容易熟悉了基本操作，但工作压力依然压得他喘不过气。喝不惯咖啡的他，每天中午和其他同事一样，需要在躺椅上休息近一小时，否则整个下午都会浑浑噩噩。</p>\n<p>一日下班后，老田随手抓了抓脑袋，却惊讶地发现掉了满桌的头发。“我觉得这份工作就是在拿命换钱。”他说。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/59/w550h309/20180909/Svxt-hivtsyk4553170.jpg\" alt=\"老田办公室的躺椅，同事们几乎人手一个 受访者供图\">老田办公室的躺椅，同事们几乎人手一个 受访者供图</div>\n<p>其实，老田从来没放弃过开饭馆的梦。他自己也明白，目前的积蓄还无法支撑起这个目标，同时后厂村的高强度作业也不是长久之计。“先干两年，等把知识学到手，也算是留了个后路，以后就算创业失败了，也能养家糊口。”眼看“奔三”了，下一代的计划也渐渐提上日程，他便愈发不敢放松对自己的要求。</p>\n<p>晚上9点，老田揉了揉发涩的眼睛，发动汽车，开往六环外的住所。高速走得很顺，车里放着《北京土著》，顺便想想周末该做什么新菜。他突然觉得，要是这段路再长一点，也挺好的。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/162/w550h412/20180909/6AtK-hivtsyk4553202.jpg\" alt=\"晚上10点，后厂村的办公大楼仍灯火通明\">晚上10点，后厂村的办公大楼仍灯火通明</div>\n<p><strong>“程序媛”和你们想象得不太一样</strong></p>\n<p>小徐在中关村上班，是个程序员，性别女。</p>\n<p>她知道女性程序员在大众眼里的模样：要么，就是从不化妆，戴着厚厚的眼镜，穿着上也从不在意，在人群里是最不起眼的存在；要么，就是只顾打扮不顾业务，利用着与生俱来的“性别优势”，自然地索求同事们的帮助。</p>\n<p>她认为自己与两者均无相似之处。</p>\n<p>在求职时，小徐的同学们或多或少地抱怨过用人单位的不公平待遇，即同样条件下，招收女性程序员的可能性较小。在这份需脑力与体力兼备的工作中，女性似乎确实不占优势，但幸运的是，许多大型公司在招聘时注重性别的均衡，她也未曾遭受异样的审视。“我就职的这家外企比较重视员工的diversity(差异性)，因此团队里的女性不少，很多还是女博士。”她回忆道。</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/162/w550h412/20180909/XJfh-hivtsyk4553239.jpg\" alt=\"通勤时段，人人都是“低头族” 中新经纬 赵佳然摄\">通勤时段，人人都是“低头族”</div>\n<p>小徐去年研究生毕业，从香港来到北京求职的她，选择中关村并非为了高薪，而是希望能继续积累知识。“希望我的工作能兼顾我的专业和兴趣，同时能给我不断提升自我的机会。”经过筛选，最终她就职于某外企的研究机构，与云技术、人工智能等尖端科技打交道。</p>\n<p>太多年轻人初入职场时也怀着学习的心态，但不久后便与繁忙的节奏和升职加薪的烦恼妥协，开始得过且过。小徐却认为，自己所在团队的氛围起到了带头作用，大家在头脑风暴中不断思考、沉淀的过程，是她在工作中最欣赏的部分。“我不喜欢那种领导让做什么就做什么的节奏，太死板，久而久之脑袋都麻木了。”</p>\n<p>虽然目前的工作尽如人意，但小徐还面临着大部分“程序媛”都避不开的问题：来自亲人朋友的无形压力。随着IT圈“赚5万花5千”“过度劳动”“脱发”等吐槽越来越深入人心，身边的人自然会产生担忧：身体状况怎么样？平时有自己的时间吗？非要做这行不可吗？</p>\n<div style=\"text-align: center;\"><img class=\"aligncenter\" src=\"//n.sinaimg.cn/tech/crawl/136/w550h386/20180909/n19M-hivtsyk4553275.jpg\" alt=\"小徐的钢琴 受访者供图\">小徐的钢琴 受访者供图</div>\n<p>小徐多次与母亲提及这个话题，但都以她的坚持而结束。但她潜意识里也存在着焦虑。虽然入职只有一年光景，但她已经从周围同事的身上看到了自己可能的未来，并不时怀疑：我可以做到那么优秀吗？</p>\n<p>“刚入职的时候抱有热情和冲劲很正常，但眼看着同事和领导资历越高，节奏越快，我也会担心自己以后能否平衡工作和生活，会遇到什么样的瓶颈。总之我不希望工作侵吞我所有的生活，如果有合适机会的话，我或许会考虑跳槽，但目前的职业方向还是不会变的。”小徐说。</p>\n<p>然而，尽管有着迷茫和顾虑，但小徐仍坚持着自己对事物的新鲜感。给自己报的成人钢琴班已经小有成效，最近正练习着《小步舞曲》。</p>\n<p>她是职场新人，是“程序媛”，也是“北漂”，但最重要的，她是她自己。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114364\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114364votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114364\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/44c2919ba48fd2a8c45629c53265ad798043813c.jpg"},{"url_object_id": "a19f6c19524705b17c52d9e997dd7919", "title": "深入理解 ext4 等 Linux 文件系统", "url": "http://blog.jobbole.com/114377/", "create_date": "2018/09/12", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/623fff738e3b78d500adde9b8202bb80.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/4/ext4-filesystem\">Jim Salter</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10000-1.html\">Linux中国/魑魅魍魉</a>   </div><blockquote><p>了解 ext4 的历史，包括其与 ext3 和之前的其它文件系统之间的区别。</p></blockquote>\n<p>目前的大部分 Linux 文件系统都默认采用 ext4 文件系统，正如以前的 Linux 发行版默认使用 ext3、ext2 以及更久前的 ext。</p>\n<p>对于不熟悉 Linux 或文件系统的朋友而言，你可能不清楚 ext4 相对于上一版本 ext3 带来了什么变化。你可能还想知道在一连串关于替代的文件系统例如 Btrfs、XFS 和 ZFS 不断被发布的情况下，ext4 是否仍然能得到进一步的发展。</p>\n<p>在一篇文章中，我们不可能讲述文件系统的所有方面，但我们尝试让你尽快了解 Linux 默认文件系统的发展历史，包括它的诞生以及未来发展。</p>\n<p>我仔细研究了维基百科里的各种关于 ext 文件系统文章、kernel.org 的 wiki 中关于 ext4 的条目以及结合自己的经验写下这篇文章。</p>\n<h3 id=\"toc_1\">ext 简史</h3>\n<h4 id=\"toc_2\">MINIX 文件系统</h4>\n<p>在有 ext 之前，使用的是 MINIX 文件系统。如果你不熟悉 Linux 历史，那么可以理解为 MINIX 是用于 IBM PC/AT 微型计算机的一个非常小的类 Unix 系统。Andrew Tannenbaum 为了教学的目的而开发了它，并于 1987 年发布了源代码（以印刷版的格式！）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/623fff738e3b78d500adde9b8202bb80.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>IBM 1980 中期的 PC/AT，<a href=\"https://commons.wikimedia.org/wiki/File:IBM_PC_AT.jpg\">MBlairMartin</a>，<a href=\"https://creativecommons.org/licenses/by-sa/4.0/deed.en\">CC BY-SA 4.0</a></em></p>\n<p>虽然你可以细读 MINIX 的源代码，但实际上它并不是自由开源软件（FOSS）。出版 Tannebaum 著作的出版商要求你花 69 美元的许可费来运行 MINIX，而这笔费用包含在书籍的费用中。尽管如此，在那时来说非常便宜，并且 MINIX 的使用得到迅速发展，很快超过了 Tannebaum 当初使用它来教授操作系统编码的意图。在整个 20 世纪 90 年代，你可以发现 MINIX 的安装在世界各个大学里面非常流行。而此时，年轻的 Linus Torvalds 使用 MINIX 来开发原始 Linux 内核，并于 1991 年首次公布，而后在 1992 年 12 月在 GPL 开源协议下发布。</p>\n<p>但是等等，这是一篇以 <em>文件系统</em> 为主题的文章不是吗？是的，MINIX 有自己的文件系统，早期的 Linux 版本依赖于它。跟 MINIX 一样，Linux 的文件系统也如同玩具那般小 —— MINIX 文件系统最多能处理 14 个字符的文件名，并且只能处理 64MB 的存储空间。到了 1991 年，一般的硬盘尺寸已经达到了 40-140 MB。很显然，Linux 需要一个更好的文件系统。</p>\n<h4 id=\"toc_3\">ext</h4>\n<p>当 Linus 开发出刚起步的 Linux 内核时，Rémy Card 从事第一代的 ext 文件系统的开发工作。ext 文件系统在 1992 年首次实现并发布 —— 仅在 Linux 首次发布后的一年！—— ext 解决了 MINIX 文件系统中最糟糕的问题。</p>\n<p>1992 年的 ext 使用在 Linux 内核中的新虚拟文件系统（VFS）抽象层。与之前的 MINIX 文件系统不同的是，ext 可以处理高达 2 GB 存储空间并处理 255 个字符的文件名。</p>\n<p>但 ext 并没有长时间占统治地位，主要是由于它原始的时间戳（每个文件仅有一个时间戳，而不是今天我们所熟悉的有 inode、最近文件访问时间和最新文件修改时间的时间戳。）仅仅一年后，ext2 就替代了它。</p>\n<h4 id=\"toc_4\">ext2</h4>\n<p>Rémy 很快就意识到 ext 的局限性，所以一年后他设计出 ext2 替代它。当 ext 仍然根植于 “玩具” 操作系统时，ext2 从一开始就被设计为一个商业级文件系统，沿用 BSD 的 Berkeley 文件系统的设计原理。</p>\n<p>ext2 提供了 GB 级别的最大文件大小和 TB 级别的文件系统大小，使其在 20 世纪 90 年代的地位牢牢巩固在文件系统大联盟中。很快它被广泛地使用，无论是在 Linux 内核中还是最终在 MINIX 中，且利用第三方模块可以使其应用于 MacOS 和 Windows。</p>\n<p>但这里仍然有一些问题需要解决：ext2 文件系统与 20 世纪 90 年代的大多数文件系统一样，如果在将数据写入到磁盘的时候，系统发生崩溃或断电，则容易发生灾难性的数据损坏。随着时间的推移，由于碎片（单个文件存储在多个位置，物理上其分散在旋转的磁盘上），它们也遭受了严重的性能损失。</p>\n<p>尽管存在这些问题，但今天 ext2 还是用在某些特殊的情况下 —— 最常见的是，作为便携式 USB 驱动器的文件系统格式。</p>\n<h4 id=\"toc_5\">ext3</h4>\n<p>1998 年，在 ext2 被采用后的 6 年后，Stephen Tweedie 宣布他正在致力于改进 ext2。这成了 ext3，并于 2001 年 11 月在 2.4.15 内核版本中被采用到 Linux 内核主线中。</p>\n<p style=\"text-align: center\"><img title=\"Packard Bell computer\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/584f10332acf325015ae984a7930d715.jpg\" alt=\"Packard Bell 计算机\"></p>\n<p style=\"text-align: center\"><em>20 世纪 90 年代中期的 Packard Bell 计算机，<a href=\"https://commons.wikimedia.org/wiki/File:Old_packard_bell_pc.jpg\">Spacekid</a>，<a href=\"https://creativecommons.org/publicdomain/zero/1.0/deed.en\">CC0</a></em></p>\n<p>在大部分情况下，ext2 在 Linux 发行版中工作得很好，但像 FAT、FAT32、HFS 和当时的其它文件系统一样 —— 在断电时容易发生灾难性的破坏。如果在将数据写入文件系统时候发生断电，则可能会将其留在所谓 <em>不一致</em> 的状态 —— 事情只完成一半而另一半未完成。这可能导致大量文件丢失或损坏，这些文件与正在保存的文件无关甚至导致整个文件系统无法卸载。</p>\n<p>ext3 和 20 世纪 90 年代后期的其它文件系统，如微软的 NTFS，使用 <em>日志</em> 来解决这个问题。日志是磁盘上的一种特殊的分配区域，其写入被存储在事务中；如果该事务完成磁盘写入，则日志中的数据将提交给文件系统自身。如果系统在该操作提交前崩溃，则重新启动的系统识别其为未完成的事务而将其进行回滚，就像从未发生过一样。这意味着正在处理的文件可能依然会丢失，但文件系统 <em>本身</em> 保持一致，且其它所有数据都是安全的。</p>\n<p>在使用 ext3 文件系统的 Linux 内核中实现了三个级别的日志记录方式：日记journal、顺序ordered和回写writeback。</p>\n<ul>\n<li><strong>日记</strong> 是最低风险模式，在将数据和元数据提交给文件系统之前将其写入日志。这可以保证正在写入的文件与整个文件系统的一致性，但其显著降低了性能。</li>\n<li><strong>顺序</strong> 是大多数 Linux 发行版默认模式；顺序模式将元数据写入日志而直接将数据提交到文件系统。顾名思义，这里的操作顺序是固定的：首先，元数据提交到日志；其次，数据写入文件系统，然后才将日志中关联的元数据更新到文件系统。这确保了在发生崩溃时，那些与未完整写入相关联的元数据仍在日志中，且文件系统可以在回滚日志时清理那些不完整的写入事务。在顺序模式下，系统崩溃可能导致在崩溃期间文件的错误被主动写入，但文件系统它本身 —— 以及未被主动写入的文件 —— 确保是安全的。</li>\n<li><strong>回写</strong> 是第三种模式 —— 也是最不安全的日志模式。在回写模式下，像顺序模式一样，元数据会被记录到日志，但数据不会。与顺序模式不同，元数据和数据都可以以任何有利于获得最佳性能的顺序写入。这可以显著提高性能，但安全性低很多。尽管回写模式仍然保证文件系统本身的安全性，但在崩溃或崩溃之前写入的文件很容易丢失或损坏。</li>\n</ul>\n<p>跟之前的 ext2 类似，ext3 使用 16 位内部寻址。这意味着对于有着 4K 块大小的 ext3 在最大规格为 16 TiB 的文件系统中可以处理的最大文件大小为 2 TiB。</p>\n<h4 id=\"toc_6\">ext4</h4>\n<p>Theodore Ts’o（是当时 ext3 主要开发人员）在 2006 年发表的 ext4，于两年后在 2.6.28 内核版本中被加入到了 Linux 主线。</p>\n<p>Ts’o 将 ext4 描述为一个显著扩展 ext3 但仍然依赖于旧技术的临时技术。他预计 ext4 终将会被真正的下一代文件系统所取代。</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a73a15786bd47bc5be9d70bb101e280b.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>Dell Precision 380 工作站，<a href=\"https://commons.wikimedia.org/wiki/File:Dell_Precision_380_Workstation.jpeg\">Lance Fisher</a>，<a href=\"https://creativecommons.org/licenses/by-sa/2.0/deed.en\">CC BY-SA 2.0</a></em></p>\n<p>ext4 在功能上与 ext3 在功能上非常相似，但支持大文件系统，提高了对碎片的抵抗力，有更高的性能以及更好的时间戳。</p>\n<h3 id=\"toc_7\">ext4 vs ext3</h3>\n<p>ext3 和 ext4 有一些非常明确的差别，在这里集中讨论下。</p>\n<h4 id=\"toc_8\">向后兼容性</h4>\n<p>ext4 特地设计为尽可能地向后兼容 ext3。这不仅允许 ext3 文件系统原地升级到 ext4；也允许 ext4 驱动程序以 ext3 模式自动挂载 ext3 文件系统，因此使它无需单独维护两个代码库。</p>\n<h4 id=\"toc_9\">大文件系统</h4>\n<p>ext3 文件系统使用 32 位寻址，这限制它仅支持 2 TiB 文件大小和 16 TiB 文件系统系统大小（这是假设在块大小为 4 KiB 的情况下，一些 ext3 文件系统使用更小的块大小，因此对其进一步被限制）。</p>\n<p>ext4 使用 48 位的内部寻址，理论上可以在文件系统上分配高达 16 TiB 大小的文件，其中文件系统大小最高可达 1000000 TiB（1 EiB）。在早期 ext4 的实现中有些用户空间的程序仍然将其限制为最大大小为 16 TiB 的文件系统，但截至 2011 年，e2fsprogs 已经直接支持大于 16 TiB 大小的 ext4 文件系统。例如，红帽企业 Linux 在其合同上仅支持最高 50 TiB 的 ext4 文件系统，并建议 ext4 卷不超过 100 TiB。</p>\n<h4 id=\"toc_10\">分配方式改进</h4>\n<p>ext4 在将存储块写入磁盘之前对存储块的分配方式进行了大量改进，这可以显著提高读写性能。</p>\n<h5 id=\"toc_11\">区段</h5>\n<p>区段extent是一系列连续的物理块 (最多达 128 MiB，假设块大小为 4 KiB），可以一次性保留和寻址。使用区段可以减少给定文件所需的 inode 数量，并显著减少碎片并提高写入大文件时的性能。</p>\n<h5 id=\"toc_12\">多块分配</h5>\n<p>ext3 为每一个新分配的块调用一次块分配器。当多个写入同时打开分配器时，很容易导致严重的碎片。然而，ext4 使用延迟分配，这允许它合并写入并更好地决定如何为尚未提交的写入分配块。</p>\n<h5 id=\"toc_13\">持久的预分配</h5>\n<p>在为文件预分配磁盘空间时，大部分文件系统必须在创建时将零写入该文件的块中。ext4 允许替代使用 <code>fallocate()</code>，它保证了空间的可用性（并试图为它找到连续的空间），而不需要先写入它。这显著提高了写入和将来读取流和数据库应用程序的写入数据的性能。</p>\n<h5 id=\"toc_14\">延迟分配</h5>\n<p>这是一个耐人寻味而有争议性的功能。延迟分配允许 ext4 等待分配将写入数据的实际块，直到它准备好将数据提交到磁盘。（相比之下，即使数据仍然在往写入缓存中写入，ext3 也会立即分配块。）</p>\n<p>当缓存中的数据累积时，延迟分配块允许文件系统对如何分配块做出更好的选择，降低碎片（写入，以及稍后的读）并显著提升性能。然而不幸的是，它 <em>增加</em> 了还没有专门调用 <code>fsync()</code> 方法（当程序员想确保数据完全刷新到磁盘时）的程序的数据丢失的可能性。</p>\n<p>假设一个程序完全重写了一个文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363dc418f715461246\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfd=open(\"file\", O_TRUNC); write(fd, data); close(fd);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363dc418f715461246-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363dc418f715461246-1\"><span class=\"crayon-v\">fd</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"file\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_TRUNC</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>使用旧的文件系统，<code>close(fd);</code> 足以保证 <code>file</code> 中的内容刷新到磁盘。即使严格来说，写不是事务性的，但如果文件关闭后发生崩溃，则丢失数据的风险很小。</p>\n<p>如果写入不成功（由于程序上的错误、磁盘上的错误、断电等），文件的原始版本和较新版本都可能丢失数据或损坏。如果其它进程在写入文件时访问文件，则会看到损坏的版本。如果其它进程打开文件并且不希望其内容发生更改 —— 例如，映射到多个正在运行的程序的共享库。这些进程可能会崩溃。</p>\n<p>为了避免这些问题，一些程序员完全避免使用 <code>O_TRUNC</code>。相反，他们可能会写入一个新文件，关闭它，然后将其重命名为旧文件名：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363dc4199387350602\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfd=open(\"newfile\"); write(fd, data); close(fd); rename(\"newfile\", \"file\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363dc4199387350602-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363dc4199387350602-1\"><span class=\"crayon-v\">fd</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"newfile\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rename</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"newfile\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"file\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>在 <em>没有</em> 延迟分配的文件系统下，这足以避免上面列出的潜在的损坏和崩溃问题：因为 <code>rename()</code> 是原子操作，所以它不会被崩溃中断；并且运行的程序将继续引用旧的文件。现在 <code>file</code> 的未链接版本只要有一个打开的文件文件句柄即可。但是因为 ext4 的延迟分配会导致写入被延迟和重新排序，<code>rename(\"newfile\", \"file\")</code> 可以在 <code>newfile</code> 的内容实际写入磁盘内容之前执行，这出现了并行进行再次获得 <code>file</code> 坏版本的问题。</p>\n<p>为了缓解这种情况，Linux 内核（自版本 2.6.30）尝试检测这些常见代码情况并强制立即分配。这会减少但不能防止数据丢失的可能性 —— 并且它对新文件没有任何帮助。如果你是一位开发人员，请注意：保证数据立即写入磁盘的唯一方法是正确调用 <code>fsync()</code>。</p>\n<h4 id=\"toc_15\">无限制的子目录</h4>\n<p>ext3 仅限于 32000 个子目录；ext4 允许无限数量的子目录。从 2.6.23 内核版本开始，ext4 使用 HTree 索引来减少大量子目录的性能损失。</p>\n<h4 id=\"toc_16\">日志校验</h4>\n<p>ext3 没有对日志进行校验，这给处于内核直接控制之外的磁盘或自带缓存的控制器设备带来了问题。如果控制器或具自带缓存的磁盘脱离了写入顺序，则可能会破坏 ext3 的日记事务顺序，从而可能破坏在崩溃期间（或之前一段时间）写入的文件。</p>\n<p>理论上，这个问题可以使用写入障碍barrier —— 在安装文件系统时，你在挂载选项设置 <code>barrier=1</code>，然后设备就会忠实地执行 <code>fsync</code> 一直向下到底层硬件。通过实践，可以发现存储设备和控制器经常不遵守写入障碍 —— 提高性能（和跟竞争对手比较的性能基准），但增加了本应该防止数据损坏的可能性。</p>\n<p>对日志进行校验和允许文件系统崩溃后第一次挂载时意识到其某些条目是无效或无序的。因此，这避免了回滚部分条目或无序日志条目的错误，并进一步损坏的文件系统 —— 即使部分存储设备假做或不遵守写入障碍。</p>\n<h4 id=\"toc_17\">快速文件系统检查</h4>\n<p>在 ext3 下，在 <code>fsck</code> 被调用时会检查整个文件系统 —— 包括已删除或空文件。相比之下，ext4 标记了 inode 表未分配的块和扇区，从而允许 <code>fsck</code> 完全跳过它们。这大大减少了在大多数文件系统上运行 <code>fsck</code> 的时间，它实现于内核 2.6.24。</p>\n<h4 id=\"toc_18\">改进的时间戳</h4>\n<p>ext3 提供粒度为一秒的时间戳。虽然足以满足大多数用途，但任务关键型应用程序经常需要更严格的时间控制。ext4 通过提供纳秒级的时间戳，使其可用于那些企业、科学以及任务关键型的应用程序。</p>\n<p>ext3 文件系统也没有提供足够的位来存储 2038 年 1 月 18 日以后的日期。ext4 在这里增加了两个位，将 <a href=\"https://en.wikipedia.org/wiki/Unix_time\">Unix 纪元</a>扩展了 408 年。如果你在公元 2446 年读到这篇文章，你很有可能已经转移到一个更好的文件系统 —— 如果你还在测量自 1970 年 1 月 1 日 00:00（UTC）以来的时间，这会让我死后得以安眠。</p>\n<h4 id=\"toc_19\">在线碎片整理</h4>\n<p>ext2 和 ext3 都不直接支持在线碎片整理 —— 即在挂载时会对文件系统进行碎片整理。ext2 有一个包含的实用程序 <code>e2defrag</code>，它的名字暗示 —— 它需要在文件系统未挂载时脱机运行。（显然，这对于根文件系统来说非常有问题。）在 ext3 中的情况甚至更糟糕 —— 虽然 ext3 比 ext2 更不容易受到严重碎片的影响，但 ext3 文件系统运行 <code>e2defrag</code> 可能会导致灾难性损坏和数据丢失。</p>\n<p>尽管 ext3 最初被认为“不受碎片影响”，但对同一文件（例如 BitTorrent）采用大规模并行写入过程的过程清楚地表明情况并非完全如此。一些用户空间的手段和解决方法，例如 <a href=\"https://vleu.net/shake/\">Shake</a>，以这样或那样方式解决了这个问题 —— 但它们比真正的、文件系统感知的、内核级碎片整理过程更慢并且在各方面都不太令人满意。</p>\n<p>ext4 通过 <code>e4defrag</code> 解决了这个问题，且是一个在线、内核模式、文件系统感知、块和区段级别的碎片整理实用程序。</p>\n<h3 id=\"toc_20\">正在进行的 ext4 开发</h3>\n<p>ext4，正如 Monty Python 中瘟疫感染者曾经说过的那样，“我还没死呢！”虽然它的<a href=\"http://www.linux-mag.com/id/7272/\">主要开发人员</a>认为它只是一个真正的<a href=\"https://arstechnica.com/information-technology/2014/01/bitrot-and-atomic-cows-inside-next-gen-filesystems/\">下一代文件系统</a>的权宜之计，但是在一段时间内，没有任何可能的候选人准备好（由于技术或许可问题）部署为根文件系统。</p>\n<p>在未来的 ext4 版本中仍然有一些关键功能要开发，包括元数据校验和、一流的配额支持和大分配块。</p>\n<h4 id=\"toc_21\">元数据校验和</h4>\n<p>由于 ext4 具有冗余超级块，因此为文件系统校验其中的元数据提供了一种方法，可以自行确定主超级块是否已损坏并需要使用备用块。可以在没有校验和的情况下，从损坏的超级块恢复 —— 但是用户首先需要意识到它已损坏，然后尝试使用备用方法手动挂载文件系统。由于在某些情况下，使用损坏的主超级块安装文件系统读写可能会造成进一步的损坏，即使是经验丰富的用户也无法避免，这也不是一个完美的解决方案！</p>\n<p>与 Btrfs 或 ZFS 等下一代文件系统提供的极其强大的每块校验和相比，ext4 的元数据校验和的功能非常弱。但它总比没有好。虽然校验 <strong>所有的事情</strong> 都听起来很简单！—— 事实上，将校验和与文件系统连接到一起有一些重大的挑战；请参阅<a href=\"https://ext4.wiki.kernel.org/index.php/Ext4_Metadata_Checksums\">设计文档</a>了解详细信息。</p>\n<h4 id=\"toc_22\">一流的配额支持</h4>\n<p>等等，配额？！从 ext2 出现的那天开始我们就有了这些！是的，但它们一直都是事后的添加的东西，而且它们总是犯傻。这里可能不值得详细介绍，但<a href=\"https://ext4.wiki.kernel.org/index.php/Design_For_1st_Class_Quota_in_Ext4\">设计文档</a>列出了配额将从用户空间移动到内核中的方式，并且能够更加正确和高效地执行。</p>\n<h4 id=\"toc_23\">大分配块</h4>\n<p>随着时间的推移，那些讨厌的存储系统不断变得越来越大。由于一些固态硬盘已经使用 8K 硬件块大小，因此 ext4 对 4K 模块的当前限制越来越受到限制。较大的存储块可以显著减少碎片并提高性能，代价是增加“松弛”空间（当你只需要块的一部分来存储文件或文件的最后一块时留下的空间）。</p>\n<p>你可以在<a href=\"https://ext4.wiki.kernel.org/index.php/Design_for_Large_Allocation_Blocks\">设计文档</a>中查看详细说明。</p>\n<h3 id=\"toc_24\">ext4 的实际限制</h3>\n<p>ext4 是一个健壮、稳定的文件系统。如今大多数人都应该在用它作为根文件系统，但它无法处理所有需求。让我们简单地谈谈你不应该期待的一些事情 —— 现在或可能在未来：</p>\n<p>虽然 ext4 可以处理高达 1 EiB 大小（相当于 1,000,000 TiB）大小的数据，但你 <em>真的</em> 不应该尝试这样做。除了能够记住更多块的地址之外，还存在规模上的问题。并且现在 ext4 不会处理（并且可能永远不会）超过 50-100 TiB 的数据。</p>\n<p>ext4 也不足以保证数据的完整性。随着日志记录的重大进展又回到了 ext3 的那个时候，它并未涵盖数据损坏的许多常见原因。如果数据已经在磁盘上被<a href=\"https://en.wikipedia.org/wiki/Data_degradation#Visual_example_of_data_degradation\">破坏</a> —— 由于故障硬件，宇宙射线的影响（是的，真的），或者只是数据随时间衰减 —— ext4 无法检测或修复这种损坏。</p>\n<p>基于上面两点，ext4 只是一个纯 <em>文件系统</em>，而不是存储卷管理器。这意味着，即使你有多个磁盘 —— 也就是奇偶校验或冗余，理论上你可以从 ext4 中恢复损坏的数据，但无法知道使用它是否对你有利。虽然理论上可以在不同的层中分离文件系统和存储卷管理系统而不会丢失自动损坏检测和修复功能，但这不是当前存储系统的设计方式，并且它将给新设计带来重大挑战。</p>\n<h3 id=\"toc_25\">备用文件系统</h3>\n<p>在我们开始之前，提醒一句：要非常小心，没有任何备用的文件系统作为主线内核的一部分而内置和直接支持！</p>\n<p>即使一个文件系统是 <em>安全的</em>，如果在内核升级期间出现问题，使用它作为根文件系统也是非常可怕的。如果你没有充分的理由通过一个 chroot 去使用替代介质引导，耐心地操作内核模块、grub 配置和 DKMS……不要在一个很重要的系统中去掉预留的根文件。</p>\n<p>可能有充分的理由使用你的发行版不直接支持的文件系统 —— 但如果你这样做，我强烈建议你在系统启动并可用后再安装它。（例如，你可能有一个 ext4 根文件系统，但是将大部分数据存储在 ZFS 或 Btrfs 池中。）</p>\n<h4 id=\"toc_26\">XFS</h4>\n<p>XFS 与非 ext 文件系统在 Linux 中的主线中的地位一样。它是一个 64 位的日志文件系统，自 2001 年以来内置于 Linux 内核中，为大型文件系统和高度并发性提供了高性能（即大量的进程都会立即写入文件系统）。</p>\n<p>从 RHEL 7 开始，XFS 成为 Red Hat Enterprise Linux 的默认文件系统。对于家庭或小型企业用户来说，它仍然有一些缺点 —— 最值得注意的是，重新调整现有 XFS 文件系统是一件非常痛苦的事情，不如创建另一个并复制数据更有意义。</p>\n<p>虽然 XFS 是稳定的且是高性能的，但它和 ext4 之间没有足够具体的最终用途差异，以值得推荐在非默认（如 RHEL7）的任何地方使用它，除非它解决了对 ext4 的特定问题，例如大于 50 TiB 容量的文件系统。</p>\n<p>XFS 在任何方面都不是 ZFS、Btrfs 甚至 WAFL（一个专有的 SAN 文件系统）的“下一代”文件系统。就像 ext4 一样，它应该被视为一种更好的方式的权宜之计。</p>\n<h4 id=\"toc_27\">ZFS</h4>\n<p>ZFS 由 Sun Microsystems 开发，以 zettabyte 命名 —— 相当于 1 万亿 GB —— 因为它理论上可以解决大型存储系统。</p>\n<p>作为真正的下一代文件系统，ZFS 提供卷管理（能够在单个文件系统中处理多个单独的存储设备），块级加密校验和（允许以极高的准确率检测数据损坏），<a href=\"https://en.wikipedia.org/wiki/Data_degradation#Visual_example_of_data_degradation\">自动损坏修复</a>（其中冗余或奇偶校验存储可用），<a href=\"https://arstechnica.com/information-technology/2015/12/rsync-net-zfs-replication-to-the-cloud-is-finally-here-and-its-fast/\">快速异步增量复制</a>，内联压缩等，<a href=\"https://arstechnica.com/information-technology/2014/02/ars-walkthrough-using-the-zfs-next-gen-filesystem-on-linux/\">以及更多</a>。</p>\n<p>从 Linux 用户的角度来看，ZFS 的最大问题是许可证问题。ZFS 许可证是 CDDL 许可证，这是一种与 GPL 冲突的半许可的许可证。关于在 Linux 内核中使用 ZFS 的意义存在很多争议，其争议范围从“它是 GPL 违规”到“它是 CDDL 违规”到“它完全没问题，它还没有在法庭上进行过测试。”最值得注意的是，自 2016 年以来 Canonical 已将 ZFS 代码内联在其默认内核中，而且目前尚无法律挑战。</p>\n<p>此时，即使我作为一个非常狂热于 ZFS 的用户，我也不建议将 ZFS 作为 Linux 的根文件系统。如果你想在 Linux 上利用 ZFS 的优势，用 ext4 设置一个小的根文件系统，然后将 ZFS 用在你剩余的存储上，把数据、应用程序以及你喜欢的东西放在它上面 —— 但把 root 分区保留在 ext4 上，直到你的发行版明确支持 ZFS 根目录。</p>\n<h4 id=\"toc_28\">Btrfs</h4>\n<p>Btrfs 是 B-Tree Filesystem 的简称，通常发音为 “butter” —— 由 Chris Mason 于 2007 年在 Oracle 任职期间发布。Btrfs 旨在跟 ZFS 有大部分相同的目标，提供多种设备管理、每块校验、异步复制、直列压缩等，<a href=\"https://arstechnica.com/information-technology/2014/01/bitrot-and-atomic-cows-inside-next-gen-filesystems/\">还有更多</a>。</p>\n<p>截至 2018 年，Btrfs 相当稳定，可用作标准的单磁盘文件系统，但可能不应该依赖于卷管理器。与许多常见用例中的 ext4、XFS 或 ZFS 相比，它存在严重的性能问题，其下一代功能 —— 复制、多磁盘拓扑和快照管理 —— 可能非常多，其结果可能是从灾难性地性能降低到实际数据的丢失。</p>\n<p>Btrfs 的维持状态是有争议的；SUSE Enterprise Linux 在 2015 年采用它作为默认文件系统，而 Red Hat 于 2017 年宣布它从 RHEL 7.4 开始不再支持 Btrfs。可能值得注意的是，该产品支持 Btrfs 部署用作单磁盘文件系统，而不是像 ZFS 中的多磁盘卷管理器，甚至 Synology 在它的存储设备使用 Btrfs，但是它在传统 Linux 内核 RAID（mdraid）之上分层来管理磁盘。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114377\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114377votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114377\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8141690b03d35ed04679c81e69d075e736fd8883.jpg"},{"url_object_id": "8470a72bff4d46a52fb85dff84f81bb0", "title": "介绍 Linux 中的管道和命名管道", "url": "http://blog.jobbole.com/114379/", "create_date": "2018/09/12", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/a836f3cdf91cb1dcf551a3cd4f561da6.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/8/introduction-pipes-linux\">Archit Modi</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9992-1.html\">Linux中国/geekpi</a>   </div><blockquote><p>要在命令间移动数据？使用管道可使此过程便捷。</p></blockquote>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a836f3cdf91cb1dcf551a3cd4f561da6.jpg\"></p>\n<p>在 Linux 中，<code>pipe</code> 能让你将一个命令的输出发送给另一个命令。管道，如它的名称那样，能重定向一个进程的标准输出、输入和错误到另一个进程，以便于进一步处理。</p>\n<p>“管道”（或称“未命名管道”）命令的语法是在两个命令之间加上 <code>|</code> 字符：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363db2380908821889\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCommand-1 | Command-2 | ...| Command-N</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363db2380908821889-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363db2380908821889-1\"><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Command</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">N</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这里，该管道不能通过另一个会话访问；它被临时创建用于接收 <code>Command-1</code> 的执行并重定向标准输出。它在成功执行之后删除。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/49dba0a934014ce2131193852491b64b.png\" alt=\"\"></p>\n<p>在上面的示例中，<code>contents.txt</code> 包含特定目录中所有文件的列表 —— 具体来说，就是 <code>ls -al</code> 命令的输出。我们首先通过管道（如图所示）使用 “file” 关键字从 <code>contents.txt</code> 中 <code>grep</code> 文件名，因此 <code>cat</code> 命令的输出作为 <code>grep</code> 命令的输入提供。接下来，我们添加管道来执行 <code>awk</code> 命令，该命令显示 <code>grep</code> 命令的过滤输出中的第 9 列。我们还可以使用 <code>wc -l</code> 命令计算 <code>contents.txt</code> 中的行数。</p>\n<p>只要系统启动并运行或直到它被删除，命名管道就可以持续使用。它是一个遵循 <a href=\"https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)\">FIFO</a>（先进先出）机制的特殊文件。它可以像普通文件一样使用。也就是，你可以写入，从中读取，然后打开或关闭它。要创建命名管道，命令为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363db238a423609667\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkfifo &lt;pipe-name&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363db238a423609667-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363db238a423609667-1\"><span class=\"crayon-v\">mkfifo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">pipe</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这将创建一个命名管道文件，它甚至可以在多个 shell 会话中使用。</p>\n<p>创建 FIFO 命名管道的另一种方法是使用此命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363db238e981763009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmknod p &lt;pipe-name&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363db238e981763009-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363db238e981763009-1\"><span class=\"crayon-i\">mknod</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">pipe</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>要重定向任何命令的标准输出到其它命令，请使用 <code>&gt;</code> 符号。要重定向任何命令的标准输入，请使用 &lt; <code>符号。</code></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/e3d27db16394809cf34d6b6a978c73f4.png\" alt=\"\"></p>\n<p>如上所示，<code>ls -al</code> 命令的输出被重定向到 <code>contents.txt</code> 并插入到文件中。类似地，<code>tail</code> 命令的输入通过 &lt; <code>符号从 <code>contents.txt</code> 读取。</code></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/55c8812ac4c408cd865f535200ce69c1.png\" alt=\"\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1cecee49e0d70b57db6356204b09b1ae.png\" alt=\"\"></p>\n<p>这里，我们创建了一个命名管道 <code>my-named-pipe</code>，并将 <code>ls -al</code> 命令的输出重定向到命名管道。我们可以打开一个新的 shell 会话并 <code>cat</code> 命名管道的内容，如前所述，它显示了 <code>ls -al</code> 命令的输出。请注意，命名管道的大小为零，并有一个标志 “p”。</p>\n<p>因此，下次你在 Linux 终端上使用命令并在命令之间移动数据时，希望管道使这个过程快速简便。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114379\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114379votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114379\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/ebb531e935e6b4104066e717fdb1714374f9be55.jpg"},{"url_object_id": "582691a82cdbe6482c80bd5c2a4ba07c", "title": "图像主题色提取算法", "url": "http://blog.jobbole.com/114372/", "create_date": "2018/09/12", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/499bf16cb3adc6934bf94650bf5b4616.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.rainy.im/2015/11/24/extract-color-themes-from-images/\">Yusheng</a>   </div><p>许多从自然场景中拍摄的图像，其色彩分布上会给人一种和谐、一致的感觉；反过来，在许多界面设计应用中，我们也希望选择的颜色可以达到这样的效果，但对一般人来说却并不那么容易，这属于色彩心理学的范畴（当然不是指某些伪神棍所谓的那种）。从彩色图像中提取其中的主题颜色，不仅可以用于色彩设计（参考网站：<a href=\"http://design-seeds.com/\">Design Seeds</a>），也可用于图像分类、搜索、识别等，本文分别总结并实现图像主题颜色提取的几种算法，包括颜色量化法（Color Quantization）、聚类(Clustering)和颜色建模的方法（颜色建模法仅作总结），源码可见：<a href=\"https://github.com/rainyear/ImageColorTheme\">GitHub: ImageColorTheme</a>。</p>\n<section>\n<h1>1. 颜色量化算法</h1>\n<p>彩色图像一般采用RGB色彩模式，每个像素由RGB三个颜色分量组成。随着硬件的不断升级，彩色图像的存储由最初的8位、16位变成现在的24位、32<a href=\"https://zh.wikipedia.org/wiki/%E7%9C%9F%E5%BD%A9%E8%89%B2\">真彩色</a>。所谓全彩是指每个像素由8位（$2^8$=0~255）表示，红绿蓝三原色组合共有1677万（$256*256*256$）万种颜色，如果将RGB看作是三维空间中的三个坐标，可以得到下面这样一张色彩空间图：</p>\n<p><a href=\"http://www.pyimagesearch.com/2014/12/01/complete-guide-building-image-search-engine-python-opencv/\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a1a9eb3d2a3819ce5e549378e91707f4.png\" alt=\"RGB color cube\"></a></p>\n<p>当然，一张图像不可能包含所有颜色，我们将一张彩色图像所包含的像素投射到色彩空间中，可以更直观地感受图像中颜色的分布：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/de654046d5d5bf7b537be4b0e8b103d6.png\" alt=\"Image in Color space\"></p>\n<p>因此颜色量化问题可以用所有<a href=\"https://en.wikipedia.org/wiki/Vector_quantization\">矢量量化（vector quantization, VQ）</a>算法解决。这里采用开源图像处理库 <a href=\"http://www.leptonica.com/\">Leptonica</a> 中用到的两种算法：中位切分法、八叉树算法。</p>\n<h2>1.1. 中位切分法（Median cut）</h2>\n<p><a href=\"https://github.com/lokesh/color-thief\">GitHub: color-theif</a> 项目采用了 Leptonica 中的用到的（调整）中位切分法，Js 代码比 C 要易读得多。中位切分算法的原理很简单直接，将图像颜色看作是色彩空间中的长方体（VBox），从初始整个图像作为一个长方体开始，将RGB中最长的一边从颜色统计的中位数一切为二，使得到的两个长方体所包含的像素数量相同，重复上述步骤，直到最终切分得到长方体的数量等于主题颜色数量为止。</p>\n<p>Leptonica 作者在报告 <a href=\"http://collaboration.cmc.ec.gc.ca/science/rpn/biblio/ddj/Website/articles/DDJ/1994/9409/9409e/9409e.htm\">Median-Cut Color Quantization</a> 中总结了这一算法存在的一些问题，其中主要问题是有可能存在某些条件下 VBox 体积很大但只包含少量像素。解决的方法是，每次进行切分时，并不是对上一次切分得到的所有VBox进行切分，而是通过一个优先级队列进行排序，刚开始时这一队列以VBox仅以VBox所包含的像素数作为优先级考量，当切分次数变多之后，将体积*包含像素数作为优先级。</p>\n<p>Python 3 中内置了<code>PriorityQueue</code>：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d40305010140158\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom queue import PriorityQueue as PQueue\r\n\r\nclass VBox(object):\r\n  def __init__(self, r1, r2, g1, g2, b1, b2, histo):\r\n    self.vol = calV()\r\n    self.npixs = calN()\r\n    self.priority = self.npixs * -1 # PQueue 是按优先级自小到大排序\r\n\r\nboxQueue.put((vbox0.priority, vbox0))\r\n\r\nvbox.priority *= vbox.vol\r\nboxQueue.put((vbox0.priority, vbox0))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40305010140158-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40305010140158-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40305010140158-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40305010140158-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40305010140158-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40305010140158-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40305010140158-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40305010140158-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40305010140158-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40305010140158-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40305010140158-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40305010140158-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d40305010140158-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">queue </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">PriorityQueue </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PQueue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40305010140158-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363d40305010140158-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VBox</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40305010140158-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">histo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40305010140158-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">calV</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40305010140158-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">npixs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">calN</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40305010140158-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">priority</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">npixs *</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># PQueue 是按优先级自小到大排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40305010140158-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363d40305010140158-9\"><span class=\"crayon-v\">boxQueue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">vbox0</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">priority</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vbox0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40305010140158-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363d40305010140158-11\"><span class=\"crayon-v\">vbox</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">priority *</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vbox</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">vol</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40305010140158-12\"><span class=\"crayon-v\">boxQueue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">vbox0</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">priority</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vbox0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n\n</div>\n<p>除此之外，算法中最重要的部分是统计色彩分布直方图。我们需要将三维空间中的任意一点对应到一维坐标中的整数，这样才能以最快地速度定位这一颜色。如果采用全部的24位信息，那么我们用于保存直方图的数组长度至少要是$2^{24}=16777216$，既然是要提取颜色主题（或是颜色量化），我们可以将颜色由RGB各8位压缩至5位，这样数组长度只有$2^{15}=32768$：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d4030f839074455\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef getColorIndex(self, r, g, b):\r\n    return (r &lt;&lt; (2 * self.SIGBITS)) + (g &lt;&lt; self.SIGBITS) + b\r\ndef getPixHisto(self):\r\n    pixHisto = np.zeros(1 &lt;&lt; (3 * self.SIGBITS))\r\n    for y in range(self.h):\r\n        for x in range(self.w):\r\n            r = self.pixData[y, x, 0] &gt;&gt; self.rshift\r\n            g = self.pixData[y, x, 1] &gt;&gt; self.rshift\r\n            b = self.pixData[y, x, 2] &gt;&gt; self.rshift\r\n\r\n            pixHisto[self.getColorIndex(r, g, b)] += 1\r\n    return pixHisto</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4030f839074455-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4030f839074455-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4030f839074455-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4030f839074455-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4030f839074455-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4030f839074455-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4030f839074455-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4030f839074455-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4030f839074455-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4030f839074455-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4030f839074455-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4030f839074455-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d4030f839074455-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getColorIndex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4030f839074455-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIGBITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIGBITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4030f839074455-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getPixHisto</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4030f839074455-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pixHisto</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIGBITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4030f839074455-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4030f839074455-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4030f839074455-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pixData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">rshift</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4030f839074455-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pixData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">rshift</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4030f839074455-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pixData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rshift</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4030f839074455-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363d4030f839074455-11\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">pixHisto</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getColorIndex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4030f839074455-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pixHisto</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n\n</div>\n<p>分别对4张图片进行切分、提取：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d40314512416868\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef testMMCQ(pixDatas, maxColor):\r\n    start  = time.process_time()\r\n    themes = list(map(lambda d: MMCQ(d, maxColor).quantize(), pixDatas))\r\n    print(\"MMCQ Time cost: {0}\".format(time.process_time() - start))\r\n    return themes\r\nimgs = map(lambda i: 'imgs/photo%s.jpg' % i, range(1,5))\r\npixDatas = list(map(getPixData, imgs))\r\nmaxColor = 7\r\n\r\nthemes = [testMMCQ(pixDatas, maxColor)]\r\nimgPalette(pixDatas, themes, [\"MMCQ Palette\"])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40314512416868-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40314512416868-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40314512416868-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40314512416868-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40314512416868-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40314512416868-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40314512416868-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40314512416868-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40314512416868-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40314512416868-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40314512416868-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d40314512416868-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">testMMCQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40314512416868-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40314512416868-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MMCQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">quantize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40314512416868-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"MMCQ Time cost: {0}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40314512416868-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">themes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40314512416868-6\"><span class=\"crayon-v\">imgs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'imgs/photo%s.jpg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40314512416868-7\"><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">getPixData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">imgs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40314512416868-8\"><span class=\"crayon-v\">maxColor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40314512416868-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40314512416868-10\"><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">testMMCQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40314512416868-11\"><span class=\"crayon-e\">imgPalette</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">themes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"MMCQ Palette\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n\n</div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/0d6435cf3a6c89279652bacc6fcdf95e.png\" alt=\"mmcq\"></p>\n<h2><strong>1.2. 八叉树算法（Octree）</strong></h2>\n<p>八叉树算法的原理可以参考这篇文章：<a href=\"http://xcoder.in/2014/09/17/theme-color-extract/\">圖片主題色提取算法小結</a>。作者也提供了 Js 实现的代码，虽然与 Leptonica 中 C 实现的方法差别很大，但原理上是一致的。</p>\n<p>建立八叉树的原理实际上跟上面提到的统计直方图有些相似，将颜色成分转换成二进制之后，较低位（八叉树中位置较深层）数值将被压缩进较高位（八叉树中较浅层）。八叉树算法应用到主题色提取可能存在的问题是，每次削减掉的叶子数不确定，但是新增加的只有一个，这就导致我们需要的主题色数量并不一定刚好得到满足，例如设定的主题色数量为7，可能上一次叶子时总数还有10个，到了下一次只剩5个了。类似的问题在后面手动实现的KMeans算法中也有出现，为了保证可以得到足够的主题色，不得不强行提高算法中的颜色数量，然后取图像中包含数量较多的作为主题色：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d40318675189271\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef getColors(self, node):\r\n      if node.isLeaf:\r\n          [r, g, b] = list(map(lambda n: int(n[0] / n[1]), zip([node.r, node.g, node.b], [node.n]*3)))\r\n          self.theme.append([r,g,b, node.n])\r\n      else:\r\n          for i in range(8):\r\n              if node.children[i] is not None:\r\n                  self.getColors(node.children[i])\r\nself.theme = sorted(self.theme, key=lambda c: -1*c[1])\r\nreturn list(map(lambda l: l[:-1],self.theme[:self.maxColor]))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40318675189271-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40318675189271-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40318675189271-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40318675189271-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40318675189271-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40318675189271-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40318675189271-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40318675189271-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40318675189271-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40318675189271-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d40318675189271-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getColors</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40318675189271-2\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">isLeaf</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40318675189271-3\"><span class=\"crayon-h\">          </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40318675189271-4\"><span class=\"crayon-h\">          </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40318675189271-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40318675189271-6\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40318675189271-7\"><span class=\"crayon-h\">              </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40318675189271-8\"><span class=\"crayon-h\">                  </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getColors</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40318675189271-9\"><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40318675189271-10\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n\n</div>\n<p>对比上面两种算法的结果：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d4031c470591977\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef testOQ(pixDatas, maxColor):\r\n    start  = time.process_time()\r\n    themes = list(map(lambda d: OQ(d, maxColor).quantize(), pixDatas))\r\n    print(\"OQ Time cost: {0}\".format(time.process_time() - start))\r\n    return themes\r\nthemes = [testMMCQ(pixDatas, maxColor), testOQ(pixDatas, maxColor)]\r\nimgPalette(pixDatas, themes, [\"MMCQ Palette\", \"OQ Palette\"])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4031c470591977-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4031c470591977-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4031c470591977-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4031c470591977-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4031c470591977-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4031c470591977-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4031c470591977-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d4031c470591977-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">testOQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4031c470591977-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4031c470591977-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">quantize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4031c470591977-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"OQ Time cost: {0}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4031c470591977-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">themes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4031c470591977-6\"><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">testMMCQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">testOQ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4031c470591977-7\"><span class=\"crayon-e\">imgPalette</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">themes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"MMCQ Palette\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"OQ Palette\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n\n</div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/da8329bbfc99ea9a3cad518afc726a11.png\" alt=\"MMCQ vs OQ\"></p>\n<p>可见八叉树算法可能更适合用于提取调色板，而且两种算法运行时间差异也很明显：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d40320297430499\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#MMCQ Time cost: 8.238793\r\n\r\n#OQ Time cost: 55.173573</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40320297430499-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40320297430499-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40320297430499-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d40320297430499-1\"><span class=\"crayon-p\">#MMCQ Time cost: 8.238793</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40320297430499-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b9f363d40320297430499-3\"><span class=\"crayon-p\">#OQ Time cost: 55.173573</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n\n</div>\n<p>除了OQ中采用较多递归以外，未对原图进行抽样处理也是其中原因之一。</p>\n<h2>2. 聚类</h2>\n<p>聚类是一种无监督式机器学习算法，我们这里采用K均值算法。虽然说是“机器学习”听起来时髦些，但算法本质上比上面两种更加简单粗暴。</p>\n<h3>KMeans算法</h3>\n<p>KMeans算法的原理更加简洁：“物以类聚”。我们目的是将一堆零散的数据（如上面图2）归为k个类别，使得每个类别中的每个数据样本，距离该类别的中心（质心，centroid）距离最小，数学公式为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d40324070958518\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ $ \\sum_{i=0}^N \\min_{ \\mu_j \\in C} (||x_i - \\mu_j||^2) $ $</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40324070958518-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d40324070958518-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e\">sum_</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">^</span><span class=\"crayon-e\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e\">min_</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">mu</span><span class=\"crayon-sy\">_</span>j<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">||</span><span class=\"crayon-v\">x_i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">mu_j</span><span class=\"crayon-o\">||</span><span class=\"crayon-o\">^</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>上文提到八叉树算法可能出现结果与主题色数量不一致的情况，在KMeans算法中，初始的k个类别的质心的选择也可能导致类似的问题。当采用随机选择的方法时，有可能出现在迭代过程中，选择的中心点距离所有其它数据太远而最终导致被孤立。这里分别采用手动实现和<a href=\"http://scikit-learn.org/stable/index.html\">scikit-learn</a>的方法实现，根据<a href=\"http://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html#sklearn.cluster.KMeans\">scikit-learn 提供的API</a>，完成主题色的提取大概只需要几行代码：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d40327878016452\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom sklearn.cluster import KMeans as KM\r\nimport numpy as np\r\n\r\n#@pixData      image pixels stored in numpy.ndarray\r\n#@maxColor     theme color number\r\nh, w, d = pixData.shape\r\ndata = np.reshape((h*w, d))\r\nkm = KM(n_clusters=maxColor)\r\nkm.fit(data)\r\ntheme = np.array(km.cluster_centers_, dtype=np.uint8)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40327878016452-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40327878016452-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40327878016452-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40327878016452-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40327878016452-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40327878016452-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40327878016452-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40327878016452-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d40327878016452-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d40327878016452-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d40327878016452-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cluster </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">KMeans </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">KM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40327878016452-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40327878016452-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40327878016452-4\"><span class=\"crayon-p\">#@pixData      image pixels stored in numpy.ndarray</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40327878016452-5\"><span class=\"crayon-p\">#@maxColor     theme color number</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40327878016452-6\"><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pixData</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shape</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40327878016452-7\"><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">h*</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40327878016452-8\"><span class=\"crayon-v\">km</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">KM</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_clusters</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d40327878016452-9\"><span class=\"crayon-v\">km</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d40327878016452-10\"><span class=\"crayon-v\">theme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">km</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster_centers_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">uint8</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n\n</div>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b9f363d4032b914628214\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimgs = map(lambda i: 'imgs/photo%s.jpg' % i, range(1,5))\r\npixDatas = list(map(getPixData, imgs))\r\nmaxColor = 7\r\nthemes = [testKmeans(pixDatas, maxColor), testKmeans(pixDatas, maxColor, useSklearn=False)]\r\nimgPalette(pixDatas, themes, [\"KMeans Palette\", \"KMeans DIY\"])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4032b914628214-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4032b914628214-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4032b914628214-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b9f363d4032b914628214-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b9f363d4032b914628214-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b9f363d4032b914628214-1\"><span class=\"crayon-v\">imgs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'imgs/photo%s.jpg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4032b914628214-2\"><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">getPixData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">imgs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4032b914628214-3\"><span class=\"crayon-v\">maxColor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b9f363d4032b914628214-4\"><span class=\"crayon-v\">themes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">testKmeans</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">testKmeans</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">maxColor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">useSklearn</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b9f363d4032b914628214-5\"><span class=\"crayon-e\">imgPalette</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pixDatas</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">themes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"KMeans Palette\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"KMeans DIY\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n\n</div>\n<p>测试比较手动实现和scikit-learn的结果如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/8fa5b30b6c4737d28e3b8d4fec0d0715.png\" alt=\"KMeans vs DIY\"></p>\n<p>好吧我承认很惨，耗时方面也是惨不忍睹。</p>\n<h1>3. 色彩建模</h1>\n<p>从上面几种算法结果来看，MMCQ和 KMeans在时间和结果上都还算不错，但仍有改进的空间。如果从人类的角度出发，两种算法的策略或者说在解决主题色提取这一问题时采纳的特征（feature）都接近于颜色密度，即相近的颜色凑在一起数量越多，越容易被提取为主题颜色。</p>\n<p>最后要提到的算法来自<a href=\"http://vis.stanford.edu/\">斯坦福可视化组</a>13年的一篇研究：<a href=\"http://dl.acm.org/citation.cfm?id=2466424\">Modeling how people extract color themes from images</a>，实际上比较像一篇心理学研究的套路：建模-找人类被试进行行为实验-调参拟合。文章提取了图像中的79个特征变量并进行多元回归，同时找到普通人类被试和艺术系学生对图像的主题颜色进行选择，结果证明特征+回归能够更好地拟合人类选择的结果。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/c51d20b56423c4d9141118f36f1fa593.png\" alt=\"all color themes\"></p>\n<p>79个特征的多元回归模型，不知道会不会出现过度拟合？另外虽然比前面算法多了很多特征，但仍旧多物理特征。对人类观察者来说，我们看到的并非一堆无意义的色块，虽然有研究表明颜色信息并非场景识别的必要线索，但反过来场景图像中的语义信息却很有可能影响颜色对观察者的意义，这大概就是心理学研究与计算机科学方向上的差异。</p>\n<h1>总结</h1>\n<p>以上算法若要应用还需更多优化，例如先抽样再处理，计算密集的地方用C/C++或并行等。另外需要一个对Python每个函数执行时间进行记录的工具，分析运行时间长的部分。</p>\n<h1>参考</h1>\n<ol>\n<li><a href=\"http://tpgit.github.io/UnOfficialLeptDocs/leptonica/color-quantization.html\">Color Quantization</a></li>\n<li><a href=\"http://leptonica.com/papers/mediancut.pdf\">Color quantization using modified median cut</a></li>\n<li><a href=\"http://collaboration.cmc.ec.gc.ca/science/rpn/biblio/ddj/Website/articles/DDJ/1994/9409/9409e/9409e.htm\">Median-Cut Color Quantization</a></li>\n<li><a href=\"http://www.microsoft.com/msj/archive/S3F1.aspx\">Wicked Code</a></li>\n<li><a href=\"http://scikit-learn.org/stable/modules/clustering.html#k-means\">Clustering – scikit-learn</a></li>\n<li><a href=\"http://scikit-learn.org/stable/auto_examples/cluster/plot_color_quantization.html\">Color Quantization using K-Means</a></li>\n<li><a href=\"https://github.com/rainyear/ImageColorTheme\">Extract Color Themes from Images</a></li>\n<li>Lin, S., &amp; Hanrahan, P. (2013). Modeling how people extract color themes from images. Proc of Chi Acm, 3101-3110.</li>\n</ol>\n</section>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114372\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114372votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114372\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f988bd35264f4e1d427950ba55f20e8480fc812e.jpg"}]